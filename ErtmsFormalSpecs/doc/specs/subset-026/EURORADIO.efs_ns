<NameSpace
 X="330"
 Y="60"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Name="EURORADIO"
 Guid="e1153af3-3878-4752-bfdb-9a6c11411de4"
>
<NameSpaces>
<NameSpaceRef
 Name="PositionReport"
 Guid="c9623ca4-7f96-47f9-9040-bcb29cb92c3d"
>
</NameSpaceRef><NameSpaceRef
 Name="TrainData"
 Guid="3e0fac33-af2e-49fb-87bd-7ac9bade11fe"
>
</NameSpaceRef></NameSpaces>
<Enumerations>
<Enum
 Default="SafeRadioConnectionStatusEnum.NoConnection"
 X="480"
 Y="210"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SafeRadioConnectionStatusEnum"
 Guid="fe039c94-e8dc-416a-b815-f5ad8300c526"
>
<ReqRef
 Id="747bae2e-7720-4f04-ac58-bf2f7feb9e50"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9a75773a-005e-4c35-993c-02bb41df811e"
>
</ReqRef><Comment>Possible safe connection statuses.</Comment>
<Values>
<EnumValue
 Value="0"
 Name="NoConnection"
 Guid="56356f1b-8662-4507-a0d9-ec8a7d4cd272"
>
</EnumValue><EnumValue
 Value="1"
 Name="ConnectionLostOrSetUpFailed"
 Guid="6e15a44f-7a64-4aef-8094-c6cd3222235a"
>
</EnumValue><EnumValue
 Value="2"
 Name="ConnectionUp"
 Guid="865de485-ea5e-45e3-9dbe-9d63433a1a2e"
>
</EnumValue></Values>
</Enum><Enum
 Default="ContactActionEnum.Establish"
 X="130"
 Y="390"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="ContactActionEnum"
 Guid="ea5b0cd8-a7cc-4aca-9390-c8842517ff24"
>
<ReqRef
 Id="c2b39282-833e-4fd4-abd9-3a72c47f0782"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="22f89241-4057-4375-972a-172c9d3b6255"
>
</ReqRef><ReqRef
 Id="afd82aec-eda7-4ec0-8f16-8002a8687ab2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1079e0c0-c6d5-43ed-9d05-cecb7cb27883"
>
</ReqRef><Comment>Action to be performed while ordering to contact an RBC.</Comment>
<Values>
<EnumValue
 Value=""
 Name="Establish"
 Guid="34fd382e-e4ab-4f91-9e9e-cad2e2a7d21a"
>
</EnumValue><EnumValue
 Value=""
 Name="Terminate"
 Guid="efe01397-7c69-4d63-8eb6-7e646cca2191"
>
</EnumValue></Values>
</Enum><Enum
 Default="SystemVersionEnum.Version2_0"
 X="480"
 Y="470"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SystemVersionEnum"
 Guid="e434ea8a-ec75-42f9-8347-85f8030caba3"
>
<ReqRef
 Id="790cf49e-a85c-4110-b567-fc5d57052339"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a3662f1a-59bd-4477-b564-a2296f7d6fb2"
>
</ReqRef><ReqRef
 Id="25af834a-3a24-459b-b5c8-97b85eddb2e8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2cbb484c-d4dd-4b8a-92b8-7c9588c87ca0"
>
</ReqRef><Comment>Gives the possible system versions for Euroradio communication.</Comment>
<Values>
<EnumValue
 Value="0"
 Name="Version1_0"
 Guid="57240a8e-82c1-4bc2-85a2-0db7d7eca3b9"
>
</EnumValue><EnumValue
 Value="1"
 Name="Version1_1"
 Guid="0dc39e5e-a3df-4e7b-b900-0faa0a026b92"
>
</EnumValue><EnumValue
 Value="2"
 Name="Version2_0"
 Guid="27af6815-c66e-44a0-8232-36c46b5f46f1"
>
</EnumValue></Values>
</Enum><Enum
 Default="ContactOptionEnum.None"
 X="930"
 Y="110"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="ContactOptionEnum"
 Guid="7bab1523-0861-44c9-ad3b-364cd97fcc04"
>
<ReqRef
 Id="369d7ae0-50db-411b-9941-bbe30e354733"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a0c7f339-6f2d-4c73-95b4-8cefbd1020ac"
>
</ReqRef><ReqRef
 Id="40859515-77c4-46aa-96a5-12453cd171a2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7dc8e3c5-7a8b-446a-8538-363110bacba6"
>
</ReqRef><ReqRef
 Id="cebfc056-7b96-49d7-a6ff-1fdf0076bb9e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1e3e0613-ae98-44ff-a1b3-6f6d8fff01d4"
>
</ReqRef><Comment>Indicates how the RBC has to be contacted.</Comment>
<Values>
<EnumValue
 Value="0"
 Name="ContactLastKnownRBC"
 Guid="b8d94300-4144-4b52-9852-f37c28d2ee88"
>
</EnumValue><EnumValue
 Value="1"
 Name="UseOnBoardStoredShortNumber"
 Guid="69a92fdd-ed20-43d6-b2f5-6dd666092907"
>
</EnumValue><EnumValue
 Value="2"
 Name="RBCIdAndPhoneNumber"
 Guid="e2610b4d-3509-49f9-bb90-82315bcfe068"
>
</EnumValue><EnumValue
 Value="3"
 Name="None"
 Guid="0ca1ef56-ad4c-46ce-91ca-94eb05874054"
>
</EnumValue></Values>
</Enum><Enum
 Default="SpecialCaseSessionEstablishmentReasonEnum.DoNotEstablish"
 X="480"
 Y="110"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SpecialCaseSessionEstablishmentReasonEnum"
 Guid="205157d3-e3d5-4060-8439-329289efb6d9"
>
<ReqRef
 Id="752d0832-7cfa-4424-96f7-d3fbb447a20e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="dd9be4e8-c89a-4f1f-9884-24c1c72593bd"
>
</ReqRef><ReqRef
 Id="e36dd5fc-81ea-4253-8535-4e5b4afd1b54"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e2bd3a2b-8e66-4417-8ce5-b57742fe72d3"
>
</ReqRef><Comment>If a communication session has to be established, this enum indicates why it has to be established.</Comment>
<Values>
<EnumValue
 Value="0"
 Name="DoNotEstablish"
 Guid="da2bfe4b-c5ce-49be-8c38-1b0be8e6a929"
>
</EnumValue><EnumValue
 Value="1"
 Name="EstablishDueToLossOfConnection"
 Guid="bba21269-f466-4cd8-9c35-a758a5872258"
>
</EnumValue><EnumValue
 Value="2"
 Name="EstablishDueToRadioHole"
 Guid="e66584f1-3758-4b8b-88fc-04937d7e7201"
>
</EnumValue><EnumValue
 Value="3"
 Name="EstablishDueToModeChangeReport"
 Guid="582d1927-ae02-4bbf-b7c2-2c10234069af"
>
</EnumValue></Values>
</Enum><Enum
 Default="MessagePriorityEnum.Normal"
 X="630"
 Y="310"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="MessagePriorityEnum"
 Guid="7134f161-125c-4cd8-808c-a1dc59c80b36"
>
<ReqRef
 Id="e700d18e-d4e8-422a-990c-f149f477ef14"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1409df03-653c-45d0-bf82-b13c4e413e42"
>
</ReqRef><Comment>Indicates the priority of a track to train RBC message.
Only emergency stop orders can be high priority.</Comment>
<Values>
<EnumValue
 Value=""
 Name="Normal"
 Guid="bcdb1687-7cd4-4611-8154-52174ea7b29f"
>
</EnumValue><EnumValue
 Value=""
 Name="High"
 Guid="d4ac1c7d-2687-45ac-9eb4-942b3b5b1ce8"
>
</EnumValue></Values>
</Enum></Enumerations>
<Structures>
<Structure
 Default=""
 X="270"
 Y="210"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="RBCStruct"
 Guid="a486085f-3201-4bf5-8db8-cf3027c03815"
>
<ReqRef
 Id="becb430f-a4f2-4817-ad08-3672ed05f855"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="cb738b09-f0d3-4a4e-8c82-014ee43482cc"
>
</ReqRef><Comment>Represents one instance of communication with RBC.</Comment>
<Rules>
<Rule
 Priority="CleanUp"
 Implemented="TRUE"
 Name="Clear input message"
 Guid="46319b75-1481-4c0f-aa43-2ddac6249e60"
>
<Comment>Ah the end of the cycle, the message has to be erazed (otherwise at the beginning of the following cycle the system will consider that this message is received again).</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Clear input message"
 Guid="48c4a0a3-7c51-4de9-86b1-e4e9433a8cde"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="0271d2ba-8432-4ab8-9751-21368dd80660"
>MessageIn &lt;- EMPTY</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Verification"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Clear output message"
 Guid="0339f48d-dd3c-4427-bb71-c2b0692813a5"
>
<Comment>In the beginning of the cycle, the previously sent message is erazed.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Clear output message"
 Guid="b8277cd5-cb64-43eb-b93c-592bf2cbe729"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="a88d3410-4254-4ea2-b4be-62c09e71fb63"
>MessageOut &lt;- EMPTY</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Verification"
 Implemented="TRUE"
 Name="Supervise max time between received messages"
 Guid="c5d62060-3b89-489b-be3b-b0b8944f4282"
>
<ReqRef
 Id="a3ae1dd4-1e9a-44e2-85d0-b0ebc947ebc1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="73849776-b2c8-4e81-94f4-f6a3976c2bb0"
>
</ReqRef><ReqRef
 Id="6950f2b1-0c72-4e10-9f34-e93e44498694"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bf640674-13b2-49ad-bbb2-fe0aa0a5c49f"
>
</ReqRef><ReqRef
 Id="60e39a2f-4380-44e7-bf85-7142748b200f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ebaa08b9-8a5f-4e0b-afc4-44c1ecdca0ca"
>
</ReqRef><ReqRef
 Id="3d4a4bc1-0bca-4a3b-9856-b6e42e4c9d03"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="342cdeb8-ffd0-43ee-9bf6-2e3db389f260"
>
</ReqRef><ReqRef
 Id="4aafaa1d-6dad-4116-9c76-919faa0a29e7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ae241e7f-21f0-453f-9802-7f6c9b88324f"
>
</ReqRef><ReqRef
 Id="c70bfa9f-8666-4350-a99f-e648bd25c511"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="feca8e4a-cf18-4594-a82c-3f895513d4a1"
>
</ReqRef><ReqRef
 Id="75998632-b501-408b-884c-9389aefb1de7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="724ff2d3-e565-4a18-801b-67ef2998aad9"
>
</ReqRef><ReqRef
 Id="88cc77ff-7146-4934-be41-451d8f3ce0bd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5eeebf3e-d94a-4c7c-8b3d-bd01f71cbc4f"
>
</ReqRef><ReqRef
 Id="0b314991-9ddf-4e48-bbbc-ef8083339ea7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9b1b5283-c5d1-4fea-8df8-167fe49692ed"
>
</ReqRef><ReqRef
 Id="2acfcc15-b52e-4162-a72e-a4ff1e9f43e1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c25eb8fc-8bea-4d3f-98a1-3dfc447208b0"
>
</ReqRef><Comment>When connected to the RBC, the on-board may require (depending on the national value T_NVCONTACT) that the RBC send a message with a certain frequency.
If the RBC does not send a consistent message within the period T_NVCONTACT, the on-board will apply the reaction specified by the national value M_NVCONTACT.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Supervise max time between received messages"
 Guid="517f696f-ec26-45ed-b7b3-ca89f3d42492"
>
<Comment>If the on-board timer reaches the value of T_NVCONTACT since the last consistent message was received from the RBC, apply the reaction.</Comment>
<PreConditions>
<PreCondition
 Guid="1927d6d3-b902-49fb-8659-ba192ce507d3"
>Kernel.DateAndTime.CurrentTime &gt; OnboardReference_MessageTimer + Kernel.NationalValues.ApplicableNationalValues.Value.MaxTimeSinceCreationInTheRBCOfLastReceivedTelegram</PreCondition><PreCondition
 Guid="48586d1f-c5f2-41a2-a230-9552e9516335"
>NOT THERE_IS BrakeCommand IN Kernel.ServiceBrakeCommands | BrakeCommand == Kernel.BrakeReason.NoRadioMessageInDueTime</PreCondition><PreCondition
 Guid="047d557f-5809-47bc-bd4b-a2ebcda881e8"
>ContactTimerSupervised</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Apply reaction"
 Guid="9fee50da-35cb-4fef-9b9b-9c3ed89b0277"
>
<Comment>Apply the reaction determined by M_NVCONTACT.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Train trip"
 Guid="8c1f6e2e-18b0-4317-971b-15b80b2396e4"
>
<ReqRef
 Id="bc9fa0cb-b1ef-4c53-a9bb-3b13192f1b2f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3a910894-9dad-48df-b601-a4d0b73fc47a"
>
</ReqRef><Comment>Trip the train.
Keep the reason for it to be displayed to the driver.</Comment>
<PreConditions>
<PreCondition
 Guid="e1ae4709-9dd0-404c-a5fe-fd8e2afddc56"
>Kernel.NationalValues.ApplicableNationalValues.Value.SystemReactionIfRadioChannelMonitoringTimeLimitExpires == Messages.M_NVCONTACT.Train_trip</PreCondition></PreConditions>
<Actions>
<Action
 Guid="35c7ae19-379e-4fe1-9f80-bbfeed7fb8e3"
>TrainTripDueToMaxTimeBetweenMessagesExceeded &lt;- True</Action><Action
 Guid="df2fb773-415b-49bc-8066-df20f0a0c275"
>INSERT Kernel.EmergencyStopStruct{
    IsConditional =&gt; False,
    Id =&gt; 0,
    StopLocation =&gt; 0.0,
    Reason =&gt; Kernel.BrakeReason.NoRadioMessageInDueTime
}
IN Kernel.EmergencyStops</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Apply service brake"
 Guid="d5e4d836-372a-40d6-a902-d33f8de1ee2a"
>
<ReqRef
 Id="bc9fa0cb-b1ef-4c53-a9bb-3b13192f1b2f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b2a3f8d4-0fad-4b14-b2ad-1486321cc154"
>
</ReqRef><Comment>Apply the service brake.
Keep the reason for it to be displayed to the driver.</Comment>
<PreConditions>
<PreCondition
 Guid="2a983f3f-e8df-4254-962a-27e521c59306"
>Kernel.NationalValues.ApplicableNationalValues.Value.SystemReactionIfRadioChannelMonitoringTimeLimitExpires == Messages.M_NVCONTACT.Apply_service_brake</PreCondition></PreConditions>
<Actions>
<Action
 Guid="f97da9de-0e29-4726-9112-51860fdea0f0"
>Kernel.AddSBCommand(Kernel.BrakeReason.NoRadioMessageInDueTime)</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="No reaction"
 Guid="bfa2c3ea-f5bf-49a4-b810-b364e15e60ba"
>
<Comment>No reaction.</Comment>
<PreConditions>
<PreCondition
 Guid="2b1d39cb-0822-457d-8275-eb81b7828733"
>Kernel.NationalValues.ApplicableNationalValues.Value.SystemReactionIfRadioChannelMonitoringTimeLimitExpires == Messages.M_NVCONTACT.No_Reaction</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Release brake command"
 Guid="e764e9dd-b8ac-4d3e-8db0-f8a2916366da"
>
<ReqRef
 Id="1d090478-a64a-43b9-bbaf-2cdfb2d81d32"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="737cdd8f-9f6d-4925-9d55-b66d8557799b"
>
</ReqRef><ReqRef
 Id="e7ac0b5d-5b94-4f8d-85af-20c7e79216b9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8bf9650e-0ca2-4198-bebe-e878271cbb5d"
>
</ReqRef><ReqRef
 Id="4c72e2f8-34a5-4066-86d2-067ebbdb7465"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5d332479-b2b0-4438-9c3c-984681d7e8c2"
>
</ReqRef><Comment>If the service brake was applied because no consistent message was received in the required period, the brake command is revoked if a message is received from the RBC or if the train reaches standstill.</Comment>
<PreConditions>
<PreCondition
 Guid="c5a8af33-3e15-4fc3-97f7-d563354a6ec6"
>THERE_IS BrakeCommand IN Kernel.ServiceBrakeCommands | BrakeCommand == Kernel.BrakeReason.NoRadioMessageInDueTime

  AND  

(
Odometry.TrainIsAtStandstill()
 OR 
Available(MessageIn)
)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="ec756cc9-1422-4ce1-9f0c-f25195a8d5c9"
>Kernel.RemoveSBCommand(Kernel.BrakeReason.NoRadioMessageInDueTime)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Verification"
 Implemented="TRUE"
 Name="Restart connection after radio silence"
 Guid="ae11d585-832b-4f57-ac07-856b1534bf33"
>
<ReqRef
 Id="314c9698-d68d-4f63-ae14-0d4aad3e6388"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="97560492-9bc2-435a-9ceb-18684eb20657"
>
</ReqRef><ReqRef
 Id="88cc77ff-7146-4934-be41-451d8f3ce0bd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="94483242-e35d-47af-a97f-7740025ac0fe"
>
</ReqRef><Comment>If no message is received for 60 seconds after the period T_NVCONTACT, the on-board restarts the safe radio connection without ending the communication session.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Restart connection after"
 Guid="e757408c-26bf-4a29-ad78-ee3c910980a0"
>
<PreConditions>
<PreCondition
 Guid="2fa270a6-cb59-4b15-a2ed-7a01bfded428"
>Kernel.DateAndTime.CurrentTime &gt; OnboardReference_MessageTimer + Kernel.NationalValues.ApplicableNationalValues.Value.MaxTimeSinceCreationInTheRBCOfLastReceivedTelegram + DelayToDisconnect</PreCondition><PreCondition
 Guid="72bb38b1-b631-4c66-8fc6-c5c562962109"
>ContactTimerSupervised</PreCondition></PreConditions>
<Actions>
<Action
 Guid="9f0b8b99-968a-4132-a255-930a6cfcfa7c"
>SessionManagementData.ConnectionIsEstablished &lt;- False</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
<Procedures>
<Procedure
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="SendPositionReport"
 Guid="d551c0f2-3853-4033-86fa-bb55a4747107"
>
<ReqRef
 Id="3bb3db5b-9c3d-4113-bc32-973de664a85a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="11feaa20-6859-4c99-ab39-3827646c0c43"
>
</ReqRef><ReqRef
 Id="7a161d4e-9daf-4632-afbc-9c0ba1b37e6c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="09327bdb-9d58-4926-b3a2-1027c8bdccdf"
>
</ReqRef><ReqRef
 Id="8512700f-a6d7-4b0c-a289-782c95b3ff9c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d08954a5-8ebe-44c6-adbf-88347835cb98"
>
</ReqRef><ReqRef
 Id="57f6f903-9f6e-4b2c-8772-6ba6ca0aec3f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7cc47f49-8040-44c9-85fc-80683474352c"
>
</ReqRef><ReqRef
 Id="1ad3279a-9643-4da5-9373-74edaa89c5fb"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4c2f5041-bbeb-4b22-bca7-b8b8e02d22bb"
>
</ReqRef><ReqRef
 Id="2cede8a1-5372-48a2-b195-db43cc0d3c3f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c4a848f6-728b-40c5-9b16-6b080357e43f"
>
</ReqRef><ReqRef
 Id="6133d02d-e7a6-49f8-b647-7da1e187169e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7d482b5b-0de4-4111-8690-895b041abc8c"
>
</ReqRef><ReqRef
 Id="1bf8b9b6-79f5-474e-b31e-1e946b2adaf1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="337f2199-195a-474f-b7cb-4fc34bd60c52"
>
</ReqRef><ReqRef
 Id="e6ece399-f216-4956-a5c8-811ae465ba7b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e80bb6b4-e499-4d46-adb0-d0197da94c5d"
>
</ReqRef><Comment>Sends the Position report message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="1e838a0b-1365-4864-a698-9b6294d2c77d"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="The message can be sent"
 Guid="1326e3c1-f9f4-4e39-a552-d0f91ba0ed9e"
>
<Comment>In the case the communication session is opened, the message is sent.</Comment>
<PreConditions>
<PreCondition
 Guid="0322d270-b2d6-49d2-ac91-1123f4364021"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="d36b5e14-701a-47f8-a07f-2c20c9a57a79"
>InitializeOutMessage()</Action><Action
 Guid="79dbebec-3f39-4331-b8b2-edabf9c5149b"
>MessageOut.TRAIN_POSITION_REPORT &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.TRAIN_POSITION_REPORT.Message
{
    L_MESSAGE =&gt; EMPTY,
    NID_ENGINE =&gt; Kernel.NidEngine,
    NID_MESSAGE =&gt; 136,
    POSITION_REPORT =&gt; PositionReport.CreatePositionReport(),
    Sequence1 =&gt; [],
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime)
}</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Include error report"
 Guid="d9f908d5-de87-4bab-91ce-da2c66953c63"
>
<ReqRef
 Id="9e2c2d2b-5db5-4ed7-ac2d-0ff95a23e76f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ddac13ec-1b48-4d26-9286-afd5f82d7e7f"
>
</ReqRef><Comment>If a safety critical fault was detected in this cycle, send it to the RBC</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Add packet 4"
 Guid="083c5a7e-665e-4129-b81b-334094135d71"
>
<PreConditions>
<PreCondition
 Guid="6ae49c95-7d4b-42c1-8330-6a69edd591a3"
>THERE_IS Fault IN Kernel.SafetyCriticalFaults | Fault.Timestamp == Kernel.DateAndTime.Now()</PreCondition></PreConditions>
<Actions>
<Action
 Guid="e07dcf11-0ce2-47e9-879e-4b160dbf579e"
>INSERT Messages.MESSAGE.TRAIN_TO_TRACK.TRAIN_POSITION_REPORT.SubStructure1{
    ERROR_REPORTING =&gt; Messages.PACKET.TRAIN_TO_TRACK.ERROR_REPORTING.Message{
        NID_PACKET =&gt; 4,
        L_PACKET =&gt; 0,
        M_ERROR =&gt; (FIRST X IN Kernel.SafetyCriticalFaults | X.Timestamp == Kernel.DateAndTime.Now()).Fault
    }
}
 IN MessageOut.TRAIN_POSITION_REPORT.Sequence1</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="The message cannot be sent"
 Guid="dd2c92ac-da7a-4d3b-9279-fd1cf283922a"
>
<ReqRef
 Id="fbaaf410-a59f-40cd-b972-aa1e84116831"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="67eccd8c-dae4-4c14-a3eb-147b9f08ccc2"
>
</ReqRef><Comment>In the case the communication session is not open, and the position report is sent due to mode change not considered as end of mission, a new session will be opened and the message will then be sent.</Comment>
<PreConditions>
<PreCondition
 Guid="aba612e6-4965-48ec-b40a-4541e169456d"
>PositionReport.SendReportDueToModeChange()</PreCondition><PreCondition
 Guid="6fb82fcc-1dd5-40c1-a0a7-87279e71cf42"
>Kernel.HandleModeChange not in Kernel.HandleModeChangeSM.EndOfMission</PreCondition><PreCondition
 Guid="5367589d-d8aa-4929-8097-c8ee899fbb19"
>Kernel.Level.Value.Value in [Default.Level.L2, Default.Level.L3]</PreCondition></PreConditions>
<Actions>
<Action
 Guid="d67963d3-60e6-4eed-8fac-e91efefafe50"
>SpecialCaseSessionEstablishmentReason &lt;- SpecialCaseSessionEstablishmentReasonEnum.EstablishDueToModeChangeReport</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendSOMPositionReport"
 Guid="e3220a82-2afc-4b5c-a090-53f9bb36659b"
>
<ReqRef
 Id="aa43ddb6-13a5-4b3e-bbcc-bf985bea4175"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="767f0bfd-f651-4416-b879-f414c2f79cea"
>
</ReqRef><ReqRef
 Id="6375b0de-0293-4d16-abdf-cb5f39a35143"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e4dccb90-05ce-4571-9f3f-3523708d0a38"
>
</ReqRef><ReqRef
 Id="dff3b2f7-dd70-412e-8eef-75f2fefa03c9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bb20a6c3-3ed9-4fe0-a1f0-8c592dfaa248"
>
</ReqRef><ReqRef
 Id="fd5c097e-b4c0-466b-850d-99f930692988"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1134427a-c5d3-4ec0-b45a-6466e4654205"
>
</ReqRef><ReqRef
 Id="7d3615d3-8bd3-4134-8d72-fcfc017f1749"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="12f43f32-bf6f-4c8a-9d86-82374158c0f9"
>
</ReqRef><ReqRef
 Id="4608349b-50d4-4c14-9c72-18d03706ed89"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3897d6ee-b98b-434e-9ac9-ac77e749e0ce"
>
</ReqRef><ReqRef
 Id="9f0eacfe-16d9-4bf2-936d-fe62a645918e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d8990a7a-0edf-4046-8552-36fe5fbe3074"
>
</ReqRef><ReqRef
 Id="21f08a64-2ded-47ef-b209-47e6f1df9f9f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="39451b82-9ea9-4cd9-8062-d8e060923a21"
>
</ReqRef><ReqRef
 Id="bbaed3c1-8068-4694-b20d-a574f61aff20"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="09ec1b86-50a8-4254-83e9-52a2ffa7d300"
>
</ReqRef><ReqRef
 Id="0cec34e4-d359-4da6-bf72-ec307144efab"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ce5682ad-b177-4039-9281-20d06800207a"
>
</ReqRef><ReqRef
 Id="f3ff7f4d-3f24-4101-8ad4-d2902c011869"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e4bf359f-5f00-45c6-8992-f01ef6401d54"
>
</ReqRef><Comment>Sends the Start of Mission position report message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="a12be67a-f112-414a-af20-7873c6b0671e"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="3c9531c1-a642-4e1b-b3dd-dc4e7ab35d2c"
>
<PreConditions>
<PreCondition
 Guid="51eef2a5-c279-4323-a925-b48791cf1653"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="ad87a631-5eb9-4189-b1f9-c830843481d2"
>InitializeOutMessage()</Action><Action
 Guid="ee5a0c21-596d-4adf-9f6e-f3f46a1437d7"
>MessageOut.SOM_POSITION_REPORT &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.SOM_POSITION_REPORT.Message
{
    L_MESSAGE =&gt; EMPTY,
    NID_ENGINE =&gt; Kernel.NidEngine,
    NID_MESSAGE =&gt; 157,
    Q_STATUS =&gt; PositionReport.FillQStatus(),
    POSITION_REPORT =&gt; PositionReport.CreatePositionReport(),
    Sequence1 =&gt; EMPTY,
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime)
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="InitializeOutMessage"
 Guid="c3a62f8f-4ddb-4ad9-b370-6cb6b66ac72b"
>
<Comment>This procedure has to be called before filling the out message with some information.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Initialize out message"
 Guid="6d4d6846-0184-40cc-87a6-19c04a568c69"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Initialize out message"
 Guid="383c3a6c-4b8b-411f-b5a0-6dacf0dfa9bd"
>
<PreConditions>
<PreCondition
 Guid="96e96db5-efb2-4460-8166-cd2593b2ee48"
>MessageOut == EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="2d00e9a8-4356-42a6-a9b3-cdf669db2f2b"
>MessageOut &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.Message
{
    VALIDATED_TRAIN_DATA =&gt; EMPTY,
    TRAIN_POSITION_REPORT =&gt; EMPTY,
    REQUEST_FOR_SHUNTING =&gt; EMPTY,
    MA_REQUEST =&gt; EMPTY,
    TRAIN_POSITION_REPORT =&gt; EMPTY,
    REQUEST_TO_SHORTEN_MA_IS_GRANTED =&gt; EMPTY,
    REQUEST_TO_SHORTEN_MA_IS_REJECTED =&gt; EMPTY,
    ACKNOWLEDGEMENT =&gt; EMPTY,
    ACKNOWLEDGEMENT_OF_EMERGENCY_STOP =&gt; EMPTY,
    TRACK_AHEAD_FREE_GRANTED =&gt; EMPTY,
    END_OF_MISSION =&gt; EMPTY,
    RADIO_INFILL_REQUEST =&gt; EMPTY,
    NO_COMPATIBLE_VERSION_SUPPORTED =&gt; EMPTY,
    INITIATION_OF_A_COMMUNICATION_SESSION =&gt; EMPTY,
    TERMINATION_OF_A_COMMUNICATION_SESSION =&gt; EMPTY,
    SOM_POSITION_REPORT =&gt; EMPTY,
    TEXT_MESSAGE_ACKNOWLEDGED_BY_DRIVER =&gt; EMPTY,
    SESSION_ESTABLISHED =&gt; EMPTY
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendValidatedTrainData"
 Guid="5e8585ff-5096-4df7-a74d-9272db3f84cf"
>
<ReqRef
 Id="8b735562-2ede-429c-940c-7f53b0f6f675"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c76f8877-efbd-4800-b4d0-0be9f93c28fd"
>
</ReqRef><ReqRef
 Id="0aa692d6-e57e-48a1-929d-b3f3a51951bf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d24f2133-00f7-4fd4-9180-c9bafc9b71cf"
>
</ReqRef><ReqRef
 Id="4c109f90-966c-4202-93f8-a66c21964f25"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6192bf3a-a828-43bc-aff9-fb8bc84fe6d5"
>
</ReqRef><ReqRef
 Id="c394072b-5ccc-4f02-83ca-030f9a7b59d6"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fd4739ac-f629-470a-bc72-cdf7cfbeef99"
>
</ReqRef><ReqRef
 Id="3ac64b50-c74e-4254-be73-259fb5466b4f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="dc7b1350-2296-41c7-bf1f-9760b7d6dd73"
>
</ReqRef><ReqRef
 Id="7c52a141-a336-45c4-8933-e8521c8b7522"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="96beaa60-c788-47a9-8113-30cf0565860c"
>
</ReqRef><ReqRef
 Id="03f798fa-1890-4c9a-b975-9d37d4cbfd71"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6a52c3a5-ce83-44b6-8e64-cc9d991ca352"
>
</ReqRef><ReqRef
 Id="d00ed482-4e7b-4dc9-a857-b5fb171adf5b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b868e49e-7e87-4bef-8ecd-89c45e26dd4c"
>
</ReqRef><ReqRef
 Id="1d0a9f3a-05b9-496f-808f-1dc1ece5338f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9a7080b4-ccbb-44a0-96a3-43ef7a9ef12e"
>
</ReqRef><ReqRef
 Id="230ba662-a277-415f-bcf3-6add4edfc710"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9524d3d2-526b-4eea-9735-d509738dde8f"
>
</ReqRef><Comment>Sends the train data message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="511ff74f-c4b6-4b78-810c-99f0123510ee"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="2687b67a-4497-4efc-b70d-2d91183ff1bd"
>
<PreConditions>
<PreCondition
 Guid="43a64c64-9f21-4ab1-a3d9-84265343cd86"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="5e0b679f-e1cd-4f2e-a08e-c29838eb1d21"
>InitializeOutMessage()</Action><Action
 Guid="f26165a7-1b31-4afe-b6c9-ea1f49fa06de"
>MessageOut.VALIDATED_TRAIN_DATA &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.VALIDATED_TRAIN_DATA.Message
{
    NID_MESSAGE =&gt; 129,
    L_MESSAGE =&gt; 0,
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine,
    POSITION_REPORT =&gt; PositionReport.CreatePositionReport(),
    VALIDATED_TRAIN_DATA =&gt; TrainData.CreateTrainData()
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendEoMReport"
 Guid="ab89aa1a-870b-435e-9232-e0bed3a33834"
>
<ReqRef
 Id="3f735818-2dc8-4e4a-a842-9112c3e053a9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="21ee6751-35c3-4438-84e8-e4d7b17d623b"
>
</ReqRef><ReqRef
 Id="7b63a22c-a47e-4e98-87a7-bb6800dbb38e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e46bb61e-928d-4a62-8c22-bff1af3712ac"
>
</ReqRef><ReqRef
 Id="3178d11d-e209-47c2-ab1a-54caa8ca5545"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e79a48b8-726e-4fd0-bcd7-d2270ec25638"
>
</ReqRef><ReqRef
 Id="32e9bb4f-cc73-4be6-8a71-c4006cf68928"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e5948595-1a6b-476f-851e-b749574582aa"
>
</ReqRef><ReqRef
 Id="194a6507-f64b-4bf2-9881-d8497cb30d7a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3b5cb308-d93b-43c8-8eb3-cc3b770dc419"
>
</ReqRef><ReqRef
 Id="7e2d6d39-15b7-4051-b3d6-102637c8ee8c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8bca4f0a-e58c-4c28-88ba-0a98950bd9bd"
>
</ReqRef><ReqRef
 Id="6b12d15c-87f2-48ff-849a-2279b0777014"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6e712a5a-7062-4332-8512-27b007ccc13d"
>
</ReqRef><ReqRef
 Id="d3955e28-f016-43ba-aa05-ed187deb9195"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="29725e8b-3481-4f24-b563-6e1a6bb15b1d"
>
</ReqRef><Comment>Sends the End of Mission report message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="3eabc145-1193-4620-be32-ebc6cf35c2b4"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="144933fc-e9f1-4489-911e-e6bf16b8ad3b"
>
<PreConditions>
<PreCondition
 Guid="dcd16c79-c050-4122-bc72-ff483044e164"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="159f8be9-e901-46cd-b31a-91728b854d33"
>InitializeOutMessage()</Action><Action
 Guid="5d5990b8-a350-4843-9667-b01f3a4ae06c"
>MessageOut.END_OF_MISSION &lt;-Messages.MESSAGE.TRAIN_TO_TRACK.END_OF_MISSION.Message
{
    NID_MESSAGE =&gt; 150,
    L_MESSAGE =&gt; 0,
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine,
    POSITION_REPORT =&gt; PositionReport.CreatePositionReport()
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendRequestForShunting"
 Guid="bbf768a6-9eec-467b-b2ef-6470b3f72595"
>
<ReqRef
 Id="457bd04c-8b77-4ecc-b5ec-c4dbce5c1e53"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="376abddb-f246-4e20-8cd6-b3fb29cb373c"
>
</ReqRef><ReqRef
 Id="acf47cdb-9433-4fbe-b66f-419fece778bd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0a32a91e-6c50-4e85-9685-2830643a7e43"
>
</ReqRef><ReqRef
 Id="ec079598-670c-4c4c-9b4b-522eb377eacf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f51d6c92-1fb0-43d5-902e-9f67a1c2d8c8"
>
</ReqRef><ReqRef
 Id="ae8e9b38-1f8d-4043-9b1a-47e161fb1d55"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5921274b-a754-4ad7-92f2-095031860002"
>
</ReqRef><ReqRef
 Id="d6b2c059-6bf8-4097-bbec-0c06656b3e70"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="edd101eb-c1c2-4015-9110-0791773084e1"
>
</ReqRef><ReqRef
 Id="381e47f5-126e-425d-82ca-c6bd3f298786"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b6c0ee79-234a-4485-8ac4-4d6bbeeb2d20"
>
</ReqRef><ReqRef
 Id="f6a07df8-0a38-405a-ac82-e476c6f8f49b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="aef8d650-527d-47ed-bb67-e54467233740"
>
</ReqRef><ReqRef
 Id="4538d3bf-abc5-49c0-b3df-d7179bd3fe54"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7510bff0-cdae-41dd-bdac-ca8a29f83d09"
>
</ReqRef><Comment>Sends the Request for Shunting message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="aae94d1a-4576-49d7-ab43-e61a40efe9e9"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="31f1450c-9cfd-4568-8768-521f7b2f72e5"
>
<PreConditions>
<PreCondition
 Guid="90577e69-faf5-403a-8ad8-3b0225de321b"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="22e1fb48-7194-41fa-9413-884aed465214"
>InitializeOutMessage()</Action><Action
 Guid="7297c0d3-1229-4d0e-9a96-f81af5183fa9"
>MessageOut.REQUEST_FOR_SHUNTING &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.REQUEST_FOR_SHUNTING.Message
{
    NID_MESSAGE =&gt; 130,
    L_MESSAGE =&gt; 0,
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine,
    POSITION_REPORT =&gt; PositionReport.CreatePositionReport()
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendMARequest"
 Guid="605c5787-3cea-40e3-9541-b6fee56354ff"
>
<ReqRef
 Id="b74d1689-f942-4e2a-abdb-aa241f4f117f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="21b60f86-6bac-4cab-822c-a49daf822344"
>
</ReqRef><ReqRef
 Id="e0cc7640-41db-4f00-b6f3-086b5cf064f6"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="71895e28-aac6-4907-ba44-c8bec8872c2c"
>
</ReqRef><ReqRef
 Id="8de66288-ba8b-49f2-a9cc-e1cd1b848fa3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f2fa5f59-147d-452b-9d65-6e710b7e4a3b"
>
</ReqRef><ReqRef
 Id="562e9d9d-f160-4726-9fdd-0192ae0ac13a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a8d78ace-abbb-4447-9aca-0587ddc7f619"
>
</ReqRef><ReqRef
 Id="422bfd78-6a90-4d9b-8000-8670a93a76db"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d1d9e958-d593-476a-ae1d-44cc0139f325"
>
</ReqRef><ReqRef
 Id="00db9178-25bc-425f-9d84-def8931cd919"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="74acd841-63b3-4718-b30b-552fb19a9e5c"
>
</ReqRef><ReqRef
 Id="706d4b2b-fef4-4426-a33a-c820303c26bd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d43b367f-6567-40e0-a317-a51739f8a135"
>
</ReqRef><ReqRef
 Id="60fb8ae5-aecd-4fcf-aa69-ec41649b9c2f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7a5db18c-6c03-460a-801a-42c98f6947c8"
>
</ReqRef><ReqRef
 Id="c127eb4e-6c45-4dbe-8365-8279e347b15c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9b4d7c0c-688c-4e35-aaf3-58bfeea7b5e4"
>
</ReqRef><ReqRef
 Id="09bd805d-47dc-47e1-9489-e5fb2e24f885"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7b8139c8-9858-4f97-9ad4-60549457b180"
>
</ReqRef><ReqRef
 Id="4443416b-4b5b-4896-a845-222b762d3950"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="715b48c3-af70-479c-9314-7eaf9aa4bab2"
>
</ReqRef><Comment>Sends the MA request message, possibly with an additional packet (Packet 9: Level 2/3 transition information).</Comment>
<Parameters>
<Parameter
 Type="Messages.Q_MARQSTREASON"
 Name="aReason"
 Guid="5c0da812-a270-4cf0-b8e8-c58eb2c798db"
>
</Parameter><Parameter
 Type="Messages.PACKET.TRAIN_TO_TRACK.LEVEL_2_3_TRANSITION_INFORMATION.Message"
 Name="aPacket"
 Guid="efa70ad2-1b31-4fba-8e5b-1394f640af26"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="d3b68b75-987a-41d6-99f1-fb0772635b9e"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="4e0423b2-ff99-457f-bc39-7ee3fbd568f4"
>
<PreConditions>
<PreCondition
 Guid="48295035-e9ad-4544-9df0-05b1d725b286"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Fill the message"
 Guid="6a8d7932-914e-4d24-a047-ae5a2b06ff00"
>
<Comment>First, fill the fields of the message.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Fill the message"
 Guid="028126ab-0258-4ee6-819e-a978c06643da"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="bd0bff4f-a385-4604-9275-9ca2e8029bb5"
>InitializeOutMessage()</Action><Action
 Guid="f105e56b-cf2d-4016-b30e-0ea135442f31"
>MessageOut.MA_REQUEST &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.MA_REQUEST.Message
{
    NID_MESSAGE =&gt; 132,
    L_MESSAGE =&gt; 0,
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine,
    Q_MARQSTREASON =&gt; aReason,
    POSITION_REPORT =&gt; PositionReport.CreatePositionReport()
}</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Add the optional packet, if any"
 Guid="1e128daf-b918-4719-9653-73eb5ae01642"
>
<ReqRef
 Id="c2016b38-4117-4913-9885-bc04bda19872"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="eb2fb9bf-eb81-4102-b4e2-4be112bc2963"
>
</ReqRef><Comment>Then, add the optional packet, if any.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Add the optional packet, if any"
 Guid="ac36f825-e92f-4ee9-8831-a81f5a88f097"
>
<PreConditions>
<PreCondition
 Guid="2dd7f6aa-12b8-4aa9-8130-0d8662cb6f64"
>aPacket != EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="f44318cf-785d-4f2d-b554-9b4fc910b4f0"
>INSERT
Messages.MESSAGE.TRAIN_TO_TRACK.MA_REQUEST.SubStructure1
{
    LEVEL_2_3_TRANSITION_INFORMATION =&gt; aPacket
}
  IN
MessageOut.MA_REQUEST.Sequence1</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Update MA request parameters"
 Guid="9d1fd56f-96df-4f78-9cad-0936c95e17ac"
>
<ReqRef
 Id="b2206740-ee3b-42bc-9b69-b3ef064476be"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="cafe6bb4-a15b-4ea9-9165-f0ae350e5c42"
>
</ReqRef><Comment>Finally, if MA request parameters are stored on-board, the current time and the reason are stored in order to be able to resend the MA cyclically, if needed.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Update MA request parameters"
 Guid="a918565b-068a-41c0-8290-cc43a8c4ac0f"
>
<PreConditions>
<PreCondition
 Guid="3acc2481-ba85-4ccd-b7fc-ed2acaac77e7"
>Kernel.MA.MARequest.MARequestParameters != EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="d3ec36ee-64d3-4339-b85a-967e5ce5a6ca"
>Kernel.MA.MARequest.LastMARequestRepetitionTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="b5a94a6c-2159-44bd-9c71-7c81d6c057f9"
>Kernel.MA.MARequest.MARequestParameters.Reason &lt;- aReason</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendAcknowledgementOfEmergencyStop"
 Guid="e87a9d80-111c-45f9-832c-e6cafcf1c042"
>
<ReqRef
 Id="4f290d49-e10d-41ae-a385-d9a756df04d3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="90a03ff5-462d-42bf-9ca2-65cd7a0f9ed0"
>
</ReqRef><ReqRef
 Id="d0c52cba-95a5-4b9f-a459-f68e07f13e33"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="89bc609b-a585-404a-925c-8802256245c9"
>
</ReqRef><ReqRef
 Id="c99e85b2-17b6-42ce-9b97-dbb17591f957"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f3c5c499-cb3b-4646-855c-12e052a84523"
>
</ReqRef><ReqRef
 Id="353d80f7-d37e-4952-87d6-c993f0d146d7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9acaae9b-63e8-497b-bd35-7cf4a8476960"
>
</ReqRef><ReqRef
 Id="2021b9de-fee0-4e23-89ca-1093a14beb16"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4339af52-7d16-4261-9970-6f51ffefc24c"
>
</ReqRef><ReqRef
 Id="71443874-c4de-4da6-9d2f-f6668f13b126"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f275038e-5b5c-4727-8f81-5367d732ee64"
>
</ReqRef><ReqRef
 Id="077dae9c-0d63-4b59-b4e5-ac197edca727"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="12413d65-df03-40a1-a297-be7706affd45"
>
</ReqRef><ReqRef
 Id="9e5ae867-ff49-400d-8172-3bc629e506d6"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ce8097f1-6d77-4366-b987-6902b416ab6f"
>
</ReqRef><ReqRef
 Id="944df599-e5d3-4360-9b07-6e36bc0025f4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3c336995-6061-4022-923e-b9c7392134d9"
>
</ReqRef><ReqRef
 Id="1d5d1613-e3b5-4dc3-ac17-1785740b57a4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e5b22d91-4bc3-47a4-ad42-3bf8fb90337a"
>
</ReqRef><Comment>Sends the acknowledgement of emergency stop message.</Comment>
<Parameters>
<Parameter
 Type="Messages.MESSAGE.TRACK_TO_TRAIN.Message"
 Name="aMessage"
 Guid="7d4addf6-2d0c-478d-8a18-29d13281c06a"
>
</Parameter><Parameter
 Type="Messages.Q_EMERGENCYSTOP"
 Name="Qualifier"
 Guid="dbcb29cd-2b70-41c6-8e2a-39767e6620aa"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="ac03dd37-e4fd-465d-893a-8278a0376598"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Initialize message"
 Guid="61954d2d-de18-46d5-90c5-adb4d2c9e3ba"
>
<PreConditions>
<PreCondition
 Guid="b9bcf8d4-dd8a-4dbf-8d77-1f95a1ddbeae"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="3977b5c4-e5bf-434c-932e-ed4d7cff72f5"
>InitializeOutMessage()</Action><Action
 Guid="bf04e5dc-64f2-41c2-8382-b29798e0e305"
>MessageOut.ACKNOWLEDGEMENT_OF_EMERGENCY_STOP &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.ACKNOWLEDGEMENT_OF_EMERGENCY_STOP.Message
 {
    NID_MESSAGE =&gt; aMessage.CONDITIONAL_EMERGENCY_STOP.NID_MESSAGE,
    L_MESSAGE =&gt; 0,
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine,
    NID_EM =&gt; aMessage.CONDITIONAL_EMERGENCY_STOP.NID_EM,
    Q_EMERGENCYSTOP =&gt; Qualifier,
    POSITION_REPORT =&gt; PositionReport.CreatePositionReport()
 }</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendInitiationOfCommunicationSession"
 Guid="696d88ca-8c89-4d15-8686-73cc7ad795f2"
>
<ReqRef
 Id="1ead58b3-f05d-46bd-b3f8-bc0a16010cdd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4ea5e0d5-0e85-46a1-acd4-cda08bdc398a"
>
</ReqRef><ReqRef
 Id="58da8d69-4dcb-45db-96ea-d5985a650330"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="564ff098-736c-424c-a6b9-8ab1f4f34c0e"
>
</ReqRef><ReqRef
 Id="193e4ff3-c085-4881-89f4-4bba951aae20"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="19d0964b-09a8-46dd-ac20-133862b2d634"
>
</ReqRef><ReqRef
 Id="f122a1cb-426c-4f27-b1b2-521eeb9d7655"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="347b8598-d913-4c68-9f41-16e9c1d15889"
>
</ReqRef><ReqRef
 Id="974dafe8-70ad-409f-a13c-435c0f1b8be1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="21c07ed6-3de8-42ca-82ad-34d42e3f416e"
>
</ReqRef><ReqRef
 Id="4faba43d-d002-4947-afce-02a4abef7460"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f3095d51-c343-4d2f-a394-aafd8bf10422"
>
</ReqRef><ReqRef
 Id="9934dc4b-5b76-4e42-9f4c-b7efb6c87c30"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a044b5df-0fbc-45df-ab89-1fa05e3a2ce2"
>
</ReqRef><ReqRef
 Id="e5b845f3-54de-4120-8f98-f59e56625654"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6c24a0d9-b735-412a-a342-3b06b59d532a"
>
</ReqRef><Comment>Sends the initiation of communication session message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="fbc287fc-61e7-449e-9d9f-a7e57f921c47"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="ca61f4f9-df8c-4f72-9d2d-f52350d0ef01"
>
<PreConditions>
<PreCondition
 Guid="d112e636-6a6c-44a8-894b-ef7e12c2f473"
>ConnectionState in ConnectionStateSM.Connecting</PreCondition></PreConditions>
<Actions>
<Action
 Guid="e922975d-2e7e-4fb8-ae7b-2051e81118c1"
>InitializeOutMessage()</Action><Action
 Guid="5496a749-0788-45c7-917c-9edb136dfa0c"
>MessageOut.INITIATION_OF_A_COMMUNICATION_SESSION &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.INITIATION_OF_A_COMMUNICATION_SESSION.Message
{
    NID_MESSAGE =&gt; 155,
    L_MESSAGE =&gt; 0,
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendTerminationOfCommunicationSession"
 Guid="be6b5b3e-b56c-4f31-974d-943f13071346"
>
<ReqRef
 Id="bc41e5e5-6fff-4b96-a901-9bc45f108b16"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="693180ad-3698-4e96-a0da-37ed0402c784"
>
</ReqRef><ReqRef
 Id="a74ee6b4-a0ba-40bb-b83f-fd66efae3fb1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="748b65ee-f643-4256-8559-fa33ad0a4456"
>
</ReqRef><ReqRef
 Id="8c9ce563-d6d0-4490-a402-5a4bcf54598c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a9faee19-4354-4f80-b3df-4ae338698057"
>
</ReqRef><ReqRef
 Id="a4fe513a-ba78-4d81-a472-2d562542fef9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9c6e2d50-82c0-4dbe-9e82-d54508720b99"
>
</ReqRef><ReqRef
 Id="4d45f289-023e-4ed4-a8b2-f23bc5f23bbf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c18b279e-229b-49df-b38c-69ebe7b613f9"
>
</ReqRef><ReqRef
 Id="78ebe076-c514-44ee-869e-00b94b6a4377"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7f1bf4ed-1bd9-45ff-a356-468cfba43a0d"
>
</ReqRef><ReqRef
 Id="19c4b8ef-f85a-4b84-8eff-203e8b462604"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f29d8644-94fe-43a1-a707-057f05af3bff"
>
</ReqRef><ReqRef
 Id="2a8dff3a-71d3-4a6e-9d2b-85f6c568cd25"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="30c4a337-3b6c-4974-b6ea-bf3383053ae3"
>
</ReqRef><ReqRef
 Id="dc7b33b5-d923-42f3-be12-580edb475353"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="144418d9-5285-412c-b6fe-6933d99065b7"
>
</ReqRef><Comment>Sends the termination of communication session message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="abadcaa6-e65d-4b7d-bbcb-b0cfdae0dd85"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="8334b1bb-9709-4418-a6e3-507dd7a6b908"
>
<PreConditions>
<PreCondition
 Guid="84bd5198-9d19-4348-b537-6f637bae715f"
>MessageCanBeSent ( anRBC =&gt; THIS )
  OR
ConnectionState in ConnectionStateSM.Terminating</PreCondition></PreConditions>
<Actions>
<Action
 Guid="9025ba4e-91d5-4f92-8289-74df36138ac0"
>InitializeOutMessage()</Action><Action
 Guid="1069c60a-1628-4196-9f66-c7cb41b5fed5"
>MessageOut.TERMINATION_OF_A_COMMUNICATION_SESSION &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.TERMINATION_OF_A_COMMUNICATION_SESSION.Message
{
    NID_MESSAGE =&gt; 156,
    L_MESSAGE =&gt; 0,
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="ReinitializeCommunicationInformation"
 Guid="30fa714a-600a-440b-9bf9-ce5c3055c1ad"
>
<Comment>When a communicatino session is terminated, all the information is reset to default values.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Reinitialize communication information"
 Guid="6da01d9a-0a55-4ae4-be3e-0eb9708c6062"
>
<ReqRef
 Id="66901d6f-fcdd-4ddb-89e1-57f86cb9fcce"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3aab9954-d945-4ab9-813b-616cbd06538e"
>
</ReqRef><Comment>When a communicatino session is terminated, all the information is reset to default values.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Reinitialize communication information"
 Guid="1a9ebfb8-f176-4c4b-85c9-9b8a8acf5b77"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="2c770b25-75ef-4584-9ad0-ad6650c0cd3d"
>SessionManagementData.AcknowledgementOfTerminationReceived &lt;- False</Action><Action
 Guid="f86651e7-1ebb-49de-8053-907c88f5741d"
>NumberOfSentRequests &lt;- 0</Action><Action
 Guid="3d5afa42-b712-4474-af54-81ae258173b2"
>SessionManagementData.SystemVersion.DataState &lt;- Default.DataState.Unknown</Action><Action
 Guid="9687e639-b5c6-470d-813a-f17940cd2731"
>ConnectionLostTime &lt;- Default.BaseTypes.Time.Infinity</Action><Action
 Guid="ff4c1c3d-36bb-4e52-ae97-a17eabff757a"
>IsMainConnection &lt;- True</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendNoCompatibleVersionSupported"
 Guid="c63d1fde-96e0-4f01-a20e-6bbd5151c8af"
>
<ReqRef
 Id="25af834a-3a24-459b-b5c8-97b85eddb2e8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="61feaf2f-7590-4018-ae7b-a2db4d2e2ff4"
>
</ReqRef><ReqRef
 Id="a7e6ae33-fe52-489d-90a6-0563e959f98f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="283ef404-b315-4cdf-825d-1be794889951"
>
</ReqRef><ReqRef
 Id="180abffc-1e69-479f-9d27-b361a511b724"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="cc0c1cd7-4d71-4088-a4bd-0e68ad48cdc6"
>
</ReqRef><ReqRef
 Id="771097a5-70ee-4e32-ad57-cc3370e9c2df"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="22c694e3-c942-49dc-b73f-c9141ca87276"
>
</ReqRef><ReqRef
 Id="5fa92a17-4bdd-45f7-af50-8fb767b1f5df"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a899759e-6714-48e6-bb6e-08c17e851abb"
>
</ReqRef><ReqRef
 Id="be83abf1-33e3-48e8-81f5-7272786632ac"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="eabe68f3-c3db-4f70-ad3d-e559cb02333a"
>
</ReqRef><ReqRef
 Id="29ac8b57-887f-4420-8b7b-91bb1e505d65"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bc240a90-6151-4ff4-881a-ae5d89b497f6"
>
</ReqRef><ReqRef
 Id="e5b845f3-54de-4120-8f98-f59e56625654"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="cce15516-ff7d-484b-a528-4bb42e1adfea"
>
</ReqRef><Comment>Sends No ocmpatible version supported message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="1244adad-26bd-4648-a76e-d5556c06a19d"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="42bee79c-70ca-43ec-80e9-3f05cf18c656"
>
<PreConditions>
<PreCondition
 Guid="ccdbc887-50da-463a-8631-8c3ad89ca42a"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="85c99237-2ff3-4b7b-aacc-47f1527582f4"
>InitializeOutMessage()</Action><Action
 Guid="18250444-a45a-46a1-8101-7880251ca79d"
>MessageOut.NO_COMPATIBLE_VERSION_SUPPORTED &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.NO_COMPATIBLE_VERSION_SUPPORTED.Message
{
    NID_MESSAGE =&gt; 154,
    L_MESSAGE =&gt; 0,
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendSessionEstablishmentReport"
 Guid="8a87e368-0048-4948-a952-145ff82d525e"
>
<ReqRef
 Id="790cf49e-a85c-4110-b567-fc5d57052339"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="045a9dff-e27f-4410-881c-b9700ce1f271"
>
</ReqRef><ReqRef
 Id="83a95861-1254-445f-a687-abfbc0ecc275"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4d240a01-57cc-4941-a04c-f1e1ed34ec0a"
>
</ReqRef><ReqRef
 Id="6d607aea-ecdf-49ba-94cf-820077be16f5"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1b8a5425-07a4-445c-acc0-3b98fb6b1ed5"
>
</ReqRef><ReqRef
 Id="da48d790-6e99-4ede-b382-33683f89734e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="eb6ec88d-4649-4ada-a0cf-bb3600b0311a"
>
</ReqRef><ReqRef
 Id="034e6081-8324-46a4-8701-9547536400ac"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fb0890c2-c5fd-4dc0-84b1-379a8178fa4b"
>
</ReqRef><ReqRef
 Id="81482df6-4bcd-4d73-987a-cd90bcffe361"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2e2258c8-8ab4-4fe1-8b1d-23c16b3f57de"
>
</ReqRef><ReqRef
 Id="f5760847-4b49-4c61-8ca9-da687dc787ac"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="327d1585-08a4-4c5e-bc96-d78d15637c36"
>
</ReqRef><ReqRef
 Id="6db08158-68d4-49a4-9b0c-24890ae05196"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7363d3d4-1875-4ed8-aaf7-da8e9b75f604"
>
</ReqRef><Comment>Sends the Session establishment report message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="d4bdb090-dcbc-4828-9a82-becf0ea7fc4a"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="4500a613-abb9-4a56-838d-c3d8c4705256"
>
<PreConditions>
<PreCondition
 Guid="4b25cc29-6b61-46d2-b51e-3caa2964d74f"
>ConnectionState in ConnectionStateSM.Connecting</PreCondition></PreConditions>
<Actions>
<Action
 Guid="5e12d8df-0bef-46ba-98ed-6197ab27501a"
>InitializeOutMessage()</Action><Action
 Guid="1f5b8c56-d5aa-4705-8653-1f7558f6dad4"
>MessageOut.SESSION_ESTABLISHED &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.SESSION_ESTABLISHED.Message
{
    NID_MESSAGE =&gt; 159,
    L_MESSAGE =&gt; 0,
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine,
    Sequence1 =&gt;
    [
        Messages.MESSAGE.TRAIN_TO_TRACK.SESSION_ESTABLISHED.SubStructure1
        {
            ONBOARD_TELEPHONE_NUMBERS =&gt; Messages.PACKET.TRAIN_TO_TRACK.ONBOARD_TELEPHONE_NUMBERS.Message
            {
                NID_PACKET =&gt; 3,
                L_PACKET =&gt; 0,
                N_ITER =&gt; 1,
                Sequence1 =&gt;
                [
                    Messages.PACKET.TRAIN_TO_TRACK.ONBOARD_TELEPHONE_NUMBERS.SubStructure1
                    {
                        NID_RADIO =&gt; CurrentRBCConnection().ContactData.PhoneNumber
                    }
                ]
            }
        }
    ]
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="HandleIncomingMessage"
 Guid="89a51dbf-4fc4-4d63-ba49-4fbbe790cd0b"
>
<ReqRef
 Id="e65c9779-618e-4a55-97c9-4038b3410eaf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3ce70874-1784-4303-8bc6-c9c2fa9bf503"
>
</ReqRef><ReqRef
 Id="3460bc0e-8803-4236-bb1b-7b9af5863703"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="453f7d4a-8183-47b2-9ccc-4888875b989d"
>
</ReqRef><ReqRef
 Id="b09389ef-751e-4124-ab57-b53c0a663151"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="757d839e-f724-4a6f-b62d-2169e4a94c92"
>
</ReqRef><Comment>Messages from RBC received after sending of Termination of communication session message will be ignored, with the exception of the acknowledgement.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle the message, main connection"
 Guid="793eda9e-a531-433c-94ef-be464ca63d25"
>
<ReqRef
 Id="e65c9779-618e-4a55-97c9-4038b3410eaf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="252fa286-33c9-43a3-a814-aebe342d6794"
>
</ReqRef><Comment>Messages from the current RBC connection received after sending of Termination of communication session message will be ignored, with the exception of the acknowledgement.
...</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Verify connection state"
 Guid="349a4108-82e2-4fc6-933a-e986b67dae1b"
>
<ReqRef
 Id="e65c9779-618e-4a55-97c9-4038b3410eaf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="52304cbf-7742-4463-90b2-a73948410d0e"
>
</ReqRef><Comment>Messages from RBC received after sending of Termination of communication session message are ignored.</Comment>
<PreConditions>
<PreCondition
 Guid="e865f160-465a-4fa6-bbdf-5c4aa595c910"
>ConnectionState not in ConnectionStateSM.Terminating</PreCondition><PreCondition
 Guid="3609f99b-b750-45f6-867f-aa05ae489fbd"
>IsMainConnection</PreCondition><PreCondition
 Guid="17ba976d-ce42-46dc-bde1-e8c9dab8a0e3"
>IncomingMessageIsConsistent(MessageIn)</PreCondition><PreCondition
 Guid="0fc0e74a-540a-4b62-9910-5cf32bab4dde"
>DataPriorityCorrect(MessageIn)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="7ffe8131-5392-4ec9-a32e-1ad7d3cb2dcd"
>ProcessIncomingMessages(MessageIn.Message)</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Handle acknowledgement of termination of a communication session"
 Guid="313b2e1d-ce81-4e1e-bf2a-6f185ff186e5"
>
<ReqRef
 Id="e094e23a-bd94-4440-8632-705782494f35"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0141b397-5b8f-402c-92b8-41bee6291e33"
>
</ReqRef><ReqRef
 Id="6091731d-92bd-4133-aff2-790f6f482dbf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3077900e-74bb-4e07-b78f-4d66a5db417d"
>
</ReqRef><Comment>Handles reception of termination of a communication session.</Comment>
<PreConditions>
<PreCondition
 Guid="ced76e36-5c43-4286-9d04-213366e1c8a1"
>Available ( MessageIn.Message.ACKNOWLEDGEMENT_OF_TERMINATION_OF_A_COMMUNICATION_SESSION )</PreCondition><PreCondition
 Guid="13c1cfb4-786f-44c7-ab3b-d1905d1357a7"
>IsMainConnection</PreCondition><PreCondition
 Guid="124fea1a-3ab9-46f0-8558-fed84187bc70"
>IncomingMessageIsConsistent(MessageIn)</PreCondition><PreCondition
 Guid="47c9872f-d4f9-4b00-a1d9-e7deb93b84b7"
>DataPriorityCorrect(MessageIn)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="757ae52c-3581-4ad8-bd4d-bdc6a6dad180"
>HandleAcknowledgementOfTerminationOfACommunicationSession ( aMessage =&gt; MessageIn.Message.ACKNOWLEDGEMENT_OF_TERMINATION_OF_A_COMMUNICATION_SESSION )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle the message, secondary connection"
 Guid="5c981443-a14c-4e1a-8735-d1cb8b04caf0"
>
<Comment>Handles messages from the secondary connection.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="First position report not sent yet"
 Guid="6b911e1b-a6d2-41f8-bc49-863eea9699de"
>
<ReqRef
 Id="c887c56e-758e-426a-a728-cf723b3b2baf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="050dc9f6-b1e6-4344-adb0-a3e638388d19"
>
</ReqRef><Comment>Before the first position report due to RBC/RBC handover is sent, the secondary connection is the Accepting RBC. The messages have to be stored on-board, except the acknowledgement of Train Data.</Comment>
<PreConditions>
<PreCondition
 Guid="463e0b98-b0fb-4545-a160-7e6de88c2d9d"
>Kernel.TrainPosition.FrontEndPosition ( PointOfInterest =&gt; Default.DistanceInterval.Max ) &lt; PositionReport.RBCTransitionLocation</PreCondition><PreCondition
 Guid="91826cfb-7c30-4aa3-b40e-60bf92efdbca"
>NOT IsMainConnection</PreCondition><PreCondition
 Guid="885cc8be-6c21-4bda-af80-c9e89caad95a"
>IncomingMessageIsConsistent(MessageIn)</PreCondition><PreCondition
 Guid="3ad5497d-99a8-4f54-837f-9d7aef66701b"
>DataPriorityCorrect(MessageIn)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="9e032a8e-c56d-4362-b6ed-8d69f6620598"
>INSERT MessageIn.Message IN MessagesToHandle</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle Train Data acknowledgement"
 Guid="51fa5900-7010-4dca-b3cc-08c3f6886630"
>
<Comment>The Acknowledgement of Train Data has to be handled immediately.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle Train Data Acknowledgement"
 Guid="6fe69e0b-d4f0-4061-b4c4-34bc6daddbdb"
>
<PreConditions>
<PreCondition
 Guid="1ca3c59e-b767-47ad-8622-1b9ce4436495"
>Available ( Element =&gt; MessageIn.Message.ACKNOWLEDGEMENT_OF_TRAIN_DATA )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="7e16bf07-3f0a-476e-a107-bf3d03af299e"
>HandleAcknowledgementOfTrainData ( aMessage =&gt; MessageIn.Message.ACKNOWLEDGEMENT_OF_TRAIN_DATA )</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="First position report already sent"
 Guid="496a5d78-6a20-49a1-9572-f8ac5ae7b450"
>
<ReqRef
 Id="1b789c83-4922-4842-985f-3dd14ff0843d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="45490b43-c530-4c9c-af76-d82adbf7e8d9"
>
</ReqRef><Comment>After the sending of the first position report due to RBC/RBC handover, the secondary connection becomes the Handing Over RBC. In that case, only the disconnection orders are accepted.</Comment>
<PreConditions>
<PreCondition
 Guid="98ea9a9c-2ee4-4e8e-a1df-abd25b493ec0"
>NOT IsMainConnection</PreCondition><PreCondition
 Guid="560e0917-ea2b-4726-bb4f-913cb848a16e"
>IncomingMessageIsConsistent(MessageIn)</PreCondition><PreCondition
 Guid="314a1df3-6c27-4b22-b69f-1e8281322d0b"
>DataPriorityCorrect(MessageIn)</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle the disconnection order"
 Guid="b98ea8f8-a508-4cf8-aaa8-ed78fd5a12b4"
>
<Comment>A disconnection order can be sent in three messages: Movement Authority, General Message and MA With Shifted Location Reference.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Order in Movement Authority message"
 Guid="760a6832-048d-4208-91aa-388e7cdb87a4"
>
<Comment>Handling of disconnection order in Movement Authority message.</Comment>
<PreConditions>
<PreCondition
 Guid="786fa238-2b10-4508-9829-45e25ef541e2"
>Available ( MessageIn.Message.MOVEMENT_AUTHORITY )
  AND
THERE_IS X IN MessageIn.Message.MOVEMENT_AUTHORITY.Sequence1 | Available
(
    Element =&gt; X.SESSION_MANAGEMENT
)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="7db46596-2bec-4dca-b309-8c30a034a2a6"
>TracksideOrderedSessionReceived
(
    Packet =&gt; ( FIRST X IN MessageIn.Message.MOVEMENT_AUTHORITY.Sequence1 | Available ( X.SESSION_MANAGEMENT ) ).SESSION_MANAGEMENT
)</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Order in General Message"
 Guid="857cc6b1-a698-4968-ab9f-96a153e2bd77"
>
<Comment>Handling of disconnection order in General Message.</Comment>
<PreConditions>
<PreCondition
 Guid="8df7c3e8-4f00-4b37-a191-70653e26c0cb"
>Available ( MessageIn.Message.GENERAL_MESSAGE )
  AND
THERE_IS X IN MessageIn.Message.GENERAL_MESSAGE.Sequence1 | Available
(
    Element =&gt; X.SESSION_MANAGEMENT
)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="14902768-9399-4452-99ff-ce813a430af4"
>TracksideOrderedSessionReceived
(
    Packet =&gt; ( FIRST X IN MessageIn.Message.GENERAL_MESSAGE.Sequence1 | Available ( X.SESSION_MANAGEMENT ) ).SESSION_MANAGEMENT
)</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Order in MA with Shifted Location Reference"
 Guid="d375a108-7e45-4298-9e35-d9fb41c886b8"
>
<Comment>Handling of disconnection order in MA With Shifted Location Reference message.</Comment>
<PreConditions>
<PreCondition
 Guid="63d1690a-2f49-4ed2-b728-5a1d0b746001"
>Available ( MessageIn.Message.MA_WITH_SHIFTED_LOCATION_REFERENCE )
  AND
THERE_IS X IN MessageIn.Message.MA_WITH_SHIFTED_LOCATION_REFERENCE.Sequence1 | Available
(
    Element =&gt; X.SESSION_MANAGEMENT
)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="84c889be-4150-4fb0-a74e-cd11567c7278"
>TracksideOrderedSessionReceived
(
    Packet =&gt; ( FIRST X IN MessageIn.Message.MA_WITH_SHIFTED_LOCATION_REFERENCE.Sequence1 | Available ( X.SESSION_MANAGEMENT ) ).SESSION_MANAGEMENT
)</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Keep timestamp for supervision"
 Guid="a713a2d5-8b62-4c0d-92d8-0ce7908df6ef"
>
<ReqRef
 Id="1d7817dd-686d-4c09-9e56-ef8943a94858"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3776e903-3b0c-40c0-80be-f6a56da8df66"
>
</ReqRef><ReqRef
 Id="60e39a2f-4380-44e7-bf85-7142748b200f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c9f4b0a4-a607-470a-8bcc-49c0eef05e0b"
>
</ReqRef><Comment>Save the timestamp of the received message (if it is consistent) for the consistency check of the next meqssage from the RBC.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Keep timestamp for supervision"
 Guid="263fdc86-2143-4ff6-8ac5-987550018109"
>
<PreConditions>
<PreCondition
 Guid="7e373e36-9cfd-4bd6-ae02-19c507b789ff"
>IncomingMessageIsConsistent(MessageIn)</PreCondition><PreCondition
 Guid="f35e5a44-14bb-4e4e-99ac-d7b833940825"
>DataPriorityCorrect(MessageIn)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="9de404b1-57c9-4a5f-83ae-aaca1042dd85"
>OnboardReference_MessageTimer &lt;- Kernel.DateAndTime.CurrentTime</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Report inconsistent message received"
 Guid="18b429d9-582f-48d6-b076-78003e302fd9"
>
<Comment>If the message received from the RBC is not consistent, immediately report it.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Report inconsistent message received"
 Guid="9ecfef4f-2137-4d03-a035-8174b9e4eaef"
>
<ReqRef
 Id="4aa64d47-8749-4bf5-b24e-7831ff609718"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c7b38686-c4f0-4142-8198-1d9b0b514a07"
>
</ReqRef><PreConditions>
<PreCondition
 Guid="7e8d9ecc-51a7-4a36-8fd8-d391aca111ae"
>Available(MessageIn)
  AND  
NOT IncomingMessageIsConsistent(MessageIn)</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Initialize position report"
 Guid="7958e2ce-e701-48cf-9a15-6bfa2e7774a9"
>
<Comment>Create the position report that will transmit the error report.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Initialize position report"
 Guid="07c2bb1d-41c5-4f3d-8e5a-483b56e985ec"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="ed9fd0da-6277-4b0a-a9bb-c623f7028d89"
>SendPositionReport()</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Add error packet"
 Guid="0f32316b-066d-479f-a711-b3a56eef1e95"
>
<Comment>Insert the error report in the position report.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Add error packet"
 Guid="2c8d40a3-c5ca-4352-adaa-bbbe23e16494"
>
<PreConditions>
<PreCondition
 Guid="e2742dfc-99b4-4a3e-aacf-41d5f195ccf0"
>Available(MessageOut.TRAIN_POSITION_REPORT)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="fde6857a-8e77-4276-8985-1fb52d774b29"
>INSERT Messages.MESSAGE.TRAIN_TO_TRACK.TRAIN_POSITION_REPORT.SubStructure1{
    ERROR_REPORTING =&gt; Messages.PACKET.TRAIN_TO_TRACK.ERROR_REPORTING.Message{
        NID_PACKET =&gt; 4,
        L_PACKET =&gt; 0,
        M_ERROR =&gt; Messages.M_ERROR.Radio__message_consistency_error__ref__3_16_3_1_1a_c
    }
}
 IN MessageOut.TRAIN_POSITION_REPORT.Sequence1</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="ExecuteEndOfMission"
 Guid="292a1d52-1c62-46fc-a077-ac5027eb68a7"
>
<ReqRef
 Id="7b63a22c-a47e-4e98-87a7-bb6800dbb38e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7b12f4c7-3107-4180-a871-10d466cc44a7"
>
</ReqRef><ReqRef
 Id="d59dd844-f144-4d73-a4eb-ba5f21dd2958"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="69eb59c6-0a56-4952-8659-c52cdd652c74"
>
</ReqRef><ReqRef
 Id="e86b435b-86a1-4af1-a9af-e87aaca847d9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1de7a7e7-2302-4b8e-af92-b8ff286e5fef"
>
</ReqRef><ReqRef
 Id="b9145b48-24bf-42d2-a2ad-8283dc888f3b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="abbdde41-a097-4937-a20d-927518277c53"
>
</ReqRef><Comment>When the End of Mission procedure has to be executed, the on-board sends an End of Mission Position Report and a Termination of Communication Session message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Send End of Mission"
 Guid="ed84ed3f-68ec-4db0-a48b-fae5b849e628"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Send End of Mission"
 Guid="4c198df6-1a24-4699-91e2-0034081e9dbc"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="fee0628a-3a16-4a1e-b4b7-32307d0154e3"
>SendEoMReport()</Action><Action
 Guid="ae7a5d9a-f7cc-436a-8054-cca8f1ca33a5"
>LastRequestTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="77ff829d-067e-4e88-b189-763cb81bc53e"
>NumberOfSentRequests  &lt;- 0</Action><Action
 Guid="a61347f3-f3e0-46cb-9ece-aeb8eb30cdee"
>ConnectionState &lt;- ConnectionStateSM.Terminating</Action><Action
 Guid="863a5254-6b4f-4f17-ab0c-6b95df8f5d02"
>SendTerminationOfCommunicationSession()</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="HandleAcknowledgementOfTerminationOfACommunicationSession"
 Guid="02f670d2-b6dc-4079-80e8-8a75a9da20bc"
>
<ReqRef
 Id="e094e23a-bd94-4440-8632-705782494f35"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7f014caa-eade-494b-9fcd-4a5adf0777d8"
>
</ReqRef><ReqRef
 Id="2a8dff3a-71d3-4a6e-9d2b-85f6c568cd25"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="945ce21f-e5eb-4ed2-b142-5559468f4524"
>
</ReqRef><Comment>Indicates that the acknowledgement has been received.</Comment>
<Parameters>
<Parameter
 Type="Messages.MESSAGE.TRACK_TO_TRAIN.ACKNOWLEDGEMENT_OF_TERMINATION_OF_A_COMMUNICATION_SESSION.Message"
 Name="aMessage"
 Guid="5cd96caa-1ee6-45dc-8552-8ef78ae617ef"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Indicate acknowledgement has been received"
 Guid="7f048ded-c30c-4e8a-8802-a96f2cadca26"
>
<Comment>Indicates that the acknowledgement has been received.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Indicate acknowledgement has been received"
 Guid="80443d2e-265f-4f6e-b114-a68aeca1f97b"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="7073da78-58f0-4a39-ae89-49ca19eb62dd"
>SessionManagementData.AcknowledgementOfTerminationReceived &lt;- True</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendTrackAheadFreeGranted"
 Guid="167f10b4-b529-4073-83bc-4df57fffd309"
>
<ReqRef
 Id="39d3a3da-a2a7-44e3-858d-5549ecf03336"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c6b0d226-5b1a-477c-9f80-1a73d75053fb"
>
</ReqRef><ReqRef
 Id="2d050b09-6a5c-4bb4-bf0f-c438a6b5741c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6d2bf641-a024-40f4-80a6-e1fdc672cac9"
>
</ReqRef><ReqRef
 Id="aebab1a5-d7eb-4483-b1fb-4d494d19ece9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="48d5c8c3-a5a5-44f2-b124-049708e5088f"
>
</ReqRef><ReqRef
 Id="73d010ae-6637-4f5a-aa4c-0b6dbe9f3c2a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="30f1f916-3437-462c-87f2-b1cf593fdf44"
>
</ReqRef><ReqRef
 Id="14cdaf65-b7b4-48bd-be26-ab3a6c03f33b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="32465574-b76a-4827-a592-9f5c8345a3b8"
>
</ReqRef><ReqRef
 Id="14a35615-f26c-4b61-a906-f2e64cb6ac19"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="31e044d3-5c9f-4776-a40c-e2280606c35c"
>
</ReqRef><ReqRef
 Id="81e40582-8c1f-4854-b6a4-c389c5b3ff6b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="765d7cfe-1765-409b-aece-3ba32bb647fc"
>
</ReqRef><Comment>Sends the track ahead free granted message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="143ae29d-9939-4a1a-8d9d-ee90dc49c9de"
>
<Comment>If the outgoing message is EMPTY, it has to be initialized and then the corresponding field is filled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="08ff094e-8ba2-4537-9dfb-ee1b9b6a2686"
>
<PreConditions>
<PreCondition
 Guid="fb4f6985-6111-40cd-b353-065cc84a8954"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="6a3a929b-edfd-4e1a-9442-0bbac9df7970"
>InitializeOutMessage()</Action><Action
 Guid="2091b658-8d3c-4f9f-8a7c-27a0abad7399"
>MessageOut.TRACK_AHEAD_FREE_GRANTED &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.TRACK_AHEAD_FREE_GRANTED.Message
{
    NID_MESSAGE =&gt; 149,
    L_MESSAGE =&gt; 0,
    T_TRAIN =&gt; Default.MessageTypes.UnResolveTime(Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine,
    POSITION_REPORT =&gt; PositionReport.CreatePositionReport()
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendRequestToShortenMAIsGranted"
 Guid="916f41b1-9578-4f84-a30a-18ac768afdf1"
>
<ReqRef
 Id="a923ad08-9cd1-4b6d-9132-8fec6102d784"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="558e6797-585a-4acd-9c4f-041e9e755f25"
>
</ReqRef><ReqRef
 Id="bc02069a-b3f9-44d3-ae1b-fb27d71bb51d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4e19e7f6-aee9-4cfc-ab6c-49e400eceb39"
>
</ReqRef><ReqRef
 Id="26d39c75-1c24-46e6-b725-d71bd2fbd1c3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d76a2c81-7b86-4250-9ad8-5f6a454270be"
>
</ReqRef><Comment>Sends the message indicating that the shortened MA is granted.</Comment>
<Parameters>
<Parameter
 Type="Default.MessageTypes.Time"
 Name="TimeStamp"
 Guid="54af5444-8191-4280-b5d4-60f99316da84"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="ad27e878-f406-4859-9052-1e5e67ff13e0"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="1555cd5a-31ed-4158-9b54-734b377c6843"
>
<PreConditions>
<PreCondition
 Guid="1d902fe6-ea84-4af6-bbaa-8fd69eb809c1"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="43edf13b-9cdd-474c-85b2-dc247f443bbe"
>InitializeOutMessage()</Action><Action
 Guid="74740856-044d-4604-8674-3d69b129c01e"
>MessageOut.REQUEST_TO_SHORTEN_MA_IS_GRANTED &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.REQUEST_TO_SHORTEN_MA_IS_GRANTED.Message
{
    NID_MESSAGE =&gt; 137,
    L_MESSAGE =&gt; 0,
    T_TRAIN_0 =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine,
    T_TRAIN_1 =&gt; TimeStamp,
    POSITION_REPORT =&gt; PositionReport.CreatePositionReport()
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendRequestToShortenMAIsRejected"
 Guid="1abc60a8-acf1-4bc2-954a-7e07f6a59848"
>
<ReqRef
 Id="e69fe417-33db-4400-94f9-091961d6b6db"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="64906c5e-acbf-4395-a785-2de200f06078"
>
</ReqRef><ReqRef
 Id="bc02069a-b3f9-44d3-ae1b-fb27d71bb51d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6a7cf521-7ad3-41b5-835b-452c06923fef"
>
</ReqRef><ReqRef
 Id="26d39c75-1c24-46e6-b725-d71bd2fbd1c3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c5b153d8-1e29-4b1a-ac7a-7d2d26432f6d"
>
</ReqRef><Comment>Sends the message indicating that the shortened MA is rejected.</Comment>
<Parameters>
<Parameter
 Type="Default.MessageTypes.Time"
 Name="TimeStamp"
 Guid="b9c1c363-b714-43c5-ac5d-f3de0a693de2"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="39f84bff-762f-4177-b2aa-20a9830468b7"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="adb017a3-df0e-4a22-97b3-436cfc410548"
>
<PreConditions>
<PreCondition
 Guid="587bce12-1b33-45d4-b051-bd8e6b1c2816"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="7ed237dc-daab-4130-b9a9-b5705be38e8f"
>InitializeOutMessage()</Action><Action
 Guid="161b0fe4-e5f5-4031-ad42-d8dead2fea9a"
>MessageOut.REQUEST_TO_SHORTEN_MA_IS_REJECTED &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.REQUEST_TO_SHORTEN_MA_IS_REJECTED.Message
{
    NID_MESSAGE =&gt; 138,
    L_MESSAGE =&gt; 0,
    T_TRAIN_0 =&gt; Default.MessageTypes.UnResolveTime( time =&gt; Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine,
    T_TRAIN_1 =&gt; TimeStamp,
    POSITION_REPORT =&gt; PositionReport.CreatePositionReport()
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="SendAcknowledgement"
 Guid="5d25b1f2-cf06-4ccd-8467-10627a2f69af"
>
<ReqRef
 Id="3f4bddf9-98d3-42ec-9139-6a3d3913523d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="308b6d7c-a65b-4495-869d-2d3f5c745994"
>
</ReqRef><ReqRef
 Id="02322d02-1657-4293-b17b-850ddc3cdbf7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b4703f71-83c5-4437-a1b4-79ba5f6e919b"
>
</ReqRef><ReqRef
 Id="f0cff7f6-c343-4e75-93c6-27833baf0a36"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="06f9ad8a-1821-43e5-8131-5cf822a915be"
>
</ReqRef><ReqRef
 Id="5d32be4c-e8c6-495c-851d-1b636031e4a8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ae0a8eee-5b3c-4237-903f-d06e9c481c83"
>
</ReqRef><Comment>Sends the acknowledgement of the received message.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Initialize output message"
 Guid="b3ca7648-8b67-4709-95ee-2f8cfb9a8c27"
>
<Comment>Create an empty train-to-track message in MessageOUT.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Initialize output message"
 Guid="897b44be-ccb7-4af5-8179-0f67f9261cdf"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="9f3b3517-56d9-4c9b-9039-5b24f08109fd"
>InitializeOutMessage()</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="3f90535c-78a3-42c5-ba47-d02d698b3b5f"
>
<Comment>Add a position report to the output message.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle sending of the message"
 Guid="3fdc81ad-8e6a-4e7a-8483-2694026f8fd0"
>
<PreConditions>
<PreCondition
 Guid="11fd9486-6ef6-4899-acc4-0a5d5647da68"
>MessageCanBeSent ( anRBC =&gt; THIS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="bf147e3b-7386-4f94-9725-2f8ca11d85bf"
>MessageOut.ACKNOWLEDGEMENT &lt;- Messages.MESSAGE.TRAIN_TO_TRACK.ACKNOWLEDGEMENT.Message{
    NID_MESSAGE =&gt; 146,
    L_MESSAGE =&gt; 0,
    T_TRAIN_0 =&gt; Default.MessageTypes.UnResolveTime(Kernel.DateAndTime.CurrentTime),
    NID_ENGINE =&gt; Kernel.NidEngine,
    T_TRAIN_1 =&gt; Messages.MESSAGE.TRACK_TO_TRAIN.GetT_TRAIN(MessageIn.Message)
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure></Procedures>
<StructureElement
 TypeName="InMessageStruct"
 Default="EMPTY"
 Mode="InOut"
 Implemented="TRUE"
 Name="MessageIn"
 Guid="cdeef650-7114-4f12-8bfd-c8962d8ff0a2"
>
<Comment>Represents the message received from the current RBC. If no message is received, the structure is EMPTY.</Comment>
</StructureElement><StructureElement
 TypeName="Messages.MESSAGE.TRAIN_TO_TRACK.Message"
 Default="EMPTY"
 Mode="InOut"
 Implemented="TRUE"
 Name="MessageOut"
 Guid="19cbc992-30ef-4db9-a8d2-4816992c1126"
>
<Comment>Represents the message to send to the current RBC. If no message has to be sent, the structure is EMPTY.</Comment>
</StructureElement><StructureElement
 TypeName="RBCContactStruct"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 Name="ContactData"
 Guid="f619c693-9b6c-44b9-9e47-28d4270e994f"
>
<ReqRef
 Id="becb430f-a4f2-4817-ad08-3672ed05f855"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e994975e-ef44-45ee-9520-410116dd431c"
>
</ReqRef><Comment>Identifier of the RBC.</Comment>
</StructureElement><StructureElement
 TypeName="ConnectionStateSM"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 Name="ConnectionState"
 Guid="9da35b1e-5a10-49fe-97e2-9344ea080d37"
>
<Comment>The state machine of the current connection.</Comment>
</StructureElement><StructureElement
 TypeName="SafeRadioConnectionStatusEnum"
 Default="SafeRadioConnectionStatusEnum.NoConnection"
 Mode="Internal"
 Implemented="TRUE"
 Name="SafeRadioConnectionStatus"
 Guid="ea1f0ade-0a84-48f2-a86e-2206d337446f"
>
<Comment>The safe radio connection status.</Comment>
</StructureElement><StructureElement
 TypeName="ContactOrderStruct"
 Default="EMPTY"
 Mode="Internal"
 Implemented="TRUE"
 Name="ContactRBCOrder"
 Guid="2007b98c-b3ea-412e-8bcf-fb463d719de4"
>
<Comment>Provides the order to contact the RBC, if any.</Comment>
</StructureElement><StructureElement
 TypeName="SessionManagementStruct"
 Default=""
 Mode="InOut"
 Implemented="TRUE"
 Name="SessionManagementData"
 Guid="1ca4ec93-c578-45ad-bbdb-e44c71c1f9aa"
>
<Comment>Data needed to establish a communication session.</Comment>
</StructureElement><StructureElement
 TypeName="Default.BaseTypes.Time"
 Default="0.0"
 Mode="Internal"
 Implemented="TRUE"
 Name="LastRequestTime"
 Guid="40e6ba54-d9c4-498d-88f2-2ffb1157f4aa"
>
<ReqRef
 Id="4d7758a5-c99b-4537-8da4-a51b99dafd40"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bab219e0-b46d-46fd-be2a-82ffdd8f005b"
>
</ReqRef><ReqRef
 Id="f9f81d1e-22c3-429b-b29b-0c828790dce4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="767ac768-3af2-4dda-a34e-567d3ec88d66"
>
</ReqRef><ReqRef
 Id="dc7b33b5-d923-42f3-be12-580edb475353"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ee51afb8-0e5a-4f32-8ea4-caafa9b45e04"
>
</ReqRef><Comment>Indicates the last time when a request to establish or terminate the communication session with the RBC was sent.</Comment>
</StructureElement><StructureElement
 TypeName="Integer"
 Default="0"
 Mode="Internal"
 Implemented="TRUE"
 Name="NumberOfSentRequests"
 Guid="03f193b2-8aea-4f04-b805-1de34a4398f8"
>
<ReqRef
 Id="f9f81d1e-22c3-429b-b29b-0c828790dce4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="aac10df8-63e1-42d5-9335-efaf72d6b142"
>
</ReqRef><Comment>Number of sent requests, that can be:
- establishing of  a safe radio connection
- termination the communication session</Comment>
</StructureElement><StructureElement
 TypeName="Default.BaseTypes.Time"
 Default="Default.BaseTypes.Time.Infinity"
 Mode="Internal"
 Implemented="TRUE"
 Name="ConnectionLostTime"
 Guid="d86fbc28-bf85-4e5a-af79-2137ad0751e1"
>
<ReqRef
 Id="308624ea-ea91-4451-b8c4-1cfbc9094f8e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2fb8ed15-5aa3-49bf-9b22-53d86b89aae0"
>
</ReqRef><ReqRef
 Id="cd18a937-9dc2-456d-bee7-a61bcd564e32"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="54b058ba-2130-451d-9219-0522297724ca"
>
</ReqRef><Comment>Stores the time when the safe radio connection has been lost.</Comment>
</StructureElement><StructureElement
 TypeName="SpecialCaseSessionEstablishmentReasonEnum"
 Default="SpecialCaseSessionEstablishmentReasonEnum.DoNotEstablish"
 Mode="Internal"
 Implemented="TRUE"
 Name="SpecialCaseSessionEstablishmentReason"
 Guid="19025708-2326-463f-8934-0ac263dc7feb"
>
<Comment>If a communication session has to be established, this variable indicates why it has to be estabilshed.</Comment>
</StructureElement><StructureElement
 TypeName="Boolean"
 Default="True"
 Mode="Internal"
 Implemented="TRUE"
 Name="IsMainConnection"
 Guid="444f2d37-dd13-4003-a447-b57d250c6b4a"
>
<Comment>In case of RBC/RBC handover with two simultaneous connections, this flag indicates which RBC is the main one. In the beginning of the handover the main RBC is the Handing Over RBC, but after the transfer of train supervision to the Accepting RBC, the latter becomes the main RBC.</Comment>
</StructureElement><StructureElement
 TypeName="BaseTypes.Time"
 Default="Default.BaseTypes.Time.NA"
 Mode="Internal"
 Implemented="TRUE"
 Name="OnboardReference_MessageTimer"
 Guid="04f1ba30-9faf-4c6f-a81d-5a49dfd07edd"
>
<ReqRef
 Id="60e39a2f-4380-44e7-bf85-7142748b200f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ace62bac-0b7b-47f3-9f4d-727603211e5a"
>
</ReqRef><ReqRef
 Id="42342bff-4561-490e-beae-73b88476afe8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="09524587-c0ee-412d-94ee-161be904cd21"
>
</ReqRef><ReqRef
 Id="1d7817dd-686d-4c09-9e56-ef8943a94858"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9ee492c9-a4c1-4627-aa3f-e53382a3af1d"
>
</ReqRef><ReqRef
 Id="24ab9b8d-19b6-48f1-8762-46dbc0b3a225"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0111afde-b354-4430-8142-f531d55cc167"
>
</ReqRef></StructureElement><StructureElement
 TypeName="Boolean"
 Default="True"
 Mode="Internal"
 Implemented="TRUE"
 Name="ContactTimerSupervised"
 Guid="519d8ab1-f4fd-401d-8a72-2c490c24fa2e"
>
<ReqRef
 Id="88cc77ff-7146-4934-be41-451d8f3ce0bd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bee59af2-52dd-4958-bac2-504a0b82d537"
>
</ReqRef><Comment>Indicates whether supervision of T_NVCONTACT is active.</Comment>
</StructureElement><StateMachines>
<StateMachine
 Default="ConnectionStateSM.Inactive"
 Implemented="TRUE"
 Name="ConnectionStateSM"
 Guid="d82fd57c-5e3b-49a3-9588-9ba0c3633131"
>
<Comment>Handles the different processes of the connection according to its current state.</Comment>
<States>
<State
 X="180"
 Y="70"
 Width="100"
 Height="200"
 Implemented="TRUE"
 Name="Inactive"
 Guid="d33370b3-b877-475d-b1da-b15d3eaca819"
>
<Comment>No connection is established.</Comment>
<StateMachine
 Default="ConnectionStateSM.Inactive.InitialState"
 Implemented="TRUE"
 Guid="691e3286-67ef-4b68-b4c9-5aa0ce8e8788"
>
<States>
<State
 X="80"
 Y="100"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="InitialState"
 Guid="ede13b67-2ab3-46d5-b5d4-8351b7cdd624"
>
<Comment>When the state machine goes to inactive state, all the previously used information has to be reset to initial values.</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="f74552ab-4f62-44b7-a9fe-3f5a0bac2ccd"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Initialize data"
 Guid="f1311ac8-e7e8-43aa-be23-ac629849efc8"
>
<ReqRef
 Id="66901d6f-fcdd-4ddb-89e1-57f86cb9fcce"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3bc3cb12-e2ed-441b-8c14-758f32f5b0dc"
>
</ReqRef><Comment>Sets all the previously used information to its default values.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Initialize data"
 Guid="0fe3e98e-578d-467b-a89e-85d72e0cc456"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="f93ec21b-cae5-40cb-a111-eb24e0fe252a"
>THIS &lt;- ConnectionStateSM.Inactive.WaitForConnectionRequest</Action><Action
 Guid="33b79703-10dd-46c9-945b-43bf5f8746b1"
>ReinitializeCommunicationInformation()</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State><State
 X="400"
 Y="100"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="WaitForConnectionRequest"
 Guid="9ae31fb0-9855-4c50-84bb-3f34ca2678d3"
>
<Comment>The on-board waits for a new order to establish a communication session.</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="53befd56-da41-4f36-aa41-e9dc86e9c5c1"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="RBC contact order received"
 Guid="b1c9e783-f0f5-4d68-8816-a13e44c8b068"
>
<ReqRef
 Id="5b9e9eb3-ffa4-47c2-a6f5-9fa6efc58ffe"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5458231e-1df4-425e-8e8b-9b993b243cc4"
>
</ReqRef><ReqRef
 Id="e36dd5fc-81ea-4253-8535-4e5b4afd1b54"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="99a2dff6-373a-4b16-b222-68f88c8dd6ec"
>
</ReqRef><ReqRef
 Id="752d0832-7cfa-4424-96f7-d3fbb447a20e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="47c90c73-64b3-4eef-97b4-dee8e5f231cb"
>
</ReqRef><ReqRef
 Id="558b2068-001d-4f9f-902b-2cd23fb269d9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="76238e6e-5374-4aec-bd6c-2e60ec86c787"
>
</ReqRef><ReqRef
 Id="1be02ad3-ca38-452c-a795-e398d991b2da"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0769f3b0-e796-43b9-9a63-8ed1e7e0cf33"
>
</ReqRef><ReqRef
 Id="dd37c53c-3853-4b84-8080-c287bcf0cc25"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="01eb5402-0cee-4757-8e9e-8bdb0dc3687f"
>
</ReqRef><ReqRef
 Id="e65aa492-e72e-4bdc-896b-8462bf7b8ea9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4ac1091d-9f1b-4a2a-b2df-175afdaa07be"
>
</ReqRef><ReqRef
 Id="69641afe-f1b0-4499-9b31-e3d7a164d492"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="dee9ebb6-a343-433d-a245-a666c6a38e8c"
>
</ReqRef><ReqRef
 Id="277de94f-c4cd-4612-97ca-ead1fdd29073"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7847ad76-9c4f-4975-b1fa-1d812a30dd8a"
>
</ReqRef><ReqRef
 Id="dd006294-7250-4fc8-b4b1-f4e62eb12cf3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="46a11136-91d9-4a7a-a0c9-68a5f22a00f3"
>
</ReqRef><ReqRef
 Id="6fa8d8fc-f346-4592-b64d-ce1831a6cc98"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="cdbb3b28-6764-4d7a-8b43-27e652af2f3b"
>
</ReqRef><ReqRef
 Id="adc412e3-1c5f-4c95-a667-303e6aabee27"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="309086bd-f509-469b-8a1b-559b24c6596d"
>
</ReqRef><ReqRef
 Id="6a073136-951c-4624-92a2-1b2f704d25ed"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a98bc4df-2d71-45c5-b43d-0a77cceb795c"
>
</ReqRef><ReqRef
 Id="68a814aa-d977-4ba8-8329-54aaaec00081"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2b348482-f4fe-48e1-8f65-f7b3bbd00367"
>
</ReqRef><ReqRef
 Id="dba4721e-ecc7-46a8-945a-ca408198338c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c93960fa-89b8-4f85-ae97-9716f975088f"
>
</ReqRef><ReqRef
 Id="36ac93e3-3877-41a8-98dc-4bbdd6eff050"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2d60c119-f06c-45b8-92a6-d56ee67440f9"
>
</ReqRef><Comment>When an order to contact an RBC is received, the on-board requests the set-up of a safe radio connection with the trackside.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="RBC contact order received"
 Guid="16010e1f-582d-4673-a08f-e652d867206d"
>
<Comment>The time of initialisation of the requset is stored in ConnectionLostTime, in order to update the Safe Radio Connection status if the connection is not established within the time defined by ConnectionStatusTimer.</Comment>
<PreConditions>
<PreCondition
 Guid="d70d315d-97c4-418f-a89b-173190c448b2"
>SessionHasToBeEstablished ( anRBC =&gt; ENCLOSING )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="30ffcf61-752f-4621-bd06-aae49937b224"
>THIS &lt;- ConnectionStateSM.Connecting</Action><Action
 Guid="0435a548-28e2-45b2-b8f8-0711b2fc3498"
>SessionManagementData.ConnectionRequestIsSent &lt;- True</Action><Action
 Guid="5c7318a3-3c2a-4a71-85c0-c1617d2d9134"
>SessionManagementData.Action &lt;- ContactActionEnum.Establish</Action><Action
 Guid="36c208cd-4fdb-4529-aac3-4806d371c8a8"
>ConnectionLostTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="9dfae625-3ff2-425f-898d-c57ff6a75c0a"
>LastRequestTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="5c581ac4-b257-4996-8939-15d5aa8232be"
>NumberOfSentRequests &lt;- 1</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Reset session establishment data for special cases"
 Guid="9d941ace-d89d-42ef-a2c8-ff54038d7219"
>
<Comment>If the session was opened due to a special case, then reset its value. If the special case was &quot;due to mode change&quot;, it will be reset once the mode change report has been sent.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Reset session establishment data for special cases"
 Guid="757516e3-bab5-418e-97fd-87981cb95161"
>
<PreConditions>
<PreCondition
 Guid="71577537-bec3-47e6-8f53-baaa30b75738"
>SpecialCaseSessionEstablishmentReason != SpecialCaseSessionEstablishmentReasonEnum.EstablishDueToModeChangeReport</PreCondition></PreConditions>
<Actions>
<Action
 Guid="33377292-d119-402b-ae2d-61db25cf4847"
>SpecialCaseSessionEstablishmentReason &lt;- SpecialCaseSessionEstablishmentReasonEnum.DoNotEstablish</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Establishment of communication session requested by trackside"
 Guid="078e4aad-f6a1-48b9-999f-df3808876be3"
>
<ReqRef
 Id="484b41b4-a894-43b4-9ee4-a7227ddfd3aa"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="20784d49-0f83-447f-ab8b-bdb43f2465bf"
>
</ReqRef><ReqRef
 Id="db4463dc-26c1-4af3-a988-31083e546a4c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bccfede5-1b36-4e0c-84c4-d59ef50c0188"
>
</ReqRef><ReqRef
 Id="f070a20f-9665-470d-80ce-363bfa6c264a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="526f1300-ff99-4b0d-94ec-7f06e23068f4"
>
</ReqRef><ReqRef
 Id="bf253010-f30e-4baf-a159-2b5214063f79"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c39a1ce0-2cc7-4a90-a708-caa018244a67"
>
</ReqRef><Comment>If the trackisde requests the establishment of communication session, the on-board sets up the safe radio connection and waits for the message Initiation of communication session from the trackside.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Establishment of communication session requested by trackside"
 Guid="50e554d4-aa95-4f7e-896c-80aa749af607"
>
<PreConditions>
<PreCondition
 Guid="7646887d-9f41-46be-afc8-7baa48bad286"
>SessionManagementData.ConnectionRequestIsReceived</PreCondition></PreConditions>
<Actions>
<Action
 Guid="acac9f9a-a9de-4efe-b716-f52130488da8"
>THIS &lt;- ConnectionStateSM.Connecting.HandleRequestFromTrackside</Action><Action
 Guid="ecf1a755-d1fb-4123-82de-4e8d7e3dad23"
>SessionManagementData.ConnectionIsEstablished &lt;- True</Action><Action
 Guid="e0c9fd6f-6e95-44d9-99ad-07fb09da4ad3"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.ConnectionUp</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State></States>
</StateMachine><EnterAction>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Enter action"
 Guid="271c51cc-18ce-49bb-b003-3de4dccf8b16"
>
<Comment>In the state changed to inactive, that means that the connection requests will not be sent anymore =&gt; delete the contact order.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Enter action"
 Guid="2bd915e9-9b75-47c6-ab7d-7fb7ef35e100"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="7a74fbe9-dfd5-4afd-ac65-a26da4458a42"
>ContactRBCOrder &lt;- EMPTY</Action><Action
 Guid="458f058a-f36c-4a00-8209-e4108d1c9c5e"
>SessionManagementData.ConnectionIsEstablished &lt;- False</Action></Actions>
</RuleCondition></Conditions>
</Rule></EnterAction>
</State><State
 X="800"
 Y="70"
 Width="100"
 Height="200"
 Implemented="TRUE"
 Name="Connecting"
 Guid="620d737c-d8e3-43c2-8cda-c9b1ca68371a"
>
<Comment>The connection is being established.</Comment>
<StateMachine
 Default="ConnectionStateSM.Connecting.WaitForSetUp"
 Implemented="TRUE"
 Guid="939342a0-af0b-417c-af03-c79040f6200e"
>
<States>
<State
 X="90"
 Y="80"
 Width="200"
 Height="50"
 Implemented="TRUE"
 Name="WaitForSetUp"
 Guid="06d57201-ba9b-46dd-9596-30944cc7cbb2"
>
<Comment>If the request to establish the communication session was sent by the on-board, the on-board waits until the safe radio connection is set-up.</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="5c8b60bd-8baa-4c41-9bb6-ffcca7cbdfc2"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle the connection request"
 Guid="9a9bbb19-838a-48e9-aa60-b9dfeaf939af"
>
<Comment>As soon as the safe radio connection is set-up, the on-board sends the message Initiation of communication session.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Safe radio connection is set-up"
 Guid="dedc8409-7712-44a5-962a-944a3b26fe52"
>
<ReqRef
 Id="1ead58b3-f05d-46bd-b3f8-bc0a16010cdd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3e40cb31-2d77-4868-8f52-b6d63bd33ce7"
>
</ReqRef><ReqRef
 Id="db4463dc-26c1-4af3-a988-31083e546a4c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a25639d7-3597-437e-bb63-6bec42908441"
>
</ReqRef><ReqRef
 Id="f070a20f-9665-470d-80ce-363bfa6c264a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4bbed78a-f859-49a0-9ff0-df77ea8595e0"
>
</ReqRef><ReqRef
 Id="ca032528-1cb2-4646-bcad-67c92912f36f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="04c1239e-16fe-409f-9811-5d484ba073a2"
>
</ReqRef><ReqRef
 Id="9b632443-f645-498c-9bf9-9771b26f19c6"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ebe6193e-8ecd-4ccf-8fed-124173d88114"
>
</ReqRef><Comment>As soon as the safe radio connection is set-up, the on-board sends the message Initiation of communication session.</Comment>
<PreConditions>
<PreCondition
 Guid="28c2e922-3c7a-4a58-861a-33bc2615f866"
>SessionManagementData.ConnectionIsEstablished</PreCondition></PreConditions>
<Actions>
<Action
 Guid="31c885c9-1ac7-49b7-9f05-81c99f333f80"
>SendInitiationOfCommunicationSession()</Action><Action
 Guid="f271b7b7-9884-4aed-a1ee-b9027d4cad7d"
>THIS &lt;- ConnectionStateSM.Connecting.WaitForSystemVersion</Action><Action
 Guid="1b157902-49e1-4e4c-86f2-2009a6d21b63"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.ConnectionUp</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="&quot;Connection status&quot; timer expires"
 Guid="6a118501-cac0-4a06-805f-b587d3b07391"
>
<ReqRef
 Id="db31b8b2-7e8c-4c37-ac8a-c0df7eda9f8d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="adbf615d-a0e8-4585-951b-30dba2c016e8"
>
</ReqRef><ReqRef
 Id="cd18a937-9dc2-456d-bee7-a61bcd564e32"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="23802d02-9a29-4fcf-8d67-5abe1ea8a33d"
>
</ReqRef><ReqRef
 Id="ca032528-1cb2-4646-bcad-67c92912f36f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ff1c080c-34f8-4910-b38c-af6411d12a03"
>
</ReqRef><ReqRef
 Id="ecf2af34-5e55-40e4-83a6-e6ec4827734c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="546b714c-ddc5-401c-8acb-42e9d7e303ac"
>
</ReqRef><ReqRef
 Id="b15cc4d3-14ad-4f2e-b1d9-c70dc451cc6f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d4397b5d-e102-41c1-954a-8aa7df0563f5"
>
</ReqRef><ReqRef
 Id="24cfec76-595f-41de-920e-42c8da108914"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="14a66f67-6b80-4a87-ba29-e6d2de210ce4"
>
</ReqRef><Comment>If the connection status timer expires, indicate that the connection is lost, repeat the connection request and reset the timer (otherwise the request will be repeated during the next cycle).</Comment>
<PreConditions>
<PreCondition
 Guid="051b7c73-d993-4246-ac2a-5099ddc3c5a1"
>ConnectionLostTime + ConnectionStatusTimer &lt;= Kernel.DateAndTime.CurrentTime</PreCondition></PreConditions>
<Actions>
<Action
 Guid="7a967e85-a3aa-4740-a5be-0df764c85620"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.ConnectionLostOrSetUpFailed</Action><Action
 Guid="066fa5b1-2e86-4ca6-93dd-e597e9fe9c21"
>NumberOfSentRequests &lt;- NumberOfSentRequests + 1</Action><Action
 Guid="30af9a7f-b3aa-438e-8e2c-8c3166dbfa4d"
>LastRequestTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="f77d82ba-eaff-4fd1-81c0-2026665608aa"
>SessionManagementData.ConnectionRequestIsSent &lt;- True</Action><Action
 Guid="9e7c16f9-a8e2-4265-b301-cfb9022263c3"
>ConnectionLostTime &lt;- Default.BaseTypes.Time.Infinity</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Repeat the connection request"
 Guid="13984cfa-f744-469f-ab79-5063a2f58711"
>
<Comment>If no response is received during a defined time interval, the connection request will be repeated.</Comment>
<PreConditions>
<PreCondition
 Guid="efc41a15-575b-4c33-9d93-c2ad1a51a905"
>LastRequestTime + TimeBeforeMessageRepetition &lt; Kernel.DateAndTime.CurrentTime</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Repeat the connection request"
 Guid="c6cd2b9e-746c-48d2-b150-39954458d216"
>
<Comment>Handles the repetition of connection requests.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="The request is part of an on-going SoM"
 Guid="e49895de-cf43-46aa-b926-c7fbff4a44e0"
>
<ReqRef
 Id="ac96ab5d-7682-43e6-a576-f8a2ada8b003"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8b9b3deb-5cd6-4095-acf3-aa131263a7a6"
>
</ReqRef><ReqRef
 Id="0a26d75b-0219-4e85-b731-ba4e14bcaf1c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="13ede6b0-dc8d-4acc-b0ef-3d6912402ac2"
>
</ReqRef><Comment>If the request is part of an on-going SoM, it is repeated the number of times allowed by Appendix A3.1.</Comment>
<PreConditions>
<PreCondition
 Guid="870a013c-7c76-4333-a2b6-d4476047b946"
>Kernel.HandleModeChange in Kernel.HandleModeChangeSM.StartOfMission</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle request repetition in SoM"
 Guid="bdd73248-c577-4e8a-b9cd-d15a0842f3f0"
>
<Comment>If the request is part of an on-going SoM, it is repeated the number of times allowed by Appendix A3.1.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Connection is lost, send new request"
 Guid="6ee281d8-5947-4fd2-b6ea-4a61e0f5d896"
>
<Comment>If the request has to be repeated and the maximum number of requests is not reached it, a new request is sent.</Comment>
<PreConditions>
<PreCondition
 Guid="5f21704f-fd79-4d25-ac8d-54f9ec46d7e7"
>NumberOfSentRequests &lt; NumberOfMessageRepetitions</PreCondition></PreConditions>
<Actions>
<Action
 Guid="6c9db820-9596-4dc3-b487-9fb6e343bc2b"
>LastRequestTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="ba529648-8bde-4b6c-bab8-b53b04a493ea"
>SessionManagementData.ConnectionRequestIsSent &lt;- True</Action><Action
 Guid="00fc6a16-7c65-4f0a-b1b2-6b44b65edf9f"
>NumberOfSentRequests &lt;- NumberOfSentRequests + 1</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Connection is lost, maximum number of requests reached"
 Guid="301af69a-abcb-4f58-bb23-313539119ff7"
>
<ReqRef
 Id="0a26d75b-0219-4e85-b731-ba4e14bcaf1c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2798e911-0128-43b6-a2a6-a5ab1f59d39c"
>
</ReqRef><ReqRef
 Id="b15cc4d3-14ad-4f2e-b1d9-c70dc451cc6f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="792443e1-a9d6-48cd-9fac-4b74750f8bbb"
>
</ReqRef><ReqRef
 Id="ca032528-1cb2-4646-bcad-67c92912f36f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7c59792f-c11e-45cc-9a1a-36971481d8ff"
>
</ReqRef><ReqRef
 Id="66901d6f-fcdd-4ddb-89e1-57f86cb9fcce"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1605f95a-cc99-4637-90f6-f944c5374c37"
>
</ReqRef><Comment>If the request has to be repeated but the maximum number of requests is already reached, RBC declares that the setup has failed and goes to inactive state.</Comment>
<PreConditions>
<PreCondition
 Guid="4932a3e3-358f-4a69-b034-4dadf129cf89"
>NumberOfSentRequests== NumberOfMessageRepetitions</PreCondition></PreConditions>
<Actions>
<Action
 Guid="947cdfdd-e42c-4684-9dd1-65abb983fad5"
>THIS &lt;- ConnectionStateSM.Inactive</Action><Action
 Guid="d6469a14-111f-45b4-846e-e000f91ba652"
>NumberOfSentRequests &lt;- 0</Action><Action
 Guid="dc483daa-7b07-4ae9-8b43-cbd205d1883a"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.ConnectionLostOrSetUpFailed</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="The request is not a part of on-going SoM"
 Guid="ef0c34e4-8af2-49ed-8202-e5b73075c9dc"
>
<ReqRef
 Id="c2fdf450-8b2f-4ed0-a744-03d015cc0c69"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b55e54e0-51eb-4729-8895-578963ed886b"
>
</ReqRef><Comment>If the request is not a part of on-going SoM, it shall be repeated until one of the specified conditions is met.</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="16ba15f9-a1a0-4ae4-871b-0170a60aa6fb"
>SessionManagementData.ConnectionRequestIsSent &lt;- True</Action><Action
 Guid="d32ceab3-f240-4971-86d9-06c897d9b505"
>LastRequestTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="a5a746be-d6b2-4350-9a1e-55abb07beb03"
>NumberOfSentRequests &lt;- NumberOfSentRequests + 1</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Stop requests if end of mission is performed"
 Guid="646f3bec-8d5f-4ba4-9483-3bff2fc2e376"
>
<ReqRef
 Id="5c68142d-4105-4fde-a021-ad914acbfe89"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8a3ea32d-98c2-4599-9302-5ac2b63672dc"
>
</ReqRef><Comment>If End of Mission procedure is performed, the requests to establish a safe radio connection shall no more be repeated.</Comment>
<PreConditions>
<PreCondition
 Guid="788ddb8c-f003-470b-9221-6ceab4d99a2f"
>Kernel.HandleModeChange in Kernel.HandleModeChangeSM.EndOfMission</PreCondition></PreConditions>
<Actions>
<Action
 Guid="2f2121c0-547a-4f28-920b-c73ac9de628c"
>THIS &lt;- ConnectionStateSM.Inactive</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle connection status"
 Guid="9ae41e10-1383-4520-9ba2-f79fb92065e8"
>
<ReqRef
 Id="e9e7d5c2-c94d-4bb6-8aea-136e28beafd2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d674f95b-84f7-4ee6-acd9-62da5008d54f"
>
</ReqRef><Comment>The requests to set-up a safe radio connection are stopped for the reason different than the successful set-up =&gt; update the status of the safe radio connection.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="HandleConnectionStatus"
 Guid="492510d6-6841-4f5b-9c8f-e6c47652dec7"
>
<PreConditions>
<PreCondition
 Guid="42b7fc56-8758-4bcd-b6d1-4a6117a5fcd8"
>SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionLostOrSetUpFailed</PreCondition></PreConditions>
<Actions>
<Action
 Guid="e9181185-8e8c-4650-958c-c1504a7af145"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.NoConnection</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Stop requests if level transition order is passed"
 Guid="9baf68f6-558e-4e7e-b656-9c97e69df736"
>
<ReqRef
 Id="358d0dbf-9187-4a9e-87a4-18c07fba71ba"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2926050c-3f94-48e6-95d6-ff87a3db3312"
>
</ReqRef><Comment>If the train has passed a level transition border to level 0, NTC or 1, the requests to establish a safe radio connection shall no more be repeated.</Comment>
<PreConditions>
<PreCondition
 Guid="e83c3c3e-9cfa-4ec8-9613-96417be71c7d"
>Kernel.LevelTransition.LevelTransitionToProcess.TRLevel.Value in [Default.Level.L0, Default.Level.LNTC, Default.Level.L1]</PreCondition></PreConditions>
<Actions>
<Action
 Guid="b71b573b-1f53-4f37-97b5-3ea811c3a2c3"
>THIS &lt;- ConnectionStateSM.Inactive</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle connection status"
 Guid="bc886f2d-8e9a-4246-a77b-a7430325f5bf"
>
<ReqRef
 Id="e9e7d5c2-c94d-4bb6-8aea-136e28beafd2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="21d0f8f8-6a98-4605-b79b-54732a1911a4"
>
</ReqRef><Comment>The requests to set-up a safe radio connection are stopped for the reason different than the successful set-up =&gt; update the status of the safe radio connection.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="HandleConnectionStatus"
 Guid="be099997-b680-456b-9384-c39aec17394c"
>
<PreConditions>
<PreCondition
 Guid="5083cef0-4d21-4fe5-85c2-290ee5188a42"
>SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionLostOrSetUpFailed</PreCondition></PreConditions>
<Actions>
<Action
 Guid="bc31242d-154e-4fba-9641-c2d05f26d6df"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.NoConnection</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Stop requests if announced radio hole is passed"
 Guid="3b2f67be-ebc7-4c66-b94c-5280f6238cf8"
>
<ReqRef
 Id="ce7cdbeb-b49e-4146-a701-c8e36d770f29"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="55d8e6e7-56aa-4194-a852-7e7ff2a4c0d2"
>
</ReqRef><Comment>If the train front passes the start of an announced radio hole, the requests to establish a safe radio connection shall no more be repeated.</Comment>
<PreConditions>
<PreCondition
 Guid="5e653953-1096-4f8d-8331-734cb465dff9"
>Kernel.TrackDescription.TrackConditions.General.IsInsideRadioHole()</PreCondition></PreConditions>
<Actions>
<Action
 Guid="aa4d7c3e-e76d-40a7-9946-5e6162008c03"
>THIS &lt;- ConnectionStateSM.Inactive</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle connection status"
 Guid="18e62396-1041-4757-a70d-d4a708d06835"
>
<ReqRef
 Id="e9e7d5c2-c94d-4bb6-8aea-136e28beafd2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5147708c-9c3b-4ae4-ac27-cd35e9fd3f6c"
>
</ReqRef><Comment>The requests to set-up a safe radio connection are stopped for the reason different than the successful set-up =&gt; update the status of the safe radio connection.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="HandleConnectionStatus"
 Guid="2ac46b56-d550-43a3-9e14-0c778f4b685a"
>
<PreConditions>
<PreCondition
 Guid="22e018d3-10bf-4929-8646-a6e481649c82"
>SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionLostOrSetUpFailed</PreCondition></PreConditions>
<Actions>
<Action
 Guid="ce8c3db8-1afa-4d73-a3ff-6f1f77b6f44b"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.NoConnection</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Stop requests if RBC/RBC border is passed"
 Guid="02568a26-f5b0-4587-ae56-9754a49e14cf"
>
<ReqRef
 Id="3e905ad6-8df3-4561-b1b9-4d1ffb5b440f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f7466439-2974-4413-bd13-68af6da33ccd"
>
</ReqRef><Comment>If the train front passes a RBC/RBC border, the requests to establish a safe radio connection shall no more be repeated.</Comment>
<PreConditions>
<PreCondition
 Guid="a315cce6-b406-417c-9709-d00d567e3b73"
>Kernel.TrainPosition.FrontEndPosition(PointOfInterest =&gt; Default.DistanceInterval.Max) &gt;= PositionReport.RBCTransitionLocation</PreCondition></PreConditions>
<Actions>
<Action
 Guid="7857191c-725b-4d50-9197-8c15c1d2f16a"
>THIS &lt;- ConnectionStateSM.Inactive</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle connection status"
 Guid="a78ba93b-bd73-4b71-9c38-91848c7d031c"
>
<ReqRef
 Id="e9e7d5c2-c94d-4bb6-8aea-136e28beafd2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="86e93bd3-912d-43ce-8b8d-fb0c93e78750"
>
</ReqRef><Comment>The requests to set-up a safe radio connection are stopped for the reason different than the successful set-up =&gt; update the status of the safe radio connection.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="HandleConnectionStatus"
 Guid="3872c008-ea44-40f6-89dc-a6496714b3d3"
>
<PreConditions>
<PreCondition
 Guid="88e4b051-3b68-4725-be0b-870325c876db"
>SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionLostOrSetUpFailed</PreCondition></PreConditions>
<Actions>
<Action
 Guid="ade10e05-e2c5-47ba-8103-854b4a1281cc"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.NoConnection</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State><State
 X="510"
 Y="80"
 Width="200"
 Height="50"
 Implemented="TRUE"
 Name="WaitForSystemVersion"
 Guid="43cbdaea-3858-4ec8-92dc-701b21f480e2"
>
<Comment>The on-board waits for the system version of the trackside.</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="897a8348-e831-4898-bf12-d84289248eac"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="System version received"
 Guid="504d3e3c-ba1c-4573-b0c5-e2c4369b494c"
>
<ReqRef
 Id="02f20f26-3445-49b9-95cf-a6948ab029b8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="19083d61-5223-4c91-a7df-5a632a8820dc"
>
</ReqRef><Comment>When the system version is received, the communication session is considered as established.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="System version received"
 Guid="ffdd0e28-2dd6-49e6-aeb2-3d226bdb90dc"
>
<PreConditions>
<PreCondition
 Guid="fc7f4583-9abe-4721-9172-3d91c2dbab42"
>SessionManagementData.SystemVersion.DataState == Default.DataState.Valid</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Check system version compatibility"
 Guid="dd86dead-77a9-4f8b-8cf7-09ade389a1aa"
>
<Comment>The on-board verifies it the system version of the trackside is compatible with one of its supported system versions.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="System version compatible"
 Guid="5546f28b-42bb-4732-aafe-81cf2d61613d"
>
<ReqRef
 Id="790cf49e-a85c-4110-b567-fc5d57052339"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="15232b13-7aea-4fce-9832-446ada9900d3"
>
</ReqRef><Comment>If the trackside system version is compatible with the system version of the on-board, then the on-board sends the session establishment report and considers the session as established.</Comment>
<PreConditions>
<PreCondition
 Guid="debc6364-ddf5-4ed8-82bb-c87f6321ac7b"
>SystemVersionIsCompatible ( SessionManagementData.SystemVersion.Value )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="b4f25d0d-6815-4c2d-ae03-b9c5f4fe9298"
>THIS &lt;- ConnectionStateSM.Connected</Action><Action
 Guid="14daf0db-62ec-4f22-8031-4c28c232386d"
>SendSessionEstablishmentReport()</Action><Action
 Guid="34a43062-7ec6-473d-9e19-755099d35942"
>ContactRBCOrder &lt;- EMPTY</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="If the session was opened due to mode change, report the mode change"
 Guid="1b0f33d5-b59b-404c-ab25-69c870a007a0"
>
<ReqRef
 Id="fbaaf410-a59f-40cd-b972-aa1e84116831"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b64c888c-4b8d-4bd7-92c8-5226575e1973"
>
</ReqRef><Comment>If the session was opened due to mode change, then the position report has to be sent.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="If the session was opened due to mode change, report the mode change"
 Guid="90cfe581-fa1b-4e6c-b98e-027ba721d64e"
>
<PreConditions>
<PreCondition
 Guid="4bffab3a-5169-4aed-9ee7-64261867f61f"
>SpecialCaseSessionEstablishmentReason == SpecialCaseSessionEstablishmentReasonEnum.EstablishDueToModeChangeReport</PreCondition></PreConditions>
<Actions>
<Action
 Guid="52d6dbeb-bd94-41bc-ac4f-a65bcb5bd1e2"
>SendPositionReport()</Action><Action
 Guid="89958712-60ea-4c06-b42e-a461b1a64e10"
>SpecialCaseSessionEstablishmentReason &lt;- SpecialCaseSessionEstablishmentReasonEnum.DoNotEstablish</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="System version not compatible"
 Guid="f2c2eee4-5e19-4e48-b746-5b192000d7d8"
>
<ReqRef
 Id="25af834a-3a24-459b-b5c8-97b85eddb2e8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="216a5269-acb9-4d77-8c67-d59d7b1eb902"
>
</ReqRef><ReqRef
 Id="21b52bea-13d1-437e-9aec-4d66149f68d5"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="026c6422-5ea2-4120-82c7-1d668d7213e3"
>
</ReqRef><Comment>If the trackside system version is not compatible, then the session is terminated, the driver is informed and the message &quot;No compatible version supported&quot; is sent to the RBC.</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="ea8b7978-d9c8-42c9-a1a1-339aea7eb022"
>THIS &lt;- ConnectionStateSM.Inactive</Action><Action
 Guid="53aed77c-69b4-4844-84ca-aeb33f10a498"
>SendNoCompatibleVersionSupported()</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Display indication to driver"
 Guid="32978d87-8f73-45bd-bb68-3f372244060e"
>
<Comment>If the on-board is unable to connect to the RBC, only display the Incompatible System Version information if the current mode is not SL.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Mode is not SL"
 Guid="0ff8a2f0-4595-49a4-b1ff-17efce2e7f5b"
>
<ReqRef
 Id="26f8b2b9-4d92-46f3-8c33-b40b1b891b32"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="05961053-1d2a-4252-922e-6124df28fbd1"
>
</ReqRef><PreConditions>
<PreCondition
 Guid="8473eb41-8b29-4bfc-850f-20dab16f4863"
>Kernel.Mode != Default.Mode.SL</PreCondition></PreConditions>
<Actions>
<Action
 Guid="67b23c1f-f588-4c6d-82e0-4bd1b8feb62a"
>DMI.MasterDMI().Out_TracksideNotCompatible.Display()</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State><State
 X="360"
 Y="330"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="HandleRequestFromTrackside"
 Guid="e52e1adb-7a12-454b-a949-67cbfb504da2"
>
<ReqRef
 Id="bf253010-f30e-4baf-a159-2b5214063f79"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="64a3be3d-496c-4315-b995-9d369d1921c6"
>
</ReqRef><Comment>If the request to establish the communication session was asked by the trackside, the on-board waits for the message Initiation of the communication session from the trackside.</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="d10a45d9-1390-4e31-8970-2532e3ffaea7"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Initiation of a communication session is received from the trackside"
 Guid="4471e880-abfe-439b-a5a0-854dbd355825"
>
<ReqRef
 Id="ca4b12ab-a31a-4af0-8bbc-bedfcba2e060"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d5d7215e-13c9-4c56-a492-1470ec7e1c87"
>
</ReqRef><Comment>When the on-board receives the Initiation of a communication session message from the trackside, it considers the session as established and sends Session establishment report.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Initiation of a communication session is received from the trackside"
 Guid="8b432caa-ce1c-4295-8592-63d839277421"
>
<PreConditions>
<PreCondition
 Guid="525fb74f-aecb-42f0-8285-5ad61fc9ea05"
>SessionManagementData.InitiationOfACommunicationSessionReceived</PreCondition></PreConditions>
<Actions>
<Action
 Guid="0ad99b4e-12a5-4395-bee8-9be7964dd2ca"
>THIS &lt;- ConnectionStateSM.Connected</Action><Action
 Guid="bfd4f69e-32ac-42e9-9e8e-1ce0785e25ec"
>SendSessionEstablishmentReport()</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State></States>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Order to contact an RBC is received"
 Guid="63704436-5af4-444f-a8e6-6349d2dee385"
>
<Comment>If an order to contact an RBC is received in connecting state, the establishing of the communication session is aborted.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Order to terminate the communication session is received"
 Guid="a42b1225-8802-4fe3-9b3b-1148d9802095"
>
<ReqRef
 Id="d870fe5c-bd41-4203-9dfc-5ace398ffd56"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c000a984-92e1-4c9f-a4ab-6d8babd16d90"
>
</ReqRef><ReqRef
 Id="e1848200-b260-492c-a722-3b64311cb97f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="58a537e1-e554-487c-a5b0-3510d0ac5116"
>
</ReqRef><Comment>If an order to terminate the communication session is received, the communication session is terminated.</Comment>
<PreConditions>
<PreCondition
 Guid="c94000a1-d7dc-4cd3-becf-159031484f3a"
>ContactRBCOrder != EMPTY
  AND
ContactRBCOrder.ActionToPerform == ContactActionEnum.Terminate</PreCondition></PreConditions>
<Actions>
<Action
 Guid="005fe0c4-14fe-4ed1-8754-5011041d3708"
>THIS &lt;- ConnectionStateSM.Inactive</Action><Action
 Guid="01701ac8-5a57-4ab9-9aa1-ebfd9312b3ff"
>ContactRBCOrder &lt;- EMPTY</Action><Action
 Guid="3581cdfd-d9c1-4aa5-aea5-5f76e8d5af3b"
>SessionManagementData.Action &lt;- ContactActionEnum.Terminate</Action><Action
 Guid="9b9191f7-af06-4386-bb03-ac71da827aa2"
>SessionManagementData.ConnectionRequestIsSent &lt;- True</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle connection status"
 Guid="50b05be7-9062-4bd8-acb3-e83c5bd54956"
>
<ReqRef
 Id="e9e7d5c2-c94d-4bb6-8aea-136e28beafd2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d9970347-1305-49cc-81f9-f2e93381e7f1"
>
</ReqRef><Comment>The requests to set-up a safe radio connection are stopped for the reason different than the successful set-up =&gt; update the status of the safe radio connection.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="HandleConnectionStatus"
 Guid="731001c1-2533-4e75-8d97-ce0eef3b46ab"
>
<PreConditions>
<PreCondition
 Guid="34eefb1c-0796-49d5-b242-36a5870c84ea"
>SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionLostOrSetUpFailed</PreCondition></PreConditions>
<Actions>
<Action
 Guid="c2ed4f87-deea-4f33-baef-8b0df77887fd"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.NoConnection</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Order to contact a different RBC is received"
 Guid="810dd9dd-550b-403d-aa04-45bd7c0adc05"
>
<ReqRef
 Id="c434f0b2-9953-426f-ab6b-0c705da559de"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1233accf-94cc-42df-b409-3c0c4d646543"
>
</ReqRef><Comment>If an order to contact a different RBC is received, the communication session is terminated.</Comment>
<PreConditions>
<PreCondition
 Guid="3b3b8132-510a-45e4-8ea7-1e37ef8996e4"
>ContactRBCOrder != EMPTY
  AND
(
  ContactRBCOrder.Id != LastKnownRBC.Id
    OR
  ContactRBCOrder.PhoneNumber != LastKnownRBC.PhoneNumber
)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="1096c816-665f-4d31-90fb-7dc32298eb34"
>THIS &lt;- ConnectionStateSM.Inactive</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle connection status"
 Guid="b8346e36-3af0-4d5f-b8e7-80935075d8af"
>
<ReqRef
 Id="e9e7d5c2-c94d-4bb6-8aea-136e28beafd2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b840f1ad-399c-483a-a177-447b9e756e26"
>
</ReqRef><Comment>The requests to set-up a safe radio connection are stopped for the reason different than the successful set-up =&gt; update the status of the safe radio connection.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="HandleConnectionStatus"
 Guid="dcf97a8d-bdab-4ae1-a32a-b7f763a2795e"
>
<PreConditions>
<PreCondition
 Guid="9ed069cc-4bb9-41e7-91a9-f2ab3cf61bbe"
>SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionLostOrSetUpFailed</PreCondition></PreConditions>
<Actions>
<Action
 Guid="8ee9506c-0e90-4b8e-9114-a15a029014d8"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.NoConnection</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State><State
 X="810"
 Y="430"
 Width="100"
 Height="80"
 Implemented="TRUE"
 Name="Connected"
 Guid="9296f778-498c-4dfb-8eb9-bda176289afa"
>
<Comment>The connection is established.</Comment>
<StateMachine
 Default="ConnectionStateSM.Connected.InitialState"
 Implemented="TRUE"
 Guid="0b8f9771-1352-4442-9971-a125688da2ae"
>
<States>
<State
 X="130"
 Y="100"
 Width="120"
 Height="50"
 Implemented="TRUE"
 Name="InitialState"
 Guid="ad4e57e7-c527-4a6b-b01f-b9fbf7a1d9a8"
>
<Comment>The initial state, where the on-board can send its train data to the RBC, if the latter is the accepting one.</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="2d47cea8-c618-4dda-b17f-7df153202e06"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle validated train data"
 Guid="3e9be6b6-c794-4dc2-8864-ee20b5c44ad8"
>
<ReqRef
 Id="3e290fa7-299c-4897-91e4-dbcb5702edbf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5bdc8f39-44a2-4d9e-8fb9-df822fa48600"
>
</ReqRef><ReqRef
 Id="4a5cfdeb-9d79-4d58-8d37-5073de473751"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="41a15e27-5587-4b5f-99bb-27ca53ad4d33"
>
</ReqRef><Comment>If the current RBC is an accepting RBC, the on-board sends its train data.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle validated train data"
 Guid="657834c9-feef-4ac1-a572-58a06727f940"
>
<Comment>If the connection with RBC is established and valid train data is present onboard, the message Validated Train Data is sent.</Comment>
<PreConditions>
<PreCondition
 Guid="2b26b73e-2b41-4741-8f2b-9b3ebe6994aa"
>Kernel.TrainData.TrainData.DataState == Default.DataState.Valid</PreCondition><PreCondition
 Guid="1885385a-2aa3-4151-8396-e579fca7bd78"
>IsMainConnection</PreCondition></PreConditions>
<Actions>
<Action
 Guid="25272c57-44ec-4c93-9595-68bf6e2fc054"
>SendValidatedTrainData()</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Handle train data if accepting RBC"
 Guid="5d62b306-19d5-492b-81e6-ca0e07ed8f8b"
>
<ReqRef
 Id="1d0a9f3a-05b9-496f-808f-1dc1ece5338f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="73803e17-bb68-4c62-b844-3883bd115e34"
>
</ReqRef><Comment>As soon as the on-oard equipment has established the session with the Accepting RBC, it shends its Train Data.</Comment>
<PreConditions>
<PreCondition
 Guid="07e657aa-3707-4bda-a4f4-a6d13481015f"
>NOT IsMainConnection</PreCondition><PreCondition
 Guid="22d43fd5-302a-4983-ae19-6ff1aa829b83"
>Kernel.Mode not in [Default.Mode.SL, Default.Mode.NL]</PreCondition></PreConditions>
<Actions>
<Action
 Guid="f921aecf-212e-43c9-a4d7-622345fa1983"
>SendValidatedTrainData()</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Go to ConnectionEstablished state"
 Guid="489bcaff-b5ec-4c8f-bb88-f592dc223294"
>
<Comment>Transition to the main state.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Go to ConnectionEstablished state"
 Guid="0186dab3-e0f5-4bfa-82f3-987c4c955fc6"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="26178f16-a790-43b6-ace7-e6ae61afe16a"
>THIS &lt;- ConnectionStateSM.Connected.ConnectionEstablished</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State><State
 X="610"
 Y="320"
 Width="120"
 Height="50"
 Implemented="TRUE"
 Name="ConnectionLost"
 Guid="74427cf7-e4a2-4a0c-bdc7-bebc203329c8"
>
<ReqRef
 Id="308624ea-ea91-4451-b8c4-1cfbc9094f8e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7ce61377-be95-4310-9ada-c3c35b423175"
>
</ReqRef><Comment>When the safe radio connection is lost, the connection is considered as established during MaxTimeToMaintainACommunicationSession. During this time the process is in Connected.ConnectionLost state.</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="82475326-dfa6-48d1-98f9-27f6e63db277"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle connection status"
 Guid="95c2146e-3bb3-4d69-b6ff-54fbc7105c4b"
>
<Comment>Handles the connection status.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Connection is set-up again"
 Guid="598ea9bc-0de7-49df-b4cd-0e3383fc1964"
>
<ReqRef
 Id="49cfe5c8-5648-4df1-8be1-6ae2a3a15d22"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="74fd1f0a-44de-4ab4-a3ab-7531a8db7735"
>
</ReqRef><ReqRef
 Id="5342093f-7355-4153-b42e-b0eb8bb14b89"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0089dd2d-382a-4402-92c9-91ff3614b031"
>
</ReqRef><ReqRef
 Id="db4463dc-26c1-4af3-a988-31083e546a4c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a4c01bd0-13aa-4192-a3c5-2118c3dbbd1b"
>
</ReqRef><ReqRef
 Id="a4a65f87-d77f-4542-967b-9e1f99a0ecde"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1375e83d-46bf-4d79-9821-9f8a86f32624"
>
</ReqRef><ReqRef
 Id="ca032528-1cb2-4646-bcad-67c92912f36f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="373380bc-4ca2-4f14-84c9-0ef715eaad4d"
>
</ReqRef><Comment>If the connection is up again, the system goes back to the state Connected.InitialState.</Comment>
<PreConditions>
<PreCondition
 Guid="3b0e6a1c-8fac-4bb1-bcbf-abe45d8bee93"
>SessionManagementData.ConnectionIsEstablished</PreCondition></PreConditions>
<Actions>
<Action
 Guid="ed13bd5b-6967-4a40-bee3-d33675727dd3"
>THIS &lt;- ConnectionStateSM.Connected.ConnectionEstablished</Action><Action
 Guid="70b5069e-cb73-4c69-8a2c-0cf87e854dc4"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.ConnectionUp</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Connection is lost, send a new request"
 Guid="cc260d6e-1c9e-40ba-b56f-2678ccf9cce7"
>
<ReqRef
 Id="5342093f-7355-4153-b42e-b0eb8bb14b89"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="aede3125-81b9-4a5a-9baf-1d7f4ebdfe23"
>
</ReqRef><Comment>A new request has to be sent every TimeBeforeMessageRepetition seconds.</Comment>
<PreConditions>
<PreCondition
 Guid="064e439a-0285-414a-99b9-02f9500239f5"
>NOT SessionManagementData.ConnectionIsEstablished</PreCondition><PreCondition
 Guid="9ad4bbc1-055b-4beb-8d36-44281c10ab76"
>LastRequestTime + TimeBeforeMessageRepetition &lt;= Kernel.DateAndTime.CurrentTime</PreCondition></PreConditions>
<Actions>
<Action
 Guid="aa75abe0-f19d-4bbb-a7f5-323d4a627543"
>LastRequestTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="3a5452b7-fed6-4ef2-9c87-1954d6c666f7"
>SessionManagementData.ConnectionRequestIsSent &lt;- True</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Connection is lost, maximum time is reached"
 Guid="883f2a02-5dfe-4805-884a-626e17c2d83f"
>
<ReqRef
 Id="249d841a-1bca-4d29-8e4c-51ce7db07de4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b169e962-bb5d-4b2f-90e4-d0f8638e7479"
>
</ReqRef><ReqRef
 Id="094bdbd4-4347-42a8-81a5-44eacb4e239d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="13914569-9f86-4809-b10f-4e44112900d3"
>
</ReqRef><ReqRef
 Id="5342093f-7355-4153-b42e-b0eb8bb14b89"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8d657961-233b-43be-b2ca-09f72b334000"
>
</ReqRef><ReqRef
 Id="66901d6f-fcdd-4ddb-89e1-57f86cb9fcce"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="376cf966-7b5d-402a-a800-93d873ef7dce"
>
</ReqRef><ReqRef
 Id="752d0832-7cfa-4424-96f7-d3fbb447a20e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e70499f3-2fba-4f3c-a3e3-b5c9e888ca12"
>
</ReqRef><ReqRef
 Id="1be02ad3-ca38-452c-a795-e398d991b2da"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ecc8719f-0efc-4af6-8aa3-ca0ed120665f"
>
</ReqRef><Comment>Otherwise, if the maximum time to maintain a communication session is reached, the connection is considered as lost.</Comment>
<PreConditions>
<PreCondition
 Guid="d8e25a87-d35c-437f-864a-def0637bce1e"
>NOT SessionManagementData.ConnectionIsEstablished</PreCondition><PreCondition
 Guid="0a7021de-e191-4898-b26d-a0940b487b89"
>ConnectionLostTime + MaxTimeToMaintainACommunicationSession &lt;= Kernel.DateAndTime.CurrentTime</PreCondition></PreConditions>
<Actions>
<Action
 Guid="2d58a44a-39a5-4bf5-9712-d9525d21cb8d"
>THIS &lt;- ConnectionStateSM.Inactive</Action><Action
 Guid="1e8ee9e1-e346-41b2-b922-608f09cb6551"
>SpecialCaseSessionEstablishmentReason &lt;- SpecialCaseSessionEstablishmentReasonEnum.EstablishDueToLossOfConnection</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle safe radio connection status"
 Guid="6bcaa9e4-5510-4317-8477-dd9b27e5beb6"
>
<Comment>According to the current status of the safe radio connection, it may be declared or not as terminated.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Previous status was Connection Up"
 Guid="fba1350e-b81c-4076-a474-a74e0261e185"
>
<ReqRef
 Id="cf256420-4b87-4caf-a1cb-8e8e17d3bdca"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fb6f1e9f-5224-4ce9-b96a-a37db310ee6a"
>
</ReqRef><ReqRef
 Id="faa589ef-1db3-49b8-b4e9-66bca10c1754"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c4f1e422-9e52-45e3-b907-5681fb28c087"
>
</ReqRef><ReqRef
 Id="ca032528-1cb2-4646-bcad-67c92912f36f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bc1b0ad8-793c-4f38-acf2-a61098aba54a"
>
</ReqRef><Comment>If the previous status of the safe radio connection was &quot;Connection Up&quot;, then the safe radio connection is declared as terminated.</Comment>
<PreConditions>
<PreCondition
 Guid="fdf0690f-8c7b-4ea5-b89d-cd31b038a0f6"
>SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionUp</PreCondition></PreConditions>
<Actions>
<Action
 Guid="a81c9085-62ed-47f6-91c1-9573073688c8"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.NoConnection</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Previous status was Connection Lost or Setup Failed"
 Guid="ae37f4d1-cda8-4873-8ece-d9937e3b399b"
>
<ReqRef
 Id="e9e7d5c2-c94d-4bb6-8aea-136e28beafd2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a5f5b60c-10ba-463d-8b00-4e0e07fefd7a"
>
</ReqRef><ReqRef
 Id="0f9d860a-2cb9-472d-95ee-28c1c9bd5062"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="dbf4abd4-5d2e-480a-826e-4fc5ce1c2e78"
>
</ReqRef><ReqRef
 Id="ca032528-1cb2-4646-bcad-67c92912f36f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5244d5d4-048d-486c-b5c7-c83e17a9e58e"
>
</ReqRef><Comment>If the safe radio connection was already declared as Lost, then, if no Start of Mission procedure is on-going, the safe radio connection is declared as terminated.</Comment>
<PreConditions>
<PreCondition
 Guid="b57d3086-f161-4390-bbfd-d8c3b479dc8b"
>SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionLostOrSetUpFailed</PreCondition><PreCondition
 Guid="11f53a2e-cad9-47b3-bf29-0e89837f3128"
>Kernel.HandleModeChange not in Kernel.HandleModeChangeSM.StartOfMission</PreCondition></PreConditions>
<Actions>
<Action
 Guid="516bc76f-b39a-46ad-98de-6bb086ab71b2"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.NoConnection</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Connection is lost, &quot;connection status&quot; timer expired"
 Guid="87b4c89c-376f-4991-a150-e2ab9347ed7d"
>
<ReqRef
 Id="cd18a937-9dc2-456d-bee7-a61bcd564e32"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="65d2ea79-4883-497a-a781-77ac9f1cdd04"
>
</ReqRef><ReqRef
 Id="24cfec76-595f-41de-920e-42c8da108914"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f6567b6d-d067-4c6c-8035-17978cd5b099"
>
</ReqRef><ReqRef
 Id="e59a9c78-fdeb-4660-8f4c-3bb03d6b2bd6"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="81f579e5-4764-4325-958b-01fd681a9d2c"
>
</ReqRef><ReqRef
 Id="ca032528-1cb2-4646-bcad-67c92912f36f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="888a3649-ffc6-4f6b-9e2e-453a267f07c5"
>
</ReqRef><Comment>If the connection is still lost and the &quot;connection status&quot; timer expires, the safe radio connection is considered as lost.</Comment>
<PreConditions>
<PreCondition
 Guid="064e51ea-ce48-42f7-ab9e-bdc921765caa"
>ConnectionLostTime + ConnectionStatusTimer &lt;= Kernel.DateAndTime.CurrentTime</PreCondition></PreConditions>
<Actions>
<Action
 Guid="2b49902b-8504-4950-bc31-02fe3e8b403d"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.ConnectionLostOrSetUpFailed</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State><State
 X="130"
 Y="320"
 Width="120"
 Height="50"
 Implemented="TRUE"
 Name="ConnectionEstablished"
 Guid="b48c689d-c126-4a59-9e2e-a7bf9b28f2a1"
>
<Comment>The &quot;main&quot; state.</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="68254766-949b-4d1a-9344-b3b8e7e70180"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Loss of the safe radio connection is detected"
 Guid="b6f6217c-72ba-43e7-bd6e-33cc9dce3d16"
>
<Comment>When a loss of the safe radio connection is detected, the system goes to the state Connected.ConnectionLost an stores the current time, in order to know how long the safe radio connection has to be considered as established.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Loss of the safe radio connection is detected"
 Guid="8779a660-1dd0-4176-80b8-c172f1e2b5ba"
>
<PreConditions>
<PreCondition
 Guid="6222ed14-9c42-42d5-b29f-2e5222369f8c"
>SessionManagementData.ConnectionIsEstablished == False</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Verify if the train is inside an announced radio hole."
 Guid="a74a6f9a-ffdb-4c21-8c7a-62e2a33eb02e"
>
<Comment>If the connection is lost when the train is inside an announced radio hole, the safe radio connection is considered as lost.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Connection lost, the train is inside an announced radio hole"
 Guid="271faf59-7b23-4404-b868-ed9ba537f3f4"
>
<ReqRef
 Id="ca032528-1cb2-4646-bcad-67c92912f36f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="239adfd0-723e-46e9-8479-a3a51fcd9711"
>
</ReqRef><ReqRef
 Id="faa589ef-1db3-49b8-b4e9-66bca10c1754"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="23dd4add-24c0-4bdf-9a33-6ec6615aada5"
>
</ReqRef><ReqRef
 Id="a977087b-cf09-465c-b072-4ac0d0903dc7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8cfd489e-bad9-4415-ba6c-e9914db45169"
>
</ReqRef><ReqRef
 Id="e36dd5fc-81ea-4253-8535-4e5b4afd1b54"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0e85a1f8-f5a5-404f-ac29-eef9a50d4452"
>
</ReqRef><ReqRef
 Id="558b2068-001d-4f9f-902b-2cd23fb269d9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="78c2b289-ebb1-4c6e-ad26-791d5c4deb8d"
>
</ReqRef><Comment>If the train is inside an announced radio hole, the connection is considered as lost and new attempts to establish the communication session will be executed only when the radio hole end will be reached.</Comment>
<PreConditions>
<PreCondition
 Guid="98dfced5-c8e3-4402-9c30-42e6826e38b0"
>Kernel.TrackDescription.TrackConditions.General.IsInsideRadioHole()</PreCondition></PreConditions>
<Actions>
<Action
 Guid="31e5f409-b9e6-446b-867c-b18a87681e9d"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.NoConnection</Action><Action
 Guid="6d4583aa-006a-45ae-9cda-74616d81d751"
>THIS &lt;- ConnectionStateSM.Inactive</Action><Action
 Guid="ec9f6b78-cb37-4e99-9057-9da349ca8a75"
>SpecialCaseSessionEstablishmentReason &lt;- SpecialCaseSessionEstablishmentReasonEnum.EstablishDueToRadioHole</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Connection lost, the train is not inside an announced radio hole"
 Guid="13af3a5b-5f98-48b4-90c0-a46a36f84d3a"
>
<ReqRef
 Id="cd18a937-9dc2-456d-bee7-a61bcd564e32"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bbb6faeb-db9d-4974-b1c6-dd221e21af9b"
>
</ReqRef><ReqRef
 Id="308624ea-ea91-4451-b8c4-1cfbc9094f8e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="be8eff81-4014-45d1-b4e5-ca9ef2b8ea0f"
>
</ReqRef><ReqRef
 Id="529343f5-9881-4318-8dcc-53dade4fe1df"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b6326d63-de68-4338-aa3d-2e3bdbff8781"
>
</ReqRef><ReqRef
 Id="ac42de65-1111-47f1-904b-907bce323de2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b979e6de-0060-4dbb-93bd-97f3a6ff0ffe"
>
</ReqRef><ReqRef
 Id="dd37c53c-3853-4b84-8080-c287bcf0cc25"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f72da592-8ff0-45cf-89ef-e9f37c5f28b3"
>
</ReqRef><Comment>If the train is not inside a radio hole, it will try to establish the connection again.</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="31f3937f-b213-4f3e-ad34-8537395d0015"
>ConnectionLostTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="c4a3e6fd-bbd3-4c4a-9592-37f17c96b1ac"
>LastRequestTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="bef7600f-38e6-4557-9a1d-4f08e07554dd"
>SessionManagementData.ConnectionRequestIsSent &lt;- True</Action><Action
 Guid="ed5c1847-6ece-4c06-a1fe-50505630488c"
>THIS &lt;- ConnectionStateSM.Connected.ConnectionLost</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State></States>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Order to contact an RBC is received"
 Guid="0f45f74c-edd2-48e5-af53-1c74c195841c"
>
<ReqRef
 Id="dc7b33b5-d923-42f3-be12-580edb475353"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fa514d6c-987d-4d07-95e8-853b7bbf8fdb"
>
</ReqRef><ReqRef
 Id="e0a2f873-6bb3-4327-abdc-4444932d69aa"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="92fe33e1-3eb4-4288-bade-44471e8a276c"
>
</ReqRef><ReqRef
 Id="e65aa492-e72e-4bdc-896b-8462bf7b8ea9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="345712ec-f586-4161-a260-7c2b7c4eb719"
>
</ReqRef><ReqRef
 Id="bc41e5e5-6fff-4b96-a901-9bc45f108b16"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8f56dd0f-e588-4cc0-9e6b-bd50c23eb281"
>
</ReqRef><ReqRef
 Id="8f6d9e5c-7082-4ff4-b968-cfe98c4ad1d5"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0294c3a1-1957-4f77-a8cf-82cee6f10c44"
>
</ReqRef><ReqRef
 Id="cbb3ad4b-7d33-4161-b151-347463291135"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1263efc3-144f-4ae8-beba-bc2dd63ba63e"
>
</ReqRef><ReqRef
 Id="bd6563bc-06fe-447b-8afc-e210141cc921"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7a3a6f67-69f6-4260-8fdb-bfadfe6a3987"
>
</ReqRef><ReqRef
 Id="84374b3d-739e-4c5f-909d-4c138dedec38"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4c02cdf5-6671-4822-b77c-666272117319"
>
</ReqRef><Comment>Handle orders to contact an RBC.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Order to contact another RBC is received"
 Guid="63fe5c9c-8eee-4877-90ab-bc7187858c4a"
>
<Comment>When a connection to the RBC is established and a request to contact an RBC is received, the on-board sends the Termination of communication session message to the RBC and goes to Terminating state.</Comment>
<PreConditions>
<PreCondition
 Guid="45eed858-9748-4822-b4df-ef101907fd7c"
>ContactRBCOrder != EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="1a1a20cb-a8df-46b4-acc5-16faf2b26075"
>LastRequestTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="ef59530a-188c-48af-86c4-658498732214"
>NumberOfSentRequests &lt;- 0</Action><Action
 Guid="5ab8eb84-a856-41fe-81be-92cc80d83d99"
>SendTerminationOfCommunicationSession()</Action><Action
 Guid="37faeac1-ef2c-41c8-ab97-8497c4cfcec4"
>THIS &lt;- ConnectionStateSM.Terminating</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle termination of communication session"
 Guid="db567429-aa30-4cff-a4f1-1a09b8cb0be8"
>
<Comment>If the order action to terminate the communication session, it has to be erased (since it is handled here).</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle termination of communication session"
 Guid="5dd79cd1-199b-4099-9a8c-fcec0a041144"
>
<PreConditions>
<PreCondition
 Guid="a5ebfacd-6ea2-49c1-9d34-4a9492fec07c"
>ContactRBCOrder.ActionToPerform == ContactActionEnum.Terminate</PreCondition></PreConditions>
<Actions>
<Action
 Guid="157b5e2a-e5c0-466b-937c-94f2fbf3214e"
>ContactRBCOrder &lt;- EMPTY</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State><State
 X="180"
 Y="430"
 Width="100"
 Height="80"
 Implemented="TRUE"
 Name="Terminating"
 Guid="852724a0-2e07-4fc6-ba9d-25a46e4032a2"
>
<Comment>The connection is being terminated.</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="dfd5369b-7468-4e57-b4c3-591d53607134"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle termination of the communication session"
 Guid="0b222548-b9a6-47d8-8a8c-8f261e6eb180"
>
<ReqRef
 Id="e094e23a-bd94-4440-8632-705782494f35"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="63123e27-5ac2-4644-8140-a5dd7442b99b"
>
</ReqRef><ReqRef
 Id="84374b3d-739e-4c5f-909d-4c138dedec38"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="59066bae-3e0b-4004-b5b2-be0402ed6023"
>
</ReqRef><Comment>If the acknowledgement of termination of the communication session is received, the session is considered as terminated and the process goes to Inactive state.

The information related to the current communication session is reinitialized.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Acknowledgement of termination of the communication session received"
 Guid="cc43a2d6-cf19-4c54-b780-87cc183105b5"
>
<ReqRef
 Id="533898f6-3814-4427-9e81-e9a93ab96413"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ecb077d3-9759-49d9-9b0b-323fd0990583"
>
</ReqRef><ReqRef
 Id="faa589ef-1db3-49b8-b4e9-66bca10c1754"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="62bdc20c-6def-4e42-88b8-ffe432a254d9"
>
</ReqRef><ReqRef
 Id="ca032528-1cb2-4646-bcad-67c92912f36f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f248e6ac-9eae-4dc8-a660-50aa7c178025"
>
</ReqRef><Comment>When the acknowledgement of termination of the communication session is received, the session is considered as terminated and the on-board requests the release of the safe radio connection with trackside.</Comment>
<PreConditions>
<PreCondition
 Guid="7f763801-e844-4ab3-8b0f-19790f512002"
>SessionManagementData.AcknowledgementOfTerminationReceived</PreCondition></PreConditions>
<Actions>
<Action
 Guid="cf4d6f18-e067-47ef-af99-8b3cdfe23667"
>THIS &lt;- ConnectionStateSM.Inactive</Action><Action
 Guid="8a08daf0-bedb-4977-a7e3-57845212e89b"
>ReinitializeCommunicationInformation()</Action><Action
 Guid="b2911cf2-e495-44ac-9990-c74a924f43a4"
>SessionManagementData.Action &lt;- ContactActionEnum.Terminate</Action><Action
 Guid="647ebe75-16e6-45fe-b548-651236617b73"
>SessionManagementData.ConnectionRequestIsSent &lt;- True</Action><Action
 Guid="8123d25a-e014-4582-90b8-34922a36d18b"
>SafeRadioConnectionStatus &lt;- SafeRadioConnectionStatusEnum.NoConnection</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Repeat Termination of Communication Session message"
 Guid="87eca200-42d6-473a-8745-c19edc24eb83"
>
<Comment>If no acknowledgement of termination of the communication session is received during the defined period of time, the message Termination of Communication Session will be sent again.</Comment>
<PreConditions>
<PreCondition
 Guid="ebbbdd28-776f-4041-a17e-a784bdf6b436"
>LastRequestTime + TimeBeforeMessageRepetition &lt; Kernel.DateAndTime.CurrentTime</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Repeat Termination of Communication Session message"
 Guid="74dff78e-a344-4a11-93c2-e698be2bc6fc"
>
<Comment>If no acknowledgement is received from the trackside, the on-board will repeat the Termination of Communication Session request.

Aftter a defined number of repetitions, if no acknowledgement is received from the trackside, the on-board considers the communication session as terminated.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Send new request"
 Guid="b3a909c4-5069-4860-8ce2-fd7cf6766e91"
>
<ReqRef
 Id="dc7b33b5-d923-42f3-be12-580edb475353"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="13e5d684-7a46-4916-9f4f-f63351acf2f0"
>
</ReqRef><ReqRef
 Id="4d7758a5-c99b-4537-8da4-a51b99dafd40"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b3a69e03-afb3-40db-a5be-a2c43f9b96d9"
>
</ReqRef><Comment>If the request has to be sent again and the maximum number of requests has not yet been achieved, the request is sent again.</Comment>
<PreConditions>
<PreCondition
 Guid="d39bee63-0912-4fd7-8aa4-ceebf64406ef"
>NumberOfSentRequests &lt; NumberOfMessageRepetitions</PreCondition></PreConditions>
<Actions>
<Action
 Guid="8c94cd62-33d6-44a8-a726-b48c5e0f1d88"
>LastRequestTime &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="23e6bfe2-b29f-4f51-a757-32c619717618"
>SendTerminationOfCommunicationSession()</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Maximum number of requests sent"
 Guid="a41352cb-2ce8-49ed-84f9-0c2762b9f3e3"
>
<ReqRef
 Id="e0a2f873-6bb3-4327-abdc-4444932d69aa"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="23154fa5-ffb1-4040-b127-be2ffd711f99"
>
</ReqRef><ReqRef
 Id="f9f81d1e-22c3-429b-b29b-0c828790dce4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5de2594f-32e2-4cbb-ab59-cd7f551162c6"
>
</ReqRef><Comment>If a new request has to be sent but the maximum number of reqeusts has already been achieved, the on-board considers the communication session as terminated.</Comment>
<PreConditions>
<PreCondition
 Guid="5616a12c-8a52-4abf-8880-c4a24d75d94e"
>NumberOfSentRequests== NumberOfMessageRepetitions</PreCondition></PreConditions>
<Actions>
<Action
 Guid="ca565153-dca3-42f4-a94e-b62cfede617a"
>THIS &lt;- ConnectionStateSM.Inactive</Action><Action
 Guid="f3f8fa5b-bb54-459b-836d-86a309a18c16"
>ReinitializeCommunicationInformation()</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State></States>
</StateMachine></StateMachines>
</Structure><Structure
 Default=""
 X="10"
 Y="210"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="ContactOrderStruct"
 Guid="0b20f5b7-2179-44b2-b8c4-19c69efa393a"
>
<ReqRef
 Id="951fc6d8-739b-4bd4-9361-5686840e8b5a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="aad52615-8995-411d-beac-095d25210560"
>
</ReqRef><ReqRef
 Id="711a8f6b-f758-4405-bb80-f9b331940c39"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="53323bec-6f3a-4084-adce-0d087292a1ba"
>
</ReqRef><ReqRef
 Id="64296fc8-fe88-499d-b63e-d570a4a39744"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d37b22c1-9b7f-4129-a033-3e1fab068fc5"
>
</ReqRef><Comment>Contains information needed to contact an RBC or an RIU.</Comment>
<StructureElement
 TypeName="RBCIdStruct"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 Name="Id"
 Guid="090d6f31-3d17-41d8-a297-773c0dad4df8"
>
<ReqRef
 Id="cfa25d7e-ba55-4b80-ba0e-931979188cd9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7e3ada7b-82db-4b53-aa7f-5bf0c7825f02"
>
</ReqRef><ReqRef
 Id="bf375eb5-37d4-48bc-9e97-ed34696dd18d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9a7c2039-8f5c-4b40-863e-1a727356ea4f"
>
</ReqRef><ReqRef
 Id="27b4bef1-4915-47e2-b193-48f7f3daae5c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="278d8f6e-9124-4385-8139-53c90b4599b7"
>
</ReqRef><Comment>The identity of the RBC.</Comment>
</StructureElement><StructureElement
 TypeName="String"
 Default="&apos;&apos;"
 Mode="Internal"
 Implemented="TRUE"
 Name="PhoneNumber"
 Guid="8403992a-5c33-472a-915b-6e9e82f06133"
>
<ReqRef
 Id="e7d678f2-4b9e-4960-818a-8773557c1742"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4093722b-d3f7-4c8e-9f44-3881216778b4"
>
</ReqRef><ReqRef
 Id="1edceb91-f111-4748-af9c-6d142efbb335"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2e03d81a-fdd4-4dc8-911c-9b562d20b4e6"
>
</ReqRef><ReqRef
 Id="95aa03b6-4c5a-49a1-ac97-d11d63ebc609"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="944bd39d-7437-4b63-b998-e7cac319656a"
>
</ReqRef><Comment>Phone number of the RBC.</Comment>
</StructureElement><StructureElement
 TypeName="ContactActionEnum"
 Default="ContactActionEnum.Establish"
 Mode="Internal"
 Implemented="TRUE"
 Name="ActionToPerform"
 Guid="86ca7945-4cbf-4528-960c-a9062aa3621e"
>
<ReqRef
 Id="c2b39282-833e-4fd4-abd9-3a72c47f0782"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2fb816a0-8a56-460d-a842-d80a533ad336"
>
</ReqRef><ReqRef
 Id="afd82aec-eda7-4ec0-8f16-8002a8687ab2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9540ded4-9a23-491b-95f0-5fd9dc61c7c2"
>
</ReqRef><Comment>The action to be performed.</Comment>
</StructureElement><StructureElement
 TypeName="Boolean"
 Default="Boolean.False"
 Mode="Internal"
 Implemented="TRUE"
 Name="AppliesToSleepingUnits"
 Guid="4701d82d-24e3-4223-926c-223b4125b649"
>
<ReqRef
 Id="53c901d2-749c-41ce-be89-218897ceff07"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="589b9aa8-6e18-48a6-aab9-eedfa3941ab0"
>
</ReqRef><ReqRef
 Id="bae735db-1bcf-40d2-b035-f39a5663407f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d966b111-ad3c-4937-9f9c-18b07bd04154"
>
</ReqRef><Comment>Indicates whether the order applies also to Sleeping units.</Comment>
</StructureElement><StructureElement
 TypeName="BaseTypes.Distance"
 Default="BaseTypes.Distance.Unknown"
 Mode="Internal"
 Implemented="TRUE"
 Name="EndOfValidityLocation"
 Guid="2f3c33db-f3fd-4da4-8bd3-cdc3386b1053"
>
<ReqRef
 Id="8fa3c468-ff7b-4fa4-9f9c-790f481b3f5c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8c8fd01a-48f2-42f7-b374-40e507f915ec"
>
</ReqRef><ReqRef
 Id="bb662eea-95fc-427d-8968-9c64c70423fa"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d0340bb1-189e-4eac-ac5a-c60f5b47b906"
>
</ReqRef><ReqRef
 Id="3cf876e9-fd29-41a4-a3d3-154e60b988e0"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="259996a2-b33e-4503-b2c4-95db21aac9cc"
>
</ReqRef><Comment>Indicates the location where the contact order has to be removed.</Comment>
</StructureElement></Structure><Structure
 Default=""
 X="10"
 Y="110"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="RIUStruct"
 Guid="b15198c3-238e-44cf-bd78-8b40d48ea78f"
>
<ReqRef
 Id="64296fc8-fe88-499d-b63e-d570a4a39744"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="17bba8ad-3761-4af8-8daf-f79e39a3b371"
>
</ReqRef><Comment>Represents one instance of the communication with RIU.</Comment>
<StructureElement
 TypeName="ContactOrderStruct"
 Default="EMPTY"
 Mode="Internal"
 Implemented="TRUE"
 Name="ContactRIUOrder"
 Guid="c3e64fd7-0dd2-4223-92a2-d1329120f4ae"
>
<Comment>Provides the order to contact the RIU, if any.</Comment>
</StructureElement><StructureElement
 TypeName="String"
 Default="&apos;&apos;"
 Mode="Internal"
 Implemented="TRUE"
 Name="Id"
 Guid="a69353b2-8731-4f5b-aeb0-cb1b2109d29b"
>
<Comment>Identifier of the RIU.</Comment>
</StructureElement></Structure><Structure
 Default=""
 X="270"
 Y="390"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SessionManagementStruct"
 Guid="395169e1-4c72-48ca-950b-fa0d473758a1"
>
<ReqRef
 Id="e094e23a-bd94-4440-8632-705782494f35"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b107cfe4-c5f4-439a-8d3f-e91ee41768f3"
>
</ReqRef><ReqRef
 Id="5b9e9eb3-ffa4-47c2-a6f5-9fa6efc58ffe"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="328c7ee7-f109-4458-8634-3893a82d3a1a"
>
</ReqRef><Comment>Data used to establish a session.</Comment>
<Rules>
<Rule
 Priority="Verification"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Clean up"
 Guid="205e01b9-eb50-4780-9ba5-1d03cd0a56e7"
>
<Comment>Resets the request to false.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Clean up"
 Guid="6fdc24b9-9135-4544-8be5-2872afecf193"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="554740df-b62d-4d21-9e26-a8e2554409c8"
>ConnectionRequestIsSent &lt;- False</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
<StructureElement
 TypeName="Boolean"
 Default="Boolean.False"
 Mode="Outgoing"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="ConnectionRequestIsSent"
 Guid="3da0a1c7-ca89-43ab-9597-09b7adf15b15"
>
<Comment>Set to True when a request to establish a safe radio connection has to be sent.</Comment>
</StructureElement><StructureElement
 TypeName="SystemVersionStruct"
 Default=""
 Mode="Incoming"
 Implemented="TRUE"
 Name="SystemVersion"
 Guid="abb42052-649b-4e21-b7c9-461a8f11576a"
>
<ReqRef
 Id="02f20f26-3445-49b9-95cf-a6948ab029b8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="82825918-5104-41e8-b1bb-34f14260e879"
>
</ReqRef><Comment>The system version of the trackside.</Comment>
</StructureElement><StructureElement
 TypeName="ContactActionEnum"
 Default="ContactActionEnum.Establish"
 Mode="Outgoing"
 Implemented="TRUE"
 Name="Action"
 Guid="ccb009cb-f504-4789-b154-dcf7169abe80"
>
<ReqRef
 Id="5b9e9eb3-ffa4-47c2-a6f5-9fa6efc58ffe"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="cc4d43f5-fdaf-432f-b1ce-5ce2683a1250"
>
</ReqRef><ReqRef
 Id="e094e23a-bd94-4440-8632-705782494f35"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9f747573-7ad6-42a6-8ce9-98b7458029d7"
>
</ReqRef><Comment>Indicates if the safe radio connection has to be established or released.</Comment>
</StructureElement><StructureElement
 TypeName="Boolean"
 Default="Boolean.False"
 Mode="Internal"
 Implemented="TRUE"
 Name="AcknowledgementOfTerminationReceived"
 Guid="80da740b-776c-4027-8852-3ce69d47eaf8"
>
<ReqRef
 Id="e094e23a-bd94-4440-8632-705782494f35"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9bf2479d-7466-464c-a0d7-d89e7fc778c7"
>
</ReqRef><Comment>Is set to true when, during the termination of the communication session procedure, on-board receives the acknowledgement of termination from the RBC.</Comment>
</StructureElement><StructureElement
 TypeName="Boolean"
 Default="False"
 Mode="InOut"
 Implemented="TRUE"
 Name="ConnectionIsEstablished"
 Guid="1c04490a-d03a-492b-81ec-bbf9c60fd7db"
>
<ReqRef
 Id="1ead58b3-f05d-46bd-b3f8-bc0a16010cdd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0f940401-02b0-4101-bebd-18261582bd51"
>
</ReqRef><Comment>Set to true if the safe radio connection is set-up.</Comment>
</StructureElement><StructureElement
 TypeName="Boolean"
 Default="False"
 Mode="Incoming"
 Implemented="TRUE"
 Name="ConnectionRequestIsReceived"
 Guid="a6d33ff5-d083-45be-83a3-68ff4212ed87"
>
<ReqRef
 Id="484b41b4-a894-43b4-9ee4-a7227ddfd3aa"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ae52e345-9015-4eda-b625-9434ac9440d0"
>
</ReqRef><Comment>This variable is set to True when the on-board requests the establishment of communication session.</Comment>
</StructureElement><StructureElement
 TypeName="Boolean"
 Default="False"
 Mode="Internal"
 Implemented="TRUE"
 Name="InitiationOfACommunicationSessionReceived"
 Guid="490547bc-7b30-4783-8531-e6fecdf5e3e1"
>
<ReqRef
 Id="5553cd84-d563-49a7-8514-0b4890a35066"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fd072b10-5c0e-46bf-b970-af90bc934bef"
>
</ReqRef><Comment>Indicates if the trackside has sent the Initiation of a communication session message.</Comment>
</StructureElement></Structure><Structure
 Default=""
 X="10"
 Y="310"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="RBCIdStruct"
 Guid="06bc7e20-822b-4896-a367-bc92333c4911"
>
<ReqRef
 Id="816c0d6e-276a-4016-ad89-124dca81531d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c364a117-eb0c-4552-8ff4-6c780c66f618"
>
</ReqRef><Comment>Identity of an RBC.</Comment>
<StructureElement
 TypeName="Messages.NID_C"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 Name="Country"
 Guid="05cede5e-c482-41df-9072-e4113ad144b9"
>
<Comment>Country of the RBC.</Comment>
</StructureElement><StructureElement
 TypeName="Messages.NID_RBC"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 Name="Id"
 Guid="aa91517d-2240-40b4-bfd9-8878fcc96be9"
>
<Comment>Identifier of the RBC.</Comment>
</StructureElement></Structure><Structure
 Default=""
 X="10"
 Y="390"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="RBCContactStruct"
 Guid="34a7c15c-662b-4a6d-a149-5587a333e7cf"
>
<ReqRef
 Id="f6cda523-6b70-489d-a6dd-e29b33d2a772"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e47b1bf4-8adc-4a5e-b229-064ffd680081"
>
</ReqRef><ReqRef
 Id="aca297a1-7d62-42ac-ab7e-6c8c590c5637"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="88537c38-7c30-4bc3-9405-7ba774c41949"
>
</ReqRef><Comment>Contains information about the last known RBC.</Comment>
<StructureElement
 TypeName="RBCIdStruct"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Id"
 Guid="99ae12d2-bc9c-4170-a5ac-5ec02a642457"
>
<Comment>Identifier of the RBC.</Comment>
</StructureElement><StructureElement
 TypeName="String"
 Default="&apos;&apos;"
 Mode="Internal"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="PhoneNumber"
 Guid="3367d1e9-5512-45ec-9356-57305e0372d5"
>
<Comment>Phone number of the RBC.</Comment>
</StructureElement><StructureElement
 TypeName="Default.DataState"
 Default="Default.DataState.Invalid"
 Mode="Internal"
 Implemented="TRUE"
 Name="DataState"
 Guid="45de8d20-e175-4ce8-b6a0-8f05a6e55a99"
>
<ReqRef
 Id="1ab51773-764d-4fc1-b533-351222363321"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="63488e79-0657-47bb-92de-056af2ceb3d3"
>
</ReqRef><ReqRef
 Id="a9f86939-1651-4064-9732-2d860f2d28af"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d8cbc8f3-4abd-41ed-beb1-724517e301b5"
>
</ReqRef><ReqRef
 Id="a9f86939-1651-4064-9732-2d860f2d28af"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="938cf163-1976-4f94-807f-82b13383ffde"
>
</ReqRef><Comment>Data state of the contact information.</Comment>
</StructureElement></Structure><Structure
 Default=""
 X="270"
 Y="110"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="TerminalStruct"
 Guid="d55c89a9-b712-45c6-a15c-1829f68822b8"
>
<ReqRef
 Id="865bbdd6-2010-4869-ab3e-bc538ce5fe4b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9d479d3a-f46e-441c-92ba-733d4471c6c5"
>
</ReqRef><Comment>Represents a mobile terminal.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Clean up"
 Guid="a7a5c641-f9f0-4813-9ea4-63b191323610"
>
<Comment>Erases the previous value of registration request sent.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Clean up"
 Guid="6cdf394b-5ffd-4007-96bd-eeab3500fefa"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="67bdc697-5152-42c0-875d-a9a1b7fd2d46"
>RegistrationRequestIsSent &lt;- False</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
<Procedures>
<Procedure
 Implemented="TRUE"
 Name="HandleAcceptingRBCContactOrder"
 Guid="1ad3468d-3948-45b2-8534-a90249aa39c1"
>
<ReqRef
 Id="dba4721e-ecc7-46a8-945a-ca408198338c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d954bc9b-2623-491a-aeb7-4c5ceb83ae79"
>
</ReqRef><ReqRef
 Id="68a814aa-d977-4ba8-8329-54aaaec00081"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="346c29df-1e86-42c4-b577-bd9e6ceb60f3"
>
</ReqRef><ReqRef
 Id="8f6d9e5c-7082-4ff4-b968-cfe98c4ad1d5"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e2c99cdb-988d-4f02-a73c-cace5a083e70"
>
</ReqRef><ReqRef
 Id="cbb3ad4b-7d33-4161-b151-347463291135"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c523ec19-4cc6-4a2f-a223-3084657c7455"
>
</ReqRef><ReqRef
 Id="bd6563bc-06fe-447b-8afc-e210141cc921"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fa6116c0-4827-4516-a86d-37555b6e410a"
>
</ReqRef><Comment>Handles previously received order to contact an Accepting RBC</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle Accepting RBC contact order"
 Guid="836c38bd-df22-4138-bbd9-2cfe1237d810"
>
<Comment>The contact order is transmitted to the RBC.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle Accepting RBC contact order"
 Guid="caa4d84b-1b31-4ec4-a38f-c677a9724dbd"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="f8407011-1eed-4334-9e92-d8c9a1b3e94f"
>RBCConnection.ContactRBCOrder &lt;- AcceptingRBCContactOrder</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Update the RBC connection status"
 Guid="c906f67a-230f-4e70-a79b-4405da449b2e"
>
<Comment>Handles the RBC connection status, according to the number of available terminals.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Two terminals available"
 Guid="dacc0763-beee-4447-a2c4-39114c973015"
>
<Comment>If two terminals are availabe on-board, the Accepting RBC connection will not be considered as the main RBC connection.</Comment>
<PreConditions>
<PreCondition
 Guid="8a0b9aeb-ff66-47bc-8993-95beee9fd5e0"
>Terminal1 != EMPTY</PreCondition><PreCondition
 Guid="157b04a8-81e8-4fec-b45e-b89db1feff76"
>Terminal2 != EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="5b7db2c9-656a-459c-a3ba-3fd1220b6bd9"
>RBCConnection.IsMainConnection &lt;- False</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Only one terminal available"
 Guid="78720a30-687d-4cfd-a9b3-aebbcb32b1eb"
>
<ReqRef
 Id="a42dcba0-6408-4385-8868-72b8e5a73a50"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="499af2b5-0ed5-4ef0-b190-4cec056e010f"
>
</ReqRef><ReqRef
 Id="ec004cb5-feae-45f5-beb7-9cd81eef4c9c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d2858cd9-8cf6-4528-83c8-2dae62e7e0f2"
>
</ReqRef><Comment>If only the current terminal is available, then it will remain the main connection.</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="adc8e47d-8ad7-4808-a160-f10a3705ada3"
>RBCConnection.IsMainConnection &lt;- True</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Remove the order"
 Guid="1a2c44ce-1ac0-4765-b082-57bb655e5cdd"
>
<Comment>Once the order has been handled, it is removed.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Remove the order"
 Guid="89c26baa-932a-47a4-b3ed-8ec500493c9e"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="a05dfa06-931f-401a-86d9-29afcc82063a"
>AcceptingRBCContactOrder &lt;- EMPTY</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure></Procedures>
<StructureElement
 TypeName="String"
 Default="&apos;&apos;"
 Mode="Internal"
 Implemented="TRUE"
 Name="Id"
 Guid="94afdc00-ee3b-416f-a426-21fea264a34c"
>
<Comment>Identifier of the mobile terminal.</Comment>
</StructureElement><StructureElement
 TypeName="String"
 Default="&apos;&apos;"
 Mode="Internal"
 Implemented="TRUE"
 Name="NetworkId"
 Guid="a38f3a7d-5646-4e2c-9bf3-7329e3d2d746"
>
<Comment>Identifier of the network.</Comment>
</StructureElement><StructureElement
 TypeName="RBCStruct"
 Default=""
 Mode="InOut"
 Implemented="TRUE"
 Name="RBCConnection"
 Guid="0af6403f-d522-46ef-ae39-17e5433e5c02"
>
<Comment>RBC connected on this terminal.</Comment>
</StructureElement><StructureElement
 TypeName="RegistrationStateSM"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 Name="RegistrationState"
 Guid="d3a02124-c1af-448b-9925-2d693ae4c23c"
>
<Comment>Current state of registration of the terminal.</Comment>
</StructureElement><StructureElement
 TypeName="Boolean"
 Default="False"
 Mode="Incoming"
 Implemented="TRUE"
 Name="RegistrationIsConfirmed"
 Guid="e54404f3-0fbf-432d-ae9d-d9cef9d49d41"
>
<Comment>Set to True when the mobile terminal was succesfully registered.</Comment>
</StructureElement><StructureElement
 TypeName="Boolean"
 Default="False"
 Mode="Internal"
 Implemented="TRUE"
 Name="RegistrationOrderIsReceived"
 Guid="24785dd8-cf71-4f1e-b851-d1636061acba"
>
<Comment>Indicates if an order to register the mobile terminal has been received.</Comment>
</StructureElement><StructureElement
 TypeName="Boolean"
 Default="False"
 Mode="Outgoing"
 Implemented="TRUE"
 Name="RegistrationRequestIsSent"
 Guid="1e98daa6-f5b1-4966-b1e0-819ebee8b313"
>
<Comment>Set to True when a request to register the mobile terminal is sent.</Comment>
</StructureElement><StructureElement
 TypeName="String"
 Default="&apos;&apos;"
 Mode="Internal"
 Implemented="TRUE"
 Name="NetworkIdToRegister"
 Guid="44ce713d-dc37-4cd2-8042-0d7087e19d7d"
>
<Comment>Indicates which is the id of the network that has to be registered.</Comment>
</StructureElement><StructureElement
 TypeName="ContactOrderStruct"
 Default="EMPTY"
 Mode="Internal"
 Implemented="TRUE"
 Name="AcceptingRBCContactOrder"
 Guid="9ef3a8be-10fe-410b-9cca-5f87ffffa450"
>
<Comment>In case of RBC/RBC handover including Radio Network border crossing, the registration to the new radio network has to be completed before the transition order is transmitted to the on-board. This element stores that order and transmits it once the terminal is registered.</Comment>
</StructureElement><StateMachines>
<StateMachine
 Default="NotRegistered"
 Implemented="TRUE"
 Name="RegistrationStateSM"
 Guid="67db97c6-7141-4e02-b661-ddca7847fe17"
>
<Comment>Represents the possible states of registering of mobile terminals.</Comment>
<States>
<State
 X="70"
 Y="100"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="NotRegistered"
 Guid="a7ea90ef-b040-4d71-a9e9-e24df229eef5"
>
<Comment>Initial state: the mobile terminal is not registered</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="df983598-b3b9-457b-a1d5-566901b957e1"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Registration order is received"
 Guid="beafd460-f29a-4e33-84a4-555c89a79170"
>
<Comment>If a registration order has been received, a request to register terminal is sent and the system goes to Registering state.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Registration order is received"
 Guid="7df57111-c014-46f5-9c21-22d1c682901e"
>
<ReqRef
 Id="4aa98857-a1f3-4fee-ab3c-0af871807ad8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f45b1a7b-a61b-4e25-91d5-96d6da4375bd"
>
</ReqRef><ReqRef
 Id="aa345d0e-f599-4016-b5b5-c68601d642fb"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ad2432a5-4b3f-4b67-bb43-08e82d0ad932"
>
</ReqRef><PreConditions>
<PreCondition
 Guid="ad7f21b5-0b7e-44df-92f1-1a7e950f69b6"
>RegistrationOrderIsReceived</PreCondition><PreCondition
 Guid="17000d60-a63d-4a8d-87a0-47828aabccfe"
>EstablishCommunicationSession()</PreCondition></PreConditions>
<Actions>
<Action
 Guid="9e7d5d30-f543-42e0-a83f-36e13134cba0"
>THIS &lt;- Registering</Action><Action
 Guid="7ef1e2fe-d075-4c5b-becf-9767795c2a0e"
>RegistrationRequestIsSent &lt;- True</Action><Action
 Guid="03529777-8a74-4e2a-94dc-699b28efc826"
>RegistrationOrderIsReceived &lt;- False</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State><State
 X="370"
 Y="100"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Registering"
 Guid="0bc71bd3-f982-452e-b883-81975aa5f9ed"
>
<Comment>When an order to register the mobile terminal is received, it is in registering state</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="0d150d6b-3421-4277-8d94-8eadf4911f0d"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Registration confirmed"
 Guid="bc3769ca-433a-431f-9f52-a8bcc56bc688"
>
<Comment>When the registration to the network has been confirmed, the system goes to Registered state.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Registration confirmed"
 Guid="1161b101-0f1d-468b-b5bc-3ce06b2625e6"
>
<PreConditions>
<PreCondition
 Guid="bd93048d-c524-419d-900c-9922b8ace478"
>RegistrationIsConfirmed</PreCondition></PreConditions>
<Actions>
<Action
 Guid="6df5355e-80ab-4d30-9c50-07679b269768"
>THIS &lt;- Registered</Action><Action
 Guid="fc9c3c1f-c4be-4231-949b-288450751e54"
>NetworkId &lt;- NetworkIdToRegister</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State><State
 X="670"
 Y="100"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Registered"
 Guid="b9d68c28-a04f-46a1-93f9-10dde8bbb604"
>
<Comment>When the registration confirmation is received, the mobile network is in registered state</Comment>
<StateMachine
 Implemented="TRUE"
 Guid="f4eb8fe7-c356-4800-96ff-ac657fbcd4c7"
>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle registration order and Accepting RBC contact order"
 Guid="56426945-901b-44ba-9d61-d2a52a9c235d"
>
<ReqRef
 Id="9f6c605e-3f76-4367-a7a4-7f4fa458ef67"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f8b3f5bf-0756-4503-b92b-40aa7e757ae4"
>
</ReqRef><ReqRef
 Id="efe0a2e1-60d1-4ead-b9be-018ab45d680c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8093e127-4a44-427d-bd03-7259ca779ae8"
>
</ReqRef><ReqRef
 Id="cbb3ad4b-7d33-4161-b151-347463291135"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2d855d27-e15b-4c37-9046-f2a19f825d7f"
>
</ReqRef><ReqRef
 Id="bd6563bc-06fe-447b-8afc-e210141cc921"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="071ad0a8-fb80-4bee-ab49-2dcc89fa9331"
>
</ReqRef><Comment>If an order to register to a network is received from the trackside, when it is ignored if a safe radio connection is being set-up or a communication session is already established.

Once the communication session is terminated and the safe radio connection is released, the radio network registration will be initiated for the requested network.

Note: a safe radio connection can only be set-up when the RBC connection is in state Connecting or Connected.

After that, if an order to contact an Accepting RBC was received, it will be handled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Registration order is received"
 Guid="00fe2530-9466-43d0-a4ea-93ff0660ebec"
>
<ReqRef
 Id="fc32fb41-1c57-4753-a923-fe676aabf35d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c2bc826f-5bbc-465a-9345-7adec40ad738"
>
</ReqRef><ReqRef
 Id="2faeb97f-3af1-456a-b8c7-70c5bfa05105"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6f9085d8-6845-452d-9ad9-37afe7463d20"
>
</ReqRef><ReqRef
 Id="0717ecbb-ac03-4120-9e37-d836facf9136"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="cc99c28c-a112-4dc1-b005-ff770e16b8a1"
>
</ReqRef><ReqRef
 Id="faeb3c32-a982-46f8-b780-09e1573916e8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bfac7475-249d-4f29-8980-1d21c1096d3c"
>
</ReqRef><ReqRef
 Id="dba4721e-ecc7-46a8-945a-ca408198338c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6c1127ba-470c-42b3-ac17-34480f6bbdeb"
>
</ReqRef><ReqRef
 Id="dcc51a42-0407-4ab9-855a-55dc04e2ce4e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="70803c4a-a5f0-48d9-9141-9b8fe4177bfe"
>
</ReqRef><Comment>First, if a registration order is received, register to the network.</Comment>
<PreConditions>
<PreCondition
 Guid="750af1cd-78f4-49b1-912d-21c46b11e6fe"
>RegistrationOrderIsReceived</PreCondition><PreCondition
 Guid="b0ae7084-c070-4a83-88ad-3044024b465c"
>RBCConnection.ConnectionState not in [ RBCStruct.ConnectionStateSM.Connecting, RBCStruct.ConnectionStateSM.Connected ]</PreCondition></PreConditions>
<Actions>
<Action
 Guid="065155db-ddc9-4232-a264-ba308cf6546f"
>THIS &lt;- Registering</Action><Action
 Guid="16d4c11f-71c2-438c-aed7-a3050f42a226"
>RegistrationRequestIsSent &lt;- True</Action><Action
 Guid="6b794970-4b5b-4735-93d3-112b10af6e7d"
>RegistrationOrderIsReceived &lt;- False</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Handle Accepting RBC contact order"
 Guid="8adcc888-e57c-41cd-86bf-55d7042f0cd0"
>
<ReqRef
 Id="dba4721e-ecc7-46a8-945a-ca408198338c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="84188ebf-17d5-4d9f-af9e-cea78f940fcb"
>
</ReqRef><ReqRef
 Id="68a814aa-d977-4ba8-8329-54aaaec00081"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="55faf8cb-1a8f-49df-91d7-aeb2a9339f39"
>
</ReqRef><ReqRef
 Id="e0778e14-e6ea-4f06-8c69-56236250b636"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="364ca9b0-c9f4-4354-aca1-f01cb935ceba"
>
</ReqRef><ReqRef
 Id="cbb3ad4b-7d33-4161-b151-347463291135"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="60884001-8a7a-4a17-bde2-475f6c5da3d5"
>
</ReqRef><ReqRef
 Id="8f6d9e5c-7082-4ff4-b968-cfe98c4ad1d5"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6818a035-eb09-4add-98b0-4a4693c7bf30"
>
</ReqRef><ReqRef
 Id="bd6563bc-06fe-447b-8afc-e210141cc921"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="92e3130d-16e9-419b-b79a-34dfd890a656"
>
</ReqRef><Comment>If no registration order is received but an order to contact an Accepting RBC has been received, the Accepting RBC is contacted.</Comment>
<PreConditions>
<PreCondition
 Guid="6609a8b2-f994-43be-92b5-da74987f9e89"
>AcceptingRBCContactOrder != EMPTY</PreCondition><PreCondition
 Guid="794b5113-e251-4f4a-8dc9-b8188f7513d9"
>RBCConnection.ConnectionState not in [ RBCStruct.ConnectionStateSM.Connecting, RBCStruct.ConnectionStateSM.Connected ]</PreCondition></PreConditions>
<Actions>
<Action
 Guid="4c9bfa8e-9202-472b-bf80-8e30b3ea5552"
>HandleAcceptingRBCContactOrder()</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</StateMachine></State></States>
</StateMachine></StateMachines>
</Structure><Structure
 Default=""
 X="780"
 Y="110"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="AvailableNetworksStruct"
 Guid="e6849568-73f7-4b28-ae32-8b6bf0058e00"
>
<ReqRef
 Id="88987d99-35ff-4f33-894e-06060476dc7d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="81bc9c91-72b9-4123-8780-3da0231cb9ab"
>
</ReqRef><Comment>Allows to request the list of available and allowed networkds, based on a request to the Mobile Terminal(s).</Comment>
<StructureElement
 TypeName="Default.Request"
 Default="Default.Request.Disabled"
 Mode="Internal"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="RequestState"
 Guid="92cbb691-f862-4800-bcc1-b1c3201d2980"
>
<Comment>Allows to request the list of available and allowed networks.</Comment>
</StructureElement><StructureElement
 TypeName="AvailableNetworksCol"
 Default="[]"
 Mode="Incoming"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Networks"
 Guid="0ed60605-c72c-4461-b890-b564097e7b37"
>
<Comment>Collection of available and allowed networks.</Comment>
</StructureElement></Structure><Structure
 Default=""
 X="480"
 Y="390"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SystemVersionStruct"
 Guid="d57ddcfd-645d-4096-81d5-c12c41bd57bb"
>
<ReqRef
 Id="02f20f26-3445-49b9-95cf-a6948ab029b8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="97b05239-dbfb-447a-953a-e1fbb1608040"
>
</ReqRef><Comment>Represents the system version received from the trackside.</Comment>
<StructureElement
 TypeName="SystemVersionEnum"
 Default="SystemVersionEnum.Version2_0"
 Mode="Internal"
 Implemented="TRUE"
 Name="Value"
 Guid="6b92d905-fc0e-4c7c-8f01-e8ea9c2663a8"
>
<Comment>The value of the system version.</Comment>
</StructureElement><StructureElement
 TypeName="Default.DataState"
 Default="Default.DataState.Unknown"
 Mode="Internal"
 Implemented="TRUE"
 Name="DataState"
 Guid="1d98ef8a-fbe4-4fe6-affb-c0d0d99bb986"
>
<Comment>The data state of the system version.</Comment>
</StructureElement></Structure><Structure
 Default=""
 X="480"
 Y="310"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="InMessageStruct"
 Guid="50bcfd9e-6f3f-4379-ab59-2422ddb04376"
>
<ReqRef
 Id="e700d18e-d4e8-422a-990c-f149f477ef14"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c35e52dd-9991-457a-87d1-8f328bd6baa8"
>
</ReqRef><ReqRef
 Id="e9f7415c-2605-40c6-82c5-5211a7679d76"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8a18ed17-db40-4963-a719-8b347db75333"
>
</ReqRef><Comment>Structure containing the message received from the RBC with its priority.</Comment>
<StructureElement
 TypeName="Messages.MESSAGE.TRACK_TO_TRAIN.Message"
 Default="EMPTY"
 Mode="InOut"
 Implemented="TRUE"
 Name="Message"
 Guid="ab984d43-c965-4d4c-b120-1489694e3ccd"
>
<Comment>The message received from trackside.</Comment>
</StructureElement><StructureElement
 TypeName="MessagePriorityEnum"
 Default=""
 Mode="Incoming"
 Implemented="TRUE"
 Name="Priority"
 Guid="0b2e7125-3440-427c-b7ba-4c8917135d86"
>
<Comment>The priority of the received message.</Comment>
</StructureElement></Structure></Structures>
<Collections>
<Collection
 TypeName="String"
 Default="[]"
 X="780"
 Y="200"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="AvailableNetworksCol"
 Guid="104401a1-8c78-4794-bf19-a0f04f17b077"
>
<ReqRef
 Id="88987d99-35ff-4f33-894e-06060476dc7d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8d18e7fe-9416-4292-a792-535d3df5e1e8"
>
</ReqRef><Comment>List of available and allowed networks.</Comment>
</Collection><Collection
 TypeName="SystemVersionEnum"
 MaxSize="3"
 Default="[]"
 X="630"
 Y="470"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SystemVersionsCol"
 Guid="44ac3d41-0bd0-4d96-b3e0-236b9806487b"
>
<ReqRef
 Id="790cf49e-a85c-4110-b567-fc5d57052339"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="12a9527d-0bf4-441e-9f73-b172a6a10e83"
>
</ReqRef><ReqRef
 Id="25af834a-3a24-459b-b5c8-97b85eddb2e8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9de807bb-b66f-4d46-9fb0-4bded8376599"
>
</ReqRef><Comment>Collection system versions supported by on-board.</Comment>
</Collection><Collection
 TypeName="Messages.MESSAGE.TRACK_TO_TRAIN.Message"
 Default="[]"
 X="630"
 Y="110"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="IncomingMessagesCol"
 Guid="283cbfc1-9561-4267-812a-14cff11444cf"
>
<ReqRef
 Id="c887c56e-758e-426a-a728-cf723b3b2baf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="17c6665d-b5f5-425f-a574-812935437d9e"
>
</ReqRef><Comment>Stores the messages sent by the Accepting RBC before it becomes the supervising RBC.</Comment>
</Collection></Collections>
<Functions>
<Function
 Type="Boolean"
 Default=""
 Y="540"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="HasActiveSession"
 Guid="7b48d082-5d7b-4d27-8757-6e110b3f9f7d"
>
<ReqRef
 Id="a2f8c5d0-9029-4c1f-b5bf-fee1dca550f7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d7366702-ff1d-4278-b4d6-ab392caaab2b"
>
</ReqRef><ReqRef
 Id="f4b1a027-643a-48c1-a840-1735e19ae661"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1585da45-384c-4bb1-8d20-801a20e325b3"
>
</ReqRef><ReqRef
 Id="58b99381-a184-4b10-8c25-d125705b5194"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="267a1a1e-4342-4fb3-8e7e-2665a3bbf0de"
>
</ReqRef><ReqRef
 Id="0a55611b-2936-44a8-89fb-8b7fa083a761"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="89286c79-15e3-4d68-8bcc-c7bef8ead11d"
>
</ReqRef><Comment>Indicates if a communication session is established with an RBC.</Comment>
<Cases>
<Case
 Name="Value"
 Guid="10904d1f-8fc9-4d89-a374-c156b560a9fe"
>
<Expression>Terminal1.RBCConnection.ConnectionState in EURORADIO.RBCStruct.ConnectionStateSM.Connected
  OR
Terminal2.RBCConnection.ConnectionState in EURORADIO.RBCStruct.ConnectionStateSM.Connected</Expression>
</Case></Cases>
</Function><Function
 Type="EURORADIO.RBCStruct"
 Default=""
 X="110"
 Y="540"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="CurrentRBCConnection"
 Guid="3f3bd225-5d45-4ad8-a3c3-4b15bd9d11e4"
>
<Comment>Provides the current RBC connection. If none of terminals is connected, RBC1 is provided.</Comment>
<Cases>
<Case
 Name="RBC2"
 Guid="71411cb1-fbc3-4d56-8c9e-a2ac172c6983"
>
<PreConditions>
<PreCondition
 Guid="6acd04d4-6b9c-4314-b8d4-8803db268530"
>Terminal2.RBCConnection.SafeRadioConnectionStatus != SafeRadioConnectionStatusEnum.NoConnection</PreCondition><PreCondition
 Guid="c4173ff8-7228-40ee-9259-b9cbbef201ea"
>Terminal2.RBCConnection.IsMainConnection</PreCondition></PreConditions>
<Expression>Terminal2.RBCConnection</Expression>
</Case><Case
 Name="RBC1"
 Guid="721da144-3a02-4f84-8e10-a29715edbe77"
>
<Expression>Terminal1.RBCConnection</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="220"
 Y="540"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="AllSessionsClosed"
 Guid="d5ab709a-c73f-4f2a-bece-c9c7586dcde5"
>
<ReqRef
 Id="abbd517e-8b49-43b4-8dfa-117c8988fa86"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0dc0a5ce-e9ad-4e66-9089-3cd52c0eb9cc"
>
</ReqRef><Comment>Indicates if all the Euroradio sessions are closed</Comment>
<Cases>
<Case
 Name="Value"
 Guid="570d8238-c486-4d19-bd40-02645a6b780e"
>
<Expression>Terminal1.RBCConnection.ConnectionState in EURORADIO.RBCStruct.ConnectionStateSM.Inactive
  AND
Terminal2.RBCConnection.ConnectionState in EURORADIO.RBCStruct.ConnectionStateSM.Inactive</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="330"
 Y="540"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="OneMobileTerminalIsAvailable"
 Guid="e31f0ce4-5ca7-4615-9f01-e835968b6bb2"
>
<ReqRef
 Id="d88669ab-b014-4a92-b565-0f1e46f40945"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8ea3d211-ac31-4faa-8ba9-4587b570b2aa"
>
</ReqRef><Comment>Indicates if at least one terminal is available.</Comment>
<Cases>
<Case
 Name="Value"
 Guid="8a425b2a-af9b-4a02-9cbc-8d1d15189bb3"
>
<Expression>Terminal1 != EMPTY
  OR
Terminal2 != EMPTY</Expression>
</Case></Cases>
</Function><Function
 Type="ContactActionEnum"
 Default=""
 X="440"
 Y="540"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="ConvertActionToPerform"
 Guid="fcc7735a-3e46-4160-a9cb-7124ea1d73e6"
>
<Comment>Converts the value received from the trackside to ContactActionEnum</Comment>
<Parameters>
<Parameter
 Type="Messages.Q_RBC"
 Name="anAction"
 Guid="2dc3f1b7-07ef-4192-a904-45caa04da49c"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="Establish"
 Guid="ceb08062-d72f-4cf5-877d-121ebb9ea7f9"
>
<PreConditions>
<PreCondition
 Guid="25b870bb-f06f-4a6d-b140-b8e5998a1b3f"
>anAction == Messages.Q_RBC.Establish_communication_session</PreCondition></PreConditions>
<Expression>ContactActionEnum.Establish</Expression>
</Case><Case
 Name="Terminate"
 Guid="5e2d31e6-1284-446b-bd20-6f8fb35aa180"
>
<Expression>ContactActionEnum.Terminate</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 Y="600"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="ConvertAppliesToSleepingUnits"
 Guid="71777804-f6af-463a-a0cd-be78c7cf123a"
>
<Comment>Converts the value indicating if the order applies to sleeping units to boolean</Comment>
<Parameters>
<Parameter
 Type="Messages.Q_SLEEPSESSION"
 Name="aValue"
 Guid="95b89cca-bddd-4920-a537-2f4c90e311f0"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="Applies to sleeping units"
 Guid="41f4167f-b8bf-4f20-80a1-09bccc192889"
>
<PreConditions>
<PreCondition
 Guid="7de92c40-a560-4c7c-8c3e-4d25a94f310c"
>aValue == Messages.Q_SLEEPSESSION.Execute_session_establishment_order</PreCondition></PreConditions>
<Expression>True</Expression>
</Case><Case
 Name="Doesn&apos;t apply to sleeping units"
 Guid="8de8ad88-30a2-4af6-b6a2-186d840a815d"
>
<Expression>False</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="110"
 Y="600"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="MobileTerminalRegisteredToNetwork"
 Guid="af2b63fd-7a74-4d0c-9dd5-640bccd97f2c"
>
<ReqRef
 Id="65314800-5286-475e-b755-60e19e8cb01d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="86dca3f3-96a5-4716-aab2-e171d185f8eb"
>
</ReqRef><ReqRef
 Id="25c7ba02-1985-488d-b506-b24eef2b11b4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="21560c78-c017-4f92-82b7-164ed6fbfc5a"
>
</ReqRef><ReqRef
 Id="ff5aeaff-49e3-489d-816f-c49fc05bc951"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5ffddbae-852a-4c6a-b270-2c53874223d9"
>
</ReqRef><Comment>Indicates if at least one mobile terminal is registered to a Radio Network.</Comment>
<Cases>
<Case
 Name="Value"
 Guid="8d5b3f0d-e99a-4b78-a893-b7f25eb488a9"
>
<Expression>Terminal1.RegistrationState in TerminalStruct.RegistrationStateSM.Registered
  OR
Terminal2.RegistrationState in TerminalStruct.RegistrationStateSM.Registered</Expression>
</Case></Cases>
</Function><Function
 Type="EURORADIO.TerminalStruct"
 Default=""
 X="220"
 Y="600"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="CurrentTerminal"
 Guid="1578f217-c304-4c22-98c7-cb41f87ae7b7"
>
<Comment>Provides the current terminal.</Comment>
<Cases>
<Case
 Name="Connection opened on terminal 1"
 Guid="688a99fe-65fa-4958-83a1-fd990459de79"
>
<PreConditions>
<PreCondition
 Guid="c3452b29-ef21-4a6f-88bd-7ae9c80cd9da"
>Terminal1.RBCConnection.SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionUp</PreCondition></PreConditions>
<Expression>Terminal1</Expression>
</Case><Case
 Name="Connection opened on terminal 2"
 Guid="909b1669-a4a2-4bb4-a8f8-ad28926921a0"
>
<PreConditions>
<PreCondition
 Guid="fb0f7a9d-b7ff-43e8-80d1-cb8b82186a20"
>Terminal2.RBCConnection.SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionUp</PreCondition></PreConditions>
<Expression>Terminal2</Expression>
</Case><Case
 Name="Terminal 2 is not registered"
 Guid="cdd75c3d-6b70-4b5c-a649-53a129d44fbc"
>
<PreConditions>
<PreCondition
 Guid="32745b2d-c50e-46dd-96a8-b56db9fb8695"
>NOT TerminalIsRegistered ( Terminal2 )</PreCondition></PreConditions>
<Expression>Terminal1</Expression>
</Case><Case
 Name="Terminal 2 is registered"
 Guid="66f6b667-960f-4fec-b6ee-96b6cf589e21"
>
<Expression>Terminal2</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="330"
 Y="600"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SessionIsAlreadyEstablishedWithRequestedRBC"
 Guid="c4eccae5-0e53-41e7-af15-9608b3f9878d"
>
<ReqRef
 Id="66543af0-6c4b-46a0-b17f-96ed3e1d37ba"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="26d3911c-cdb4-4242-8981-7159f2405edd"
>
</ReqRef><Comment>Indicates if the session is already established with the requested RBC.

It can only return false if there is no open session or if the last known RBC has to be contacted and the id of the currenly connected RBC corresponds to the last known RBC id.</Comment>
<Cases>
<Case
 Name="No open session"
 Guid="bdb5d993-9c32-4855-adcf-db92b3936ac0"
>
<PreConditions>
<PreCondition
 Guid="8455685c-d8f8-43ba-96b6-445565f557cb"
>AllSessionsClosed()</PreCondition></PreConditions>
<Expression>False</Expression>
</Case><Case
 Name="Contact last known RBC"
 Guid="64d6f106-510a-4e1f-84b6-125c437a5319"
>
<PreConditions>
<PreCondition
 Guid="bcb10fd3-510d-4c90-bae8-f07439b7b2bf"
>ContactOption == ContactOptionEnum.ContactLastKnownRBC</PreCondition><PreCondition
 Guid="5681dc01-53e7-409e-9433-13e0c39fa57b"
>LastKnownRBC.Id != CurrentRBCConnection().ContactData.Id</PreCondition></PreConditions>
<Expression>False</Expression>
</Case><Case
 Name="Otherwise"
 Guid="0996c4d0-015e-467b-a61e-cc13846a6c74"
>
<Expression>True</Expression>
</Case></Cases>
</Function><Function
 Type="SystemVersionEnum"
 Default=""
 X="440"
 Y="600"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="ConvertSystemVersion"
 Guid="83ef1cc8-6c4b-404d-9e99-8966e74cb8ae"
>
<Comment>Converts the system version received from the trackside to the SystemVersionEnum.</Comment>
<Parameters>
<Parameter
 Type="Messages.M_VERSION"
 Name="aVersion"
 Guid="f772ea4e-ee2a-4ce1-bdea-258aa519747b"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="Version1_0"
 Guid="a18bf2de-3a3a-45c5-8b64-aaced5f3aa55"
>
<PreConditions>
<PreCondition
 Guid="423e3c04-66ea-4d36-94d7-78e0034ef428"
>aVersion == Messages.M_VERSION.Version_1_0__introduced_in_SRS_1_2_0_and_re_used_in_SRSs_2_0_0__2_2_2__2_3_0</PreCondition></PreConditions>
<Expression>SystemVersionEnum.Version1_0</Expression>
</Case><Case
 Name="Version1_1"
 Guid="2220f792-2ec9-4a60-87d1-1328f7f93996"
>
<PreConditions>
<PreCondition
 Guid="a22a98f6-8ad4-4227-b1f9-c618de4f7c04"
>aVersion == Messages.M_VERSION.Version_1_1__introduced_in_SRS_3_0_0</PreCondition></PreConditions>
<Expression>SystemVersionEnum.Version1_1</Expression>
</Case><Case
 Name="Version2_0"
 Guid="a98094e3-1ecd-4bcc-a9ec-299b926c0fab"
>
<PreConditions>
<PreCondition
 Guid="f4f56c58-c98b-415b-b10f-834a43d8bdb0"
>aVersion == Messages.M_VERSION.Version_2_0__introduced_in_SRS_3_0_0</PreCondition></PreConditions>
<Expression>SystemVersionEnum.Version2_0</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 Y="660"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SystemVersionIsCompatible"
 Guid="28b8bd9c-0c28-4b56-8672-4510358507e8"
>
<ReqRef
 Id="790cf49e-a85c-4110-b567-fc5d57052339"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="408fea0c-e3fd-4aeb-a674-fcefc576398e"
>
</ReqRef><ReqRef
 Id="25af834a-3a24-459b-b5c8-97b85eddb2e8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="34ecb0db-985f-4a26-b5a8-0b90794321df"
>
</ReqRef><ReqRef
 Id="e3806294-c226-451a-b5c2-70b79a84dded"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b56ecb5f-c7a6-44d0-8bca-a5f1b86c0b35"
>
</ReqRef><Comment>Indicates if the system version received from the trackside is compatible with the system version of the on-board. The versions are compatible if their first number is the same.</Comment>
<Parameters>
<Parameter
 Type="SystemVersionEnum"
 Name="aVersion"
 Guid="f28983c1-e560-4c9e-8c49-0f46dbbf140a"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="Received version is 1_X"
 Guid="f63fe1f7-e087-4b82-b11a-10d4924c5294"
>
<PreConditions>
<PreCondition
 Guid="a8f7b491-13d0-4037-a543-2c2675a56a55"
>aVersion in [SystemVersionEnum.Version1_0, SystemVersionEnum.Version1_1]</PreCondition></PreConditions>
<Expression>THERE_IS X IN SupportedSystemVersions | ( X == SystemVersionEnum.Version1_0 OR X == SystemVersionEnum.Version1_1 )</Expression>
</Case><Case
 Name="Received version is 2_X"
 Guid="9205843b-d0a1-4198-9aa4-b991f1da5577"
>
<Expression>THERE_IS X IN SupportedSystemVersions | X == SystemVersionEnum.Version2_0</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="110"
 Y="660"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="TerminalIsRegistered"
 Guid="3bd20f4e-148d-4de7-89af-efb974a82094"
>
<Comment>Indicates if the provided terminal is registered.</Comment>
<Parameters>
<Parameter
 Type="EURORADIO.TerminalStruct"
 Name="aTerminal"
 Guid="12711288-b128-4515-ac14-d0435e91c454"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="Value"
 Guid="fbe56933-1e1c-4565-830d-b4da4c31441b"
>
<Expression>aTerminal != EMPTY
  AND
aTerminal.RegistrationState in TerminalStruct.RegistrationStateSM.Registered</Expression>
</Case></Cases>
</Function><Function
 Type="EURORADIO.RBCStruct"
 Default=""
 X="220"
 Y="660"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SelectRBCToContact"
 Guid="edc183ce-4765-4875-9d3a-fcdbb85d8b1d"
>
<ReqRef
 Id="e65aa492-e72e-4bdc-896b-8462bf7b8ea9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="927d2fea-b001-4d8b-b808-bac654cca437"
>
</ReqRef><Comment>Selects the RBC to contact according to the communication status. If no terminal is registered, then no RBC can be contacted.</Comment>
<Cases>
<Case
 Name="RBC on terminal 1"
 Guid="c2516180-752c-4b75-a604-42475c6ea10d"
>
<PreConditions>
<PreCondition
 Guid="bebfbaf8-71a7-4973-9307-24ea03553705"
>Terminal1 != EMPTY
  AND
TerminalIsRegistered ( aTerminal=&gt; Terminal1 )</PreCondition><PreCondition
 Guid="7bf2df5d-34de-4d11-bb4e-8236aef07917"
>Terminal2 != EMPTY
  AND
Terminal2.RBCConnection.SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.NoConnection</PreCondition></PreConditions>
<Expression>Terminal1.RBCConnection</Expression>
</Case><Case
 Name="RBC on terminal 2"
 Guid="f38511fd-a55d-4afb-bb3f-d18237b53299"
>
<PreConditions>
<PreCondition
 Guid="19f821b0-8ffe-49e3-9f2d-c42d8184b33d"
>Terminal2 != EMPTY
  AND
TerminalIsRegistered ( aTerminal=&gt; Terminal2 )</PreCondition></PreConditions>
<Expression>Terminal2.RBCConnection</Expression>
</Case><Case
 Name="Otherwise"
 Guid="901f46f5-6f6d-49a8-a397-ade1263afd05"
>
<Expression>EMPTY</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="330"
 Y="660"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SessionHasToBeEstablished"
 Guid="5038c7fd-eeb6-4629-878c-aa6f52c39063"
>
<ReqRef
 Id="a9881801-963e-4a33-98f1-1962fc249f4e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="55de055d-d65c-4ff7-b87a-80135a988920"
>
</ReqRef><ReqRef
 Id="e36dd5fc-81ea-4253-8535-4e5b4afd1b54"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1dd73c11-e996-4738-a8e5-cbb294030488"
>
</ReqRef><ReqRef
 Id="752d0832-7cfa-4424-96f7-d3fbb447a20e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2c2f48f7-ee72-45fc-93e3-031eb4eab2c2"
>
</ReqRef><ReqRef
 Id="1be02ad3-ca38-452c-a795-e398d991b2da"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a75c0c3c-b69f-4142-b538-ccc0cebdffa5"
>
</ReqRef><ReqRef
 Id="fbaaf410-a59f-40cd-b972-aa1e84116831"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9c8529a4-5198-4de6-9483-8f90ac636979"
>
</ReqRef><Comment>Indicates if a communication session has to be established.</Comment>
<Parameters>
<Parameter
 Type="EURORADIO.RBCStruct"
 Name="anRBC"
 Guid="6c09e0fd-ecb7-47eb-aaaf-39f94e0970ee"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="Establishment order is received"
 Guid="d9f492df-d0da-4799-98d2-f92e8dab335b"
>
<Comment>First case: an order to establish the communication session is received</Comment>
<PreConditions>
<PreCondition
 Guid="88494b47-b4df-49dd-9cac-c8aeaad524e3"
>anRBC.ContactRBCOrder != EMPTY
  AND
anRBC.ContactRBCOrder.ActionToPerform == ContactActionEnum.Establish</PreCondition></PreConditions>
<Expression>True</Expression>
</Case><Case
 Name="Establish session due to loss of safe radio connection"
 Guid="23a1d6c0-14c5-4f08-ae93-3f738cc84c23"
>
<Comment>Second case: if the safe radio connection was lost, the session has to be established again.</Comment>
<PreConditions>
<PreCondition
 Guid="85bd9e76-4cd8-4247-afe6-1fd60098e58e"
>anRBC.SpecialCaseSessionEstablishmentReason == SpecialCaseSessionEstablishmentReasonEnum.EstablishDueToLossOfConnection</PreCondition></PreConditions>
<Expression>True</Expression>
</Case><Case
 Name="Establish session due to end of announced radio hole"
 Guid="baf8a056-2659-4ab8-9879-bdb8602f0a74"
>
<Comment>Third case: if the connection was last due to an announced radio hole and the train has reached its end, the session has to be established again.</Comment>
<PreConditions>
<PreCondition
 Guid="b5e8db11-f4d9-426b-915b-6324ac7b9956"
>anRBC.SpecialCaseSessionEstablishmentReason == SpecialCaseSessionEstablishmentReasonEnum.EstablishDueToRadioHole</PreCondition><PreCondition
 Guid="44942523-b06e-4e90-94c0-c6d3f71ab6f8"
>NOT Kernel.TrackDescription.TrackConditions.General.IsInsideRadioHole()</PreCondition></PreConditions>
<Expression>True</Expression>
</Case><Case
 Name="Establish session due to mode change report"
 Guid="b68914c4-d26d-49c5-96df-f2f08fbebbeb"
>
<Comment>Fourth case: the mode change report has to be sent.</Comment>
<PreConditions>
<PreCondition
 Guid="a510e0d1-2f90-4b43-aea2-0b0b2e446ee2"
>anRBC.SpecialCaseSessionEstablishmentReason == SpecialCaseSessionEstablishmentReasonEnum.EstablishDueToModeChangeReport</PreCondition></PreConditions>
<Expression>True</Expression>
</Case><Case
 Name="Otherwise"
 Guid="74c5d7e9-13ef-45ae-9e1e-ae77e6ec2b8d"
>
<Expression>False</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="440"
 Y="660"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="MessageCanBeSent"
 Guid="e4578232-0a7b-4b6d-82f8-34004ee84e07"
>
<ReqRef
 Id="0495c96f-8aa3-4cc5-b09d-99f5379d6fcf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="aa2584bb-c269-46ca-841f-c36c01df6139"
>
</ReqRef><ReqRef
 Id="4fdfab4a-e8a0-4311-8b70-2b8945cd0f7a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6bda043d-8cc2-4f54-925f-a0a80adf54f3"
>
</ReqRef><Comment>Indicates if an outgoing message can be sent. The only condition to be satisfied is to have an established session. A message can thus be sent during a loss of the safe radio connection if the connection state is still &quot;Connected&quot;. But no message can be sent after the message &quot;Termination of communication session&quot; since after having sent this message the system goes to &quot;Terminating&quot; state.</Comment>
<Parameters>
<Parameter
 Type="EURORADIO.RBCStruct"
 Name="anRBC"
 Guid="b40133ab-d13d-4324-bde5-7de83839347c"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="Value"
 Guid="89ac9c68-8258-4a49-ae9d-2281f7d8966a"
>
<Expression>anRBC.ConnectionState in EURORADIO.RBCStruct.ConnectionStateSM.Connected</Expression>
</Case></Cases>
</Function><Function
 Type="EURORADIO.RBCStruct"
 Default=""
 Y="720"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SecondaryRBCConnection"
 Guid="74ee579a-acba-4659-83ae-89dc0f8c11b6"
>
<ReqRef
 Id="e48c27fe-8961-45a6-aa65-e8d83fd609ed"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a7c24585-39e3-4a01-9c9a-3fa8956609c4"
>
</ReqRef><Comment>Provides the accepting RBC, if any.</Comment>
<Cases>
<Case
 Name="RBC1"
 Guid="d7fd8869-52aa-46c6-bf2a-d3322c31b18e"
>
<PreConditions>
<PreCondition
 Guid="b6505431-2fc2-4a36-a175-574b65e91b1a"
>NOT Terminal1.RBCConnection.IsMainConnection</PreCondition></PreConditions>
<Expression>Terminal1.RBCConnection</Expression>
</Case><Case
 Name="RBC2"
 Guid="b8b2bbbd-f511-4026-80a0-20692f3adcf3"
>
<PreConditions>
<PreCondition
 Guid="079486c9-1e87-4e44-b1fc-f3931340f14c"
>Terminal2.RBCConnection.IsMainConnection</PreCondition></PreConditions>
<Expression>Terminal2.RBCConnection</Expression>
</Case><Case
 Name="Otherwise"
 Guid="bd8987f4-2817-4121-9791-f02667f5eb21"
>
<Expression>EMPTY</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="110"
 Y="720"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="OrderToTerminateHandingOverRBCIsReceived"
 Guid="c6080dad-e9ff-4072-b1d5-8700f0f8ca97"
>
<ReqRef
 Id="17777577-ec39-4845-8347-17b8ec4c74d4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c1356978-afb0-468b-868a-9df9458a623c"
>
</ReqRef><Comment>Indicates if the Handing Over RBC has sent an order to terminate the communication session.</Comment>
<Cases>
<Case
 Name="Two terminals available"
 Guid="33c52b57-ff79-4c7a-98b8-41d82e6a77a0"
>
<PreConditions>
<PreCondition
 Guid="fa959e0a-d306-48fc-aeb2-507a46af5cc6"
>Terminal1 != EMPTY</PreCondition><PreCondition
 Guid="9b982815-d940-4ef3-af12-b404546aa924"
>Terminal2 != EMPTY</PreCondition></PreConditions>
<Expression>SecondaryRBCConnection().ContactRBCOrder != EMPTY
  AND
SecondaryRBCConnection().ContactRBCOrder.ActionToPerform == ContactActionEnum.Terminate</Expression>
</Case><Case
 Name="One terminal available"
 Guid="45848e42-776d-4a90-9adc-a3a06ac157cc"
>
<Expression>CurrentRBCConnection().ContactRBCOrder != EMPTY
  AND
CurrentRBCConnection().ContactRBCOrder.ActionToPerform == ContactActionEnum.Terminate</Expression>
</Case></Cases>
</Function><Function
 Type="SafeRadioConnectionStatusEnum"
 Default=""
 X="220"
 Y="720"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SafeRadioConnectionStatusToDisplay"
 Guid="01f97d52-632a-4415-ba9d-13258655f467"
>
<ReqRef
 Id="03c854a9-637b-42ee-b747-173045437dd6"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="caa80c65-6722-4958-bea9-c18f15b45052"
>
</ReqRef><ReqRef
 Id="a5a3cbff-14ec-43ba-afca-63c2734d0414"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="26657bbd-ad58-49b8-8b34-9533578476bf"
>
</ReqRef><ReqRef
 Id="2be2d035-b42d-4e1b-9788-dded559e7f64"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="46df6750-813d-4506-83c2-5cf995fe55a6"
>
</ReqRef><Comment>Provides the Safe Radio Connection Status to display.

In normal cases, the Safe Radio Connection Status of the current connection is displayed.

The only one case where the status to display is that of the secondary connection, is when the Accepting RBC has already become the supervising RBC, but the connection with the Handing Over RBC has not yet been released.</Comment>
<Cases>
<Case
 Name="Status of secondary RBC connection"
 Guid="bf82c512-40c9-460b-ad10-85f4fe30d0c5"
>
<PreConditions>
<PreCondition
 Guid="514190b9-00d9-4441-8105-a81690a45408"
>SecondaryRBCConnection().SafeRadioConnectionStatus != SafeRadioConnectionStatusEnum.NoConnection</PreCondition><PreCondition
 Guid="df0005db-e407-4bad-ac83-088c0c650916"
>Kernel.TrainPosition.FrontEndPosition ( PointOfInterest =&gt; Default.DistanceInterval.Max ) &gt;= PositionReport.RBCTransitionLocation</PreCondition></PreConditions>
<Expression>SecondaryRBCConnection().SafeRadioConnectionStatus</Expression>
</Case><Case
 Name="Status of primary RBC connection"
 Guid="41e451b4-db69-4f57-9d05-fdef3cda4f86"
>
<Expression>CurrentRBCConnection().SafeRadioConnectionStatus</Expression>
</Case></Cases>
</Function><Function
 Type="DMI.RBCContactActionsCol"
 Default=""
 X="550"
 Y="540"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="GetDriverActionsForSoM"
 Guid="20e3b23a-2d80-4bc5-86b9-155e2c5d7fe2"
>
<ReqRef
 Id="88987d99-35ff-4f33-894e-06060476dc7d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4fb159ce-833a-4808-8869-1ddce907d864"
>
</ReqRef><ReqRef
 Id="ff5aeaff-49e3-489d-816f-c49fc05bc951"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="254d57b4-6a90-4101-b538-0dfa94ec1240"
>
</ReqRef><ReqRef
 Id="1ab51773-764d-4fc1-b533-351222363321"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="31520df7-3467-44cc-9fd4-70c27e579bb3"
>
</ReqRef><ReqRef
 Id="bc8058d6-c833-43cf-93a4-f446a3a326ac"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="161e14a5-bbec-4d72-8a48-2bdd4e34effc"
>
</ReqRef><ReqRef
 Id="a9f86939-1651-4064-9732-2d860f2d28af"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e0a48322-cfee-451f-ad93-61721a92fb93"
>
</ReqRef><ReqRef
 Id="3a73d38c-66b9-4e87-873d-9efe293f0f56"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7f727e19-d682-44f3-aedf-92a6c1c72516"
>
</ReqRef><Comment>Provides the possible Driver actions for connecting to an RBC during the Start of Mission procedure.</Comment>
<Cases>
<Case
 Name="No mobile terminal registered"
 Guid="537376e4-4c71-451c-bcc9-5c0847fd25a5"
>
<PreConditions>
<PreCondition
 Guid="de47f946-a102-4d92-93ac-58473a186252"
>NOT TerminalIsRegistered(CurrentTerminal())</PreCondition></PreConditions>
<Expression>[DMI.RBCContactActionEnum.ReenterNetworkId]</Expression>
</Case><Case
 Name="Invalid RBC-ID/phone number"
 Guid="63d1f25a-5bd9-45c5-978e-7fe44ecdf335"
>
<PreConditions>
<PreCondition
 Guid="cdc11219-5220-4b39-ae2d-a4dc45a10acf"
>CurrentRBCConnection().ContactData.DataState == Default.DataState.Invalid</PreCondition></PreConditions>
<Expression>[DMI.RBCContactActionEnum.ReenterNetworkId, DMI.RBCContactActionEnum.UseLastStoredNumber, DMI.RBCContactActionEnum.UseEireneShortNumber, DMI.RBCContactActionEnum.RevalidateContactInfo, DMI.RBCContactActionEnum.EnterContactInfo]</Expression>
</Case><Case
 Name="Unknown RBC-ID/phone number"
 Guid="fab42248-c38b-4b63-a0c2-6270b13c8ffb"
>
<PreConditions>
<PreCondition
 Guid="dd77bcad-0268-4dee-987b-3a77cbd9865c"
>CurrentRBCConnection().ContactData.DataState == Default.DataState.Unknown</PreCondition></PreConditions>
<Expression>[DMI.RBCContactActionEnum.ReenterNetworkId,  DMI.RBCContactActionEnum.UseEireneShortNumber,  DMI.RBCContactActionEnum.EnterContactInfo]</Expression>
</Case><Case
 Name="Valid RBC-ID/phone number"
 Guid="de7929e2-7d30-48aa-a121-5ffb5b45a2e2"
>
<PreConditions>
<PreCondition
 Guid="c4dba95e-3474-4ec3-b537-7fb3e625877b"
>CurrentRBCConnection().ContactData.DataState == Default.DataState.Valid</PreCondition></PreConditions>
<Expression>[DMI.RBCContactActionEnum.ReenterNetworkId,  DMI.RBCContactActionEnum.UseEireneShortNumber]</Expression>
</Case></Cases>
</Function><Function
 Type="EURORADIO.RBCContactStruct"
 Default=""
 X="550"
 Y="600"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="GetRBCContactInfoForSoM"
 Guid="50e734b8-332b-4530-bf92-d336fb4e8a00"
>
<Comment>Returns the RBC contact information if a terminal is registered. Otherwise returns EMPTY.</Comment>
<Cases>
<Case
 Name="Terminal registered, contact information unknown"
 Guid="35f30c40-e878-4765-a7cd-73e73dc0b127"
>
<PreConditions>
<PreCondition
 Guid="b11115a5-266b-47cb-877c-f30a46722281"
>TerminalIsRegistered(CurrentTerminal())
  AND  
CurrentRBCConnection().ContactData.DataState == Default.DataState.Unknown</PreCondition></PreConditions>
<Expression>EMPTY</Expression>
</Case><Case
 Name="Terminal registered"
 Guid="0f604a9e-a58e-40a0-bf09-0f8eb4f520ed"
>
<PreConditions>
<PreCondition
 Guid="87fa35d7-7cae-4d88-84ce-26e032d54e3c"
>TerminalIsRegistered(CurrentTerminal())</PreCondition></PreConditions>
<Expression>CurrentRBCConnection().ContactData</Expression>
</Case><Case
 Name="Otherwise"
 Guid="096a5de1-c61c-46fb-b534-6fb65d9d9134"
>
<Expression>EMPTY</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="550"
 Y="660"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="EstablishCommunicationSession"
 Guid="cc4f4bfd-00bb-4541-a811-7d04769f9382"
>
<ReqRef
 Id="4aa98857-a1f3-4fee-ab3c-0af871807ad8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2de0df57-ffa5-45fb-a62c-8a1d3498619d"
>
</ReqRef><ReqRef
 Id="49ac5c2f-c76c-4903-a7c8-2a28ea61c09c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ae8519af-3c8e-4135-8b65-54a072f5fe25"
>
</ReqRef><ReqRef
 Id="72a514b1-acd2-473d-a39b-87d8f86f1624"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f45a4e2d-0cc3-4c93-88ad-1e1262803e9a"
>
</ReqRef><Comment>Is true if the on-board should establish a communication session.</Comment>
<Cases>
<Case
 Name="Value"
 Guid="afd88ff5-02a2-4f63-a8f6-443811e90293"
>
<Expression>Kernel.ActiveFunctions.ManageCommunicationSession()
  AND  
Kernel.Mode not in [Default.Mode.SH, Default.Mode.PS]</Expression>
</Case></Cases>
</Function><Function
 Type="EURORADIO.TerminalStruct"
 Default=""
 X="330"
 Y="720"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="SecondaryTerminal"
 Guid="844d4dfe-8658-4309-a26a-3711661d3127"
>
<Comment>Provides the secondary terminal (for the accepting RBC).</Comment>
<Cases>
<Case
 Name="Terminal 1"
 Guid="2bdfbf19-8183-4aef-ab24-51d07be5739c"
>
<PreConditions>
<PreCondition
 Guid="88f2d542-cfca-4d41-8d1f-74771f9e6d33"
>CurrentTerminal() == Terminal2</PreCondition></PreConditions>
<Expression>Terminal1</Expression>
</Case><Case
 Name="Terminal 2"
 Guid="e9ac46b6-3db7-4f01-bb9e-70510c2ca4d4"
>
<Expression>Terminal2</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="660"
 Y="540"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="IncomingMessageIsConsistent"
 Guid="63c5c7c9-161e-4294-80b5-fbf6fdea21e2"
>
<ReqRef
 Id="3460bc0e-8803-4236-bb1b-7b9af5863703"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="960a91af-75af-42eb-bc19-dc03e554ed93"
>
</ReqRef><ReqRef
 Id="9e7a0583-df92-4eab-8868-236ab7137663"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ccda8532-e676-4060-8996-a384268bd8c4"
>
</ReqRef><ReqRef
 Id="6950f2b1-0c72-4e10-9f34-e93e44498694"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5f9d4979-95a3-4f4f-8288-cad47a883d5d"
>
</ReqRef><ReqRef
 Id="a3ae1dd4-1e9a-44e2-85d0-b0ebc947ebc1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bbc5b274-6fe7-4a0d-b8e8-3e72690802b7"
>
</ReqRef><ReqRef
 Id="b09389ef-751e-4124-ab57-b53c0a663151"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="306d1665-9238-4fde-801c-7fbd0526a9ec"
>
</ReqRef><ReqRef
 Id="4b29da50-13ee-4edd-95f6-cfdfa283ca99"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="26cfece4-a5e8-403a-b4cb-f073762de7bc"
>
</ReqRef><ReqRef
 Id="2acfcc15-b52e-4162-a72e-a4ff1e9f43e1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0f8854ec-64d6-4da1-8fc5-5dcfdc9ebe41"
>
</ReqRef><ReqRef
 Id="da9f0886-9eda-4e06-91e4-41094a7a488f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="dad9a60e-fffd-4f6d-ab7b-fee7b1583493"
>
</ReqRef><Comment>Performs the data consistency checks on an incoming radio message.
The checks performed in EFS are:
  - the time stanp of the received message is greater than the time stamp of the previous received message.
  - all values of variables in the message are valid.</Comment>
<Parameters>
<Parameter
 Type="InMessageStruct"
 Name="InMessage"
 Guid="9aecef0e-5917-4b84-bc32-f8a2ee82362c"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="No message"
 Guid="8b462b2c-e728-4afd-ba13-d1513f3070ed"
>
<PreConditions>
<PreCondition
 Guid="2f5d5aef-f2c0-4e0b-958e-3b4a3769699b"
>NOT Available(InMessage.Message)</PreCondition></PreConditions>
<Expression>False</Expression>
</Case><Case
 Name="High priority message"
 Guid="a6510492-0c7e-4ab1-956a-8527ad7a594b"
>
<PreConditions>
<PreCondition
 Guid="d2487dc1-8aa1-4f19-bb0a-2d0c95e0b580"
>InMessage.Priority == MessagePriorityEnum.High</PreCondition></PreConditions>
<Expression>True</Expression>
</Case><Case
 Name="Time stamp invalid"
 Guid="bca5e06a-c381-424a-aa56-2f45d71ca6bf"
>
<PreConditions>
<PreCondition
 Guid="1839697c-2ced-42ac-aff4-5a06c01cf486"
>NOT TimeStampValid(InMessage.Message)</PreCondition></PreConditions>
<Expression>False</Expression>
</Case><Case
 Name="Invalid variables"
 Guid="90d481bc-88f3-49cb-a726-6ae26e4970f5"
>
<PreConditions>
<PreCondition
 Guid="7befe0e8-1643-451e-8870-89975f347dd9"
>NOT Messages.MESSAGE.TRACK_TO_TRAIN.MessageValuesCorrect(InMessage.Message)</PreCondition></PreConditions>
<Expression>False</Expression>
</Case><Case
 Name="Otherwise"
 Guid="93ee79d0-2ce6-4bf9-abad-31156f78bc90"
>
<Expression>True</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="330"
 Y="720"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="TimeStampValid"
 Guid="ab1354d0-c1c6-4395-9d6f-4aa038d4932f"
>
<ReqRef
 Id="a3ae1dd4-1e9a-44e2-85d0-b0ebc947ebc1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5af76d55-8d3b-46ec-971c-039ac3abd467"
>
</ReqRef><ReqRef
 Id="6950f2b1-0c72-4e10-9f34-e93e44498694"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fea717a2-c7d1-4240-9569-47be6997c55a"
>
</ReqRef><ReqRef
 Id="b5a598d2-0344-4c46-9e26-cc53c26f73c7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="40432a37-def5-48dc-8aa9-98e3d848ccc8"
>
</ReqRef><ReqRef
 Id="ea2dce72-5d9f-4f02-af04-186341cf739c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8e25fde3-7868-4547-aa11-f118880785e2"
>
</ReqRef><ReqRef
 Id="3f65404b-e1fe-4937-a5c6-7f726a405a4e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fd0a584b-e7d9-4a26-a508-fc0b78d094b8"
>
</ReqRef><ReqRef
 Id="aff53c34-f612-4eb4-bc2a-11d5e30566ef"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d7ec0859-5852-4c42-8cd4-c0b7ad0e5d68"
>
</ReqRef><ReqRef
 Id="1d7817dd-686d-4c09-9e56-ef8943a94858"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="19849574-b13a-49a6-a9ba-8a04d29c38ed"
>
</ReqRef><ReqRef
 Id="0b314991-9ddf-4e48-bbbc-ef8083339ea7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6e9cefaa-f126-4078-b610-75cd7441936b"
>
</ReqRef><ReqRef
 Id="2acfcc15-b52e-4162-a72e-a4ff1e9f43e1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="36225e67-0b25-4ecf-a721-3dc88e6880b7"
>
</ReqRef><Comment>Check that the time stamp of the received message is valid.</Comment>
<Parameters>
<Parameter
 Type="Messages.MESSAGE.TRACK_TO_TRAIN.Message"
 Name="Message"
 Guid="abb59365-0111-4635-b2fb-5aefbd5f9bfe"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="Do not perform the check"
 Guid="be17402f-5b8f-4a88-b12d-7aff2a69e4ae"
>
<PreConditions>
<PreCondition
 Guid="c3f96aa5-6fe3-4df7-bd6e-985bf2062c2f"
>NOT CheckMessageTimeStamps</PreCondition></PreConditions>
<Expression>True</Expression>
</Case><Case
 Name="Time stamp unknown at initiation of communication"
 Guid="202591f0-e7d7-4e7e-b5fe-6abfd9152eeb"
>
<PreConditions>
<PreCondition
 Guid="de53a423-8147-46b1-b35d-5aed01bd6f32"
>Available(Message.INITIATION_OF_A_COMMUNICATION_SESSION)</PreCondition><PreCondition
 Guid="08fc2b71-0f15-44e3-95cd-d0cf5aebbace"
>CurrentRBCConnection().OnboardReference_MessageTimer == BaseTypes.Time.NA</PreCondition></PreConditions>
<Expression>True</Expression>
</Case><Case
 Name="Time stamp before previous message"
 Guid="9347d978-64df-4223-8fbf-b2e58eedb111"
>
<PreConditions>
<PreCondition
 Guid="908af580-db95-473f-b35b-3a52e7234b45"
>MessageTypes.TimeResolution( Messages.MESSAGE.TRACK_TO_TRAIN.GetT_TRAIN(Message) ) &lt;= CurrentRBCConnection().OnboardReference_MessageTimer</PreCondition></PreConditions>
<Expression>OnboardTimerWrapped()</Expression>
</Case><Case
 Name="Time stamp correct"
 Guid="da2ff5e4-26b5-402e-b578-045d3514c8f0"
>
<Expression>True</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="660"
 Y="600"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="DataPriorityCorrect"
 Guid="a5bed293-f598-41dc-bbde-69ba0d2dfa6b"
>
<ReqRef
 Id="a5a26b96-8dd0-4ac0-8305-a9730a4ce109"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="72b7b306-1eb4-44ea-b787-3bf6086ec400"
>
</ReqRef><ReqRef
 Id="e700d18e-d4e8-422a-990c-f149f477ef14"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d72d8762-727b-4f5a-858e-830f46f6d24d"
>
</ReqRef><ReqRef
 Id="e9f7415c-2605-40c6-82c5-5211a7679d76"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8838ab63-e210-4c3f-8b93-5bda5efd1bf5"
>
</ReqRef><Comment>Checks that the priority of the received message is correct. The possible priorities are Normal and High. Only emergency stop messages can have high priority.</Comment>
<Parameters>
<Parameter
 Type="InMessageStruct"
 Name="Message"
 Guid="86b9a7fa-5b65-4b68-8b8c-a6038301f840"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="High priority"
 Guid="7acfd1fe-1e84-45f3-8956-eec0185a6948"
>
<PreConditions>
<PreCondition
 Guid="da1cad06-8c2a-45fc-8c4e-4404ecd814ef"
>Message.Priority == MessagePriorityEnum.High</PreCondition></PreConditions>
<Expression>Available(Message.Message.CONDITIONAL_EMERGENCY_STOP)
  OR  
Available(Message.Message.UNCONDITIONAL_EMERGENCY_STOP)</Expression>
</Case><Case
 Name="Normal priority"
 Guid="79ed3277-4d2d-4c00-a852-2369940a9c1b"
>
<Expression>True</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 X="440"
 Y="720"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="OnboardTimerWrapped"
 Guid="6f55c9e3-c1c3-4469-8b3a-f025d7a082a3"
>
<ReqRef
 Id="b5a598d2-0344-4c46-9e26-cc53c26f73c7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="39679642-6729-494e-b1b9-4111e5ebe99d"
>
</ReqRef><Comment>If the timestamp of the received message is less than the stored time stamp, check whether the on-board timer wrapped around.</Comment>
<Cases>
<Case
 Name="Value"
 Guid="a994b6b9-9beb-4de2-b0d8-e24ea5313601"
>
<Expression>Kernel.DateAndTime.CurrentTime &lt; CurrentRBCConnection().OnboardReference_MessageTimer</Expression>
</Case></Cases>
</Function></Functions>
<Procedures>
<Procedure
 X="440"
 Y="780"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="ContactRBC"
 Guid="d105e077-5c97-4b2b-97a0-538f17fd7201"
>
<ReqRef
 Id="951fc6d8-739b-4bd4-9361-5686840e8b5a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="819e1e79-9b39-4782-b8f6-2e8ef581405d"
>
</ReqRef><ReqRef
 Id="e65aa492-e72e-4bdc-896b-8462bf7b8ea9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="186a859f-0ee2-4458-8b0b-f471f0cbdf5e"
>
</ReqRef><ReqRef
 Id="e4addba5-4948-4054-b3dc-0e7eeabd6768"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="18a671d3-8767-4b2f-ba96-f58870ebde49"
>
</ReqRef><ReqRef
 Id="8f6d9e5c-7082-4ff4-b968-cfe98c4ad1d5"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2b96e0c1-e66d-49f5-ad67-1b38cdacab23"
>
</ReqRef><ReqRef
 Id="cbb3ad4b-7d33-4161-b151-347463291135"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="572418c7-97e0-45c2-8c2e-1c8e7a897658"
>
</ReqRef><ReqRef
 Id="bd6563bc-06fe-447b-8afc-e210141cc921"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ca675e4f-a03e-4c1d-a96d-99e18b58a73c"
>
</ReqRef><ReqRef
 Id="573d0d6d-98df-43fa-8065-22f5dae937f3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d48e4cd2-54f9-4787-837f-ee40acc85794"
>
</ReqRef><ReqRef
 Id="cae9ea11-6eb1-49b7-b010-183e0c897e7b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a405afc3-bc82-4c58-b388-1ce500d52660"
>
</ReqRef><Comment>Allows to establish/terminate the communication session with an RBC. If no mobile terminal is registered, the order is rejected.</Comment>
<Parameters>
<Parameter
 Type="EURORADIO.ContactOrderStruct"
 Name="anOrder"
 Guid="bd7c227e-3f2a-4591-b2f2-0261dead5db0"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Select RBC"
 Guid="d8aeb849-b368-455f-9c7b-b9df2fe98385"
>
<Comment>Selection of RBC according to their communication status.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="There is at least one mobile terminal registered"
 Guid="0e5a581a-1201-405e-b00a-40ae760b28f2"
>
<Comment>If there is at least one mobile terminal registered, the on-board requests to establish the connection.</Comment>
<PreConditions>
<PreCondition
 Guid="f76e9e01-3ba5-4eb3-8563-aef8799f02d3"
>SelectRBCToContact() != EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="fb0c323a-04ee-47a6-86cd-341b24a90ee3"
>SelectRBCToContact().ContactRBCOrder &lt;- anOrder</Action><Action
 Guid="10e5e739-aca5-4fb6-814f-e45da2fe4dde"
>LastKnownRBC &lt;- EURORADIO.RBCContactStruct
{
    Id =&gt; anOrder.Id,
    PhoneNumber =&gt; anOrder.PhoneNumber,
    DataState =&gt; Default.DataState.Valid
}</Action><Action
 Guid="b327d97a-1053-46ca-a7eb-480617cdb643"
>RBCContactOrderToRepeat &lt;- EMPTY</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="No mobile terminals are registered"
 Guid="10050a00-0387-4b75-84ad-ef36b7942386"
>
<ReqRef
 Id="1d7b7d76-6567-4512-ab16-84e87808264f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c3ea8cfd-05cf-4baf-8797-7d00867b360e"
>
</ReqRef><Comment>If there is no mobile terminal registered, the order to contact the RBC is stored in order to retry the connection establishment later and the driver is requested to enter the contact data.</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="c74d158a-5aad-472c-9837-f0467d1ce3f8"
>RBCContactOrderToRepeat &lt;- anOrder</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle terminal registration"
 Guid="40194bc4-0ac8-46b4-bc8c-9597f7d2a6fb"
>
<Comment>If there is no mobile terminal registered, the driver is requested to enter the contact data or the connection is established according to previously stored data.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Last known network id is available"
 Guid="e0aa62f1-3590-4c8a-b763-5b08d22b7432"
>
<Comment>The information about the last unknown network is stored on-board =&gt; the terminals are registered with this information.</Comment>
<PreConditions>
<PreCondition
 Guid="fb8b18ba-7882-4bb1-aaf3-68e9c372b9e8"
>LastKnownNetworkId != &apos;&apos;</PreCondition></PreConditions>
<Actions>
<Action
 Guid="28e290a4-51be-483e-9fa6-a06cad53f05d"
>RegisterMobileTerminals( aNetworkId =&gt; LastKnownNetworkId )</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="No network id available, data entry not proposed yet"
 Guid="81a8cb24-f23b-4ddb-b5b2-bca8b0938ead"
>
<ReqRef
 Id="00a1581e-9f11-4254-b27b-c762074e9dde"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="44e8c435-29a3-4fb0-b7cd-c127b8645829"
>
</ReqRef><Comment>Otherwise, if the mode is different from TR, the driver is requested to enter the connection data.</Comment>
<PreConditions>
<PreCondition
 Guid="5b896537-0cd3-4108-8766-68152d5eea7f"
>DMI.MasterDMI().In_RBCContactInformation.InputInformation.RequestStatus == Default.Request.Disabled</PreCondition><PreCondition
 Guid="6dc5d3cd-fdbd-4642-9f27-ec7398ba1982"
>Kernel.Mode != Default.Mode.TR</PreCondition></PreConditions>
<Actions>
<Action
 Guid="43066826-6217-4a25-87ff-a9bce7e4c9b7"
>DMI.MasterDMI().In_RBCContactInformation.InitiateRequest
(
    Actions =&gt; GetDriverActionsForSoM(),
    anRBCContactInformation =&gt; GetRBCContactInfoForSoM()
)</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="No network id available, driver provided the contact information"
 Guid="0471ad84-4efc-42f2-bc4c-cbe64854e8e4"
>
<Comment>When the driver enters the connection data, the mobile terminals are registered.</Comment>
<PreConditions>
<PreCondition
 Guid="f233f57b-bf25-46ae-9918-86536bc4985c"
>DMI.MasterDMI().In_RBCContactInformation.InputInformation.RequestStatus == Default.Request.Response</PreCondition></PreConditions>
<Actions>
<Action
 Guid="44217646-714f-49c3-8352-2f030641cc52"
>RegisterMobileTerminals( aNetworkId =&gt; DMI.MasterDMI().In_RBCContactInformation.SelectedNetwork )</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="550"
 Y="780"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="ContactAcceptingRBC"
 Guid="9fc2337d-7e64-41d1-a72d-a19a466b8342"
>
<ReqRef
 Id="711a8f6b-f758-4405-bb80-f9b331940c39"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8be15c32-7c74-4fb5-8e55-06b822994013"
>
</ReqRef><ReqRef
 Id="e65aa492-e72e-4bdc-896b-8462bf7b8ea9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7d4f24b0-92a9-4856-a71d-88e34d2d59ac"
>
</ReqRef><ReqRef
 Id="00910a19-7134-4f24-a20b-6c88aa996ff1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b8f46699-f8ba-4513-b978-e524cdf50e85"
>
</ReqRef><ReqRef
 Id="277de94f-c4cd-4612-97ca-ead1fdd29073"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2c0862a6-1f7d-4cf0-a7ec-9db804412f74"
>
</ReqRef><ReqRef
 Id="dd006294-7250-4fc8-b4b1-f4e62eb12cf3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b68bc667-9958-46c4-9f7b-3197d9cf7df9"
>
</ReqRef><ReqRef
 Id="6fa8d8fc-f346-4592-b64d-ce1831a6cc98"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8089b82d-cb69-40f6-b4e2-778d6df77e6c"
>
</ReqRef><ReqRef
 Id="adc412e3-1c5f-4c95-a667-303e6aabee27"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="04073e2e-24b3-4fa6-ab75-0c5de363ecd5"
>
</ReqRef><ReqRef
 Id="6a073136-951c-4624-92a2-1b2f704d25ed"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="14b86be0-ffab-4b15-920c-b9c46e878398"
>
</ReqRef><ReqRef
 Id="68a814aa-d977-4ba8-8329-54aaaec00081"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3f734b21-300c-42c6-979a-625eb8760cf6"
>
</ReqRef><ReqRef
 Id="dba4721e-ecc7-46a8-945a-ca408198338c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6bb277a3-ac4d-4f47-9478-cf13601c1a45"
>
</ReqRef><ReqRef
 Id="36ac93e3-3877-41a8-98dc-4bbdd6eff050"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c1bff610-3f85-4dff-a1e3-862e8e28d339"
>
</ReqRef><Comment>Allows to establish the communication session with an accepting RBC. If no mobile terminal is registered, the order is rejected.</Comment>
<Parameters>
<Parameter
 Type="EURORADIO.ContactOrderStruct"
 Name="Order"
 Guid="36d1affc-3e90-44a1-bafa-74605373535b"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Select RBC"
 Guid="0cdba42d-a87d-4fbb-b448-ea7fd7ae4fd1"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Two terminals available, Terminal 2 is connected"
 Guid="3d112c45-c399-4909-9c57-0b56d8c93b57"
>
<Comment>If the second mobile terminal is already connected, then the connection will be established on the first one.</Comment>
<PreConditions>
<PreCondition
 Guid="ffda9f58-de4b-460e-9459-f56d2e21d0d9"
>Terminal2 != EMPTY
  AND 
Terminal2.RBCConnection.SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionUp</PreCondition><PreCondition
 Guid="33666d69-9750-4e02-a8e6-c569ffffe0fa"
>Terminal1 != EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="6b1064e6-281a-4354-95d1-2000cd5ffd6b"
>Terminal1.AcceptingRBCContactOrder &lt;- EURORADIO.ContactOrderStruct
{
    Id =&gt; Order.Id,
    PhoneNumber =&gt; Order.PhoneNumber,
    ActionToPerform =&gt; ContactActionEnum.Establish,
    AppliesToSleepingUnits =&gt; Order.AppliesToSleepingUnits
}</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Two terminals available, Terminal 1 is connected"
 Guid="0f6ccc7b-209c-482c-a596-433da0ec4386"
>
<Comment>If the first mobile terminal is already connected, the connection will be established on the second one.</Comment>
<PreConditions>
<PreCondition
 Guid="1571691d-c431-48e0-9f63-1a441b77ffe8"
>Terminal2 != EMPTY</PreCondition><PreCondition
 Guid="e79623a7-69b4-46ec-8e6f-2a6f0c3745c0"
>Terminal1 != EMPTY
  AND 
Terminal1.RBCConnection.SafeRadioConnectionStatus == SafeRadioConnectionStatusEnum.ConnectionUp</PreCondition></PreConditions>
<Actions>
<Action
 Guid="852b15c6-aa27-4e22-a175-04e29e4033e3"
>Terminal2.AcceptingRBCContactOrder &lt;- EURORADIO.ContactOrderStruct
{
    Id =&gt; Order.Id,
    PhoneNumber =&gt; Order.PhoneNumber,
    ActionToPerform =&gt; ContactActionEnum.Establish,
    AppliesToSleepingUnits =&gt; Order.AppliesToSleepingUnits
}</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Only Terminal 1 is available"
 Guid="469a41ba-861f-4218-8799-5fab28e7a367"
>
<Comment>If only Terminal 1 is available, the connection will be established on it.</Comment>
<PreConditions>
<PreCondition
 Guid="6fc46360-c116-43b2-a7e3-220f5fc3e692"
>Terminal1 != EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="93e237a6-31dc-4023-91c6-21e6480057e2"
>Terminal1.AcceptingRBCContactOrder &lt;- EURORADIO.ContactOrderStruct
{
    Id =&gt; Order.Id,
    PhoneNumber =&gt; Order.PhoneNumber,
    ActionToPerform =&gt; ContactActionEnum.Establish,
    AppliesToSleepingUnits =&gt; Order.AppliesToSleepingUnits
}</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Only Terminal 2 is available"
 Guid="fbe9201c-5634-4859-ac9e-2606c68552be"
>
<Comment>If only Terminal 2 is available, the connection will be established on it.</Comment>
<PreConditions>
<PreCondition
 Guid="7bf47d02-f543-4922-aa32-c82a9934af6b"
>Terminal2 != EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="8431a2ae-506a-4f0f-91bd-73fe5661a3a5"
>Terminal2.AcceptingRBCContactOrder &lt;- EURORADIO.ContactOrderStruct
{
    Id =&gt; Order.Id,
    PhoneNumber =&gt; Order.PhoneNumber,
    ActionToPerform =&gt; ContactActionEnum.Establish,
    AppliesToSleepingUnits =&gt; Order.AppliesToSleepingUnits
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="220"
 Y="780"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="OpenRBCSession"
 Guid="1e3e4aab-936d-4b3e-90d0-c39dfa476afa"
>
<ReqRef
 Id="410ad67d-6b5a-46f5-9694-35e5954fcb65"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="882474cc-7ade-45b2-a1e4-47af0e562d10"
>
</ReqRef><ReqRef
 Id="becb430f-a4f2-4817-ad08-3672ed05f855"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d1ee1871-11f4-4b57-9cd4-1613cfc9d0a7"
>
</ReqRef><ReqRef
 Id="38c25256-da47-4c77-a112-1ee0d724e7f2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="901dd993-3bcc-434d-8e46-9c30a0f49483"
>
</ReqRef><ReqRef
 Id="cae9ea11-6eb1-49b7-b010-183e0c897e7b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7dd7023d-3484-40f2-9f7a-9fec7e06f1b2"
>
</ReqRef><Comment>Initiates the contact with the RBC, as requested by ContactOption.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Open RBC session"
 Guid="96a4a42f-501a-40c4-9a82-8d522f07c55a"
>
<Comment>Initiates the contact with the RBC, as requested by ContactOption.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Session is already (being) established with this RBC"
 Guid="caa5317d-7334-450b-a354-799705c2362d"
>
<ReqRef
 Id="66543af0-6c4b-46a0-b17f-96ed3e1d37ba"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="887d02f6-5b47-4eeb-9c9d-b558136b3ec4"
>
</ReqRef><Comment>If a session is already (being) established with this RBC, the order is ignored.</Comment>
<PreConditions>
<PreCondition
 Guid="dd160343-60f0-4795-ae66-17e29ea4cd14"
>SessionIsAlreadyEstablishedWithRequestedRBC()</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Contact last known RBC"
 Guid="f01fc2bf-5429-4449-a4de-036700e0a472"
>
<ReqRef
 Id="69dc4eed-7cae-45b6-adbb-58b2b1ac6edd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9c020d93-6490-4b5e-be20-c6d0443f3740"
>
</ReqRef><ReqRef
 Id="369d7ae0-50db-411b-9941-bbe30e354733"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="06f42b1f-3ae0-42a2-8cee-ca8119a0ce18"
>
</ReqRef><Comment>Contact last known RBC. If there is no valid last known RBC stored on-board, the order is ignored.</Comment>
<PreConditions>
<PreCondition
 Guid="b800f70b-83f7-45b4-9432-c769f9dca3f6"
>ContactOption == ContactOptionEnum.ContactLastKnownRBC</PreCondition><PreCondition
 Guid="c12c7ead-1138-41ac-bb3b-164fdeda2b0e"
>LastKnownRBC.DataState == Default.DataState.Valid</PreCondition></PreConditions>
<Actions>
<Action
 Guid="2078f218-6c1c-485a-9a00-f77a91524075"
>ContactRBC
(
    anOrder =&gt; EURORADIO.ContactOrderStruct
    {
        Id =&gt; LastKnownRBC.Id,
        PhoneNumber =&gt; LastKnownRBC.PhoneNumber,
        ActionToPerform =&gt; ContactActionEnum.Establish
    }
)</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Use on-board stored short number"
 Guid="862bab30-ca83-421f-999b-a05239d001d6"
>
<ReqRef
 Id="40859515-77c4-46aa-96a5-12453cd171a2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="82f9117e-6a4e-4124-8891-6c82527765c5"
>
</ReqRef><Comment>Use on-board store short number.</Comment>
<PreConditions>
<PreCondition
 Guid="44730a03-b518-420f-86e0-c7c20a7a8fc6"
>ContactOption == ContactOptionEnum.UseOnBoardStoredShortNumber</PreCondition></PreConditions>
<Actions>
<Action
 Guid="5dd1dd73-af6c-4f90-99d8-db129a45167f"
>ContactRBC
(
    anOrder =&gt; EURORADIO.ContactOrderStruct
    {
        Id =&gt; CurrentRBCConnection().ContactData.Id,
        PhoneNumber =&gt; ShortNumber,
        ActionToPerform =&gt; ContactActionEnum.Establish
    }
)</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Use RBC id + phone number"
 Guid="191d7715-3f6a-4e80-856b-e904fa4f1342"
>
<ReqRef
 Id="cebfc056-7b96-49d7-a6ff-1fdf0076bb9e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e7fc21dd-a91f-44fb-a8a0-321f2a70b430"
>
</ReqRef><Comment>Use RBC id + phone number.</Comment>
<PreConditions>
<PreCondition
 Guid="a96e13e9-b470-4d73-9b24-98a3929baf63"
>ContactOption == ContactOptionEnum.RBCIdAndPhoneNumber</PreCondition></PreConditions>
<Actions>
<Action
 Guid="9f928072-675b-4a55-a3b6-da40798f6286"
>ContactRBC
(
    anOrder =&gt; EURORADIO.ContactOrderStruct
    {
        Id =&gt; CurrentRBCConnection().ContactData.Id,
        PhoneNumber =&gt; CurrentRBCConnection().ContactData.PhoneNumber,
        ActionToPerform =&gt; ContactActionEnum.Establish
    }
)</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="330"
 Y="780"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="CloseRBCSession"
 Guid="2691fd9c-77e5-40c8-859a-310f132a7a1c"
>
<ReqRef
 Id="058ba686-ff06-4bed-b616-68b4fb4ea7fd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b1781efd-43f9-4cb5-be4a-bc6450114f28"
>
</ReqRef><ReqRef
 Id="84374b3d-739e-4c5f-909d-4c138dedec38"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bb496d49-ec11-41dc-befc-da7c8c5407fa"
>
</ReqRef><ReqRef
 Id="83709cd5-3863-48a0-8264-34f65a482b28"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="85a4bcf7-b532-435d-9f05-b6444ea4586a"
>
</ReqRef><ReqRef
 Id="ae649b47-cdfc-4223-b13d-4b1efaef612d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4c6d8d20-0b10-4548-aafc-35837ff10e5f"
>
</ReqRef><Comment>Closing an RBC connection corresponds to an order to contact the current RBC with action &quot;Terminate&quot;.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Close the session"
 Guid="b37006ef-5ce5-4c15-9dd8-55ec01214286"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Close the session"
 Guid="4446a776-8c46-438a-8b89-c979faf871ba"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="9c41a20d-c457-4bed-8e73-8106d54cde3b"
>ContactRBC
(
    anOrder=&gt; EURORADIO.ContactOrderStruct
    {
        Id =&gt; CurrentRBCConnection().ContactData.Id,
        PhoneNumber =&gt; CurrentRBCConnection().ContactData.PhoneNumber,
        ActionToPerform =&gt; ContactActionEnum.Terminate
    }
)</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Y="840"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="ContactRIU"
 Guid="7d0b4122-12aa-4a02-83f7-9d7e322bfa8a"
>
<ReqRef
 Id="64296fc8-fe88-499d-b63e-d570a4a39744"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a1610f43-4036-4fca-9eef-bd1d8216dfa5"
>
</ReqRef><Comment>Allows to establish/terminate the communication session with an RIU.</Comment>
<Parameters>
<Parameter
 Type="EURORADIO.ContactOrderStruct"
 Name="Order"
 Guid="b9ea4cb2-277a-4de4-863a-f74f28a202a2"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Contact RIU"
 Guid="41b28c18-f309-4e57-8d84-85c6374626b2"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Contact RIU"
 Guid="908bf858-c395-40d2-8235-08a1bc78e393"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="d73c602a-7643-4127-a75a-809495d5acbb"
>RIU.ContactRIUOrder &lt;- Order</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="220"
 Y="840"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="TracksideOrderedSessionReceived"
 Guid="aa947d6d-5ed0-4cb9-9175-d6bbf385946c"
>
<ReqRef
 Id="af0db000-6b09-4a25-b01b-439fa27cbc6a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2dc771ca-4061-4cb2-adb7-816a3d7b329e"
>
</ReqRef><ReqRef
 Id="18318a83-420a-41a7-b3eb-e4e67f1e3f97"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d1b0f107-721b-4cd0-8df4-da9d7387b4bf"
>
</ReqRef><ReqRef
 Id="e4addba5-4948-4054-b3dc-0e7eeabd6768"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="03c225c5-d245-4024-9654-d3747c342eb4"
>
</ReqRef><ReqRef
 Id="8f6d9e5c-7082-4ff4-b968-cfe98c4ad1d5"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b3b29469-b9c6-4889-bd66-97da50bdf142"
>
</ReqRef><ReqRef
 Id="cbb3ad4b-7d33-4161-b151-347463291135"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5905ab6a-8237-48f0-b89c-af1a47571cce"
>
</ReqRef><ReqRef
 Id="bd6563bc-06fe-447b-8afc-e210141cc921"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c464c89d-30b2-4d2c-961e-095a783058d7"
>
</ReqRef><ReqRef
 Id="058ba686-ff06-4bed-b616-68b4fb4ea7fd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9ac6e8ae-bd31-46ed-b594-c90e4b81b94e"
>
</ReqRef><Comment>Handles reception of session management packet from the trackside. The procedure calls ContactRBC procedure with order computed from the received information.</Comment>
<Parameters>
<Parameter
 Type="Messages.PACKET.TRACK_TO_TRAIN.SESSION_MANAGEMENT.Message"
 Name="Packet"
 Guid="d3881c83-afc8-4e4b-aaa6-e10fc539514f"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle trackside order"
 Guid="432c07cc-89ff-4dc7-aa9f-e8aacd9867d0"
>
<Comment>Handles reception of session management packet from the trackside. The rule calls ContactRBC procedure wich order computed from the received information.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="No terminal registered"
 Guid="e8077b47-cddf-451a-967a-543bb5984da0"
>
<ReqRef
 Id="00910a19-7134-4f24-a20b-6c88aa996ff1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3e39c131-4847-4cb8-b888-25c5778a78ac"
>
</ReqRef><Comment>If no mobile terminal is registered, the order from the trackside is ignored.</Comment>
<PreConditions>
<PreCondition
 Guid="74c2dd30-5ea7-4f91-8d3a-52d704636cac"
>SelectRBCToContact() == EMPTY</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Contact information provided by the packet"
 Guid="a1967dcf-c7b2-477d-a589-c2dc4de30508"
>
<ReqRef
 Id="cebfc056-7b96-49d7-a6ff-1fdf0076bb9e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0a0571a8-3af1-44b4-8760-c3e5cb384074"
>
</ReqRef><Comment>If the contact information is provided by the packet (no special values in NID_RBC or NID_RADIO), then the order can be created with these values.</Comment>
<PreConditions>
<PreCondition
 Guid="7b666480-3ecb-4c96-8c61-ffca7307d3f0"
>Packet.NID_RBC != Messages.NID_RBC.contact_last_known_RBC</PreCondition><PreCondition
 Guid="cfb7f6d4-38c4-4b3c-8c66-f6f85d58f314"
>Packet.NID_RADIO != &apos;FFFFFFFFFFFFFFFF&apos;</PreCondition></PreConditions>
<Actions>
<Action
 Guid="a6ebac2e-aa73-4d15-b591-4cdeeb13852b"
>ContactRBC
(
    anOrder =&gt; EURORADIO.ContactOrderStruct
    {
        Id =&gt; EURORADIO.RBCIdStruct
        {
            Country =&gt; Packet.NID_C,
            Id =&gt; Packet.NID_RBC
        },
        PhoneNumber =&gt; Packet.NID_RADIO,
        ActionToPerform =&gt; ConvertActionToPerform ( Packet.Q_RBC ),
        AppliesToSleepingUnits =&gt; ConvertAppliesToSleepingUnits ( Packet.Q_SLEEPSESSION)
    }
)</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Contact last known RBC"
 Guid="83b37f06-70a4-46e7-8c47-7c7d23261d65"
>
<ReqRef
 Id="369d7ae0-50db-411b-9941-bbe30e354733"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f252f718-1e31-4681-b313-39faa0912928"
>
</ReqRef><ReqRef
 Id="31fff3ff-41dc-41fb-9f2e-b43b04a91e5e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9bd57e09-46a8-4e53-9d23-73a2713355ad"
>
</ReqRef><ReqRef
 Id="69dc4eed-7cae-45b6-adbb-58b2b1ac6edd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="61312243-54c8-4f97-8fba-9d4e9873d62c"
>
</ReqRef><Comment>If the packet asks to contact the last known RBC and this information is available, then it is used to create to order. Otherwise the order is ignored.</Comment>
<PreConditions>
<PreCondition
 Guid="3b4b580e-3c79-489d-a09a-403729e158a8"
>Packet.NID_RBC == Messages.NID_RBC.contact_last_known_RBC</PreCondition><PreCondition
 Guid="ed774a24-cf60-4ff7-a891-167c4f37b771"
>LastKnownRBC != EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="21f26d0a-7720-431b-a2c8-aa7386d415c0"
>ContactRBC
(
    anOrder =&gt; EURORADIO.ContactOrderStruct
    {
        Id =&gt; EURORADIO.RBCIdStruct
        {
            Country =&gt; LastKnownRBC.Id.Country,
            Id =&gt; LastKnownRBC.Id.Id
        },
        PhoneNumber =&gt; LastKnownRBC.PhoneNumber,
        ActionToPerform =&gt; ConvertActionToPerform ( Packet.Q_RBC ),
        AppliesToSleepingUnits =&gt; ConvertAppliesToSleepingUnits ( Packet.Q_SLEEPSESSION)
    }
)</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Use on-board stored short number"
 Guid="851df2b3-550c-43a1-a88a-4e153544c8bf"
>
<ReqRef
 Id="40859515-77c4-46aa-96a5-12453cd171a2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8a3656cd-43f6-42e7-8d65-fa07d75ecd3f"
>
</ReqRef><ReqRef
 Id="f8152593-9f99-41a4-9ae8-b51e619e6ece"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1f68f5f4-47cd-4fdc-b805-884a22003510"
>
</ReqRef><ReqRef
 Id="5f82380a-e109-4aba-90d2-9062db8ac675"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="22b090a3-8bd5-4a4c-b5bd-c7de0e0dba4b"
>
</ReqRef><Comment>If the packet asks to use the short number, then the order is created from the RBC id provided by the packet + the short number stored on-board.</Comment>
<PreConditions>
<PreCondition
 Guid="22232e5b-8c7d-4811-8464-469786240a65"
>Packet.NID_RADIO == &apos;FFFFFFFFFFFFFFFF&apos;</PreCondition></PreConditions>
<Actions>
<Action
 Guid="81f8e818-3b94-4484-9cb1-2ae9a62240e9"
>ContactRBC
(
    anOrder =&gt; EURORADIO.ContactOrderStruct
    {
        Id =&gt; EURORADIO.RBCIdStruct
        {
            Country =&gt; Packet.NID_C,
            Id =&gt; Packet.NID_RBC
        },
        PhoneNumber =&gt; ShortNumber,
        ActionToPerform =&gt; ConvertActionToPerform ( Packet.Q_RBC ),
        AppliesToSleepingUnits =&gt; ConvertAppliesToSleepingUnits ( Packet.Q_SLEEPSESSION)
    }
)</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="110"
 Y="840"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="RegisterMobileTerminals"
 Guid="51a30ec7-ce1f-46f1-a57c-72cb7965af62"
>
<ReqRef
 Id="0d0678a7-632a-4a9e-9a4a-87d46d1383b1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="98d92943-9b78-430b-a271-7935c2cb0a2f"
>
</ReqRef><ReqRef
 Id="865bbdd6-2010-4869-ab3e-bc538ce5fe4b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="384307ff-cbf9-4473-b59e-a03b4fa28aa9"
>
</ReqRef><ReqRef
 Id="9f6c605e-3f76-4367-a7a4-7f4fa458ef67"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="053892f7-7928-480d-8a24-b7dfdd54ae64"
>
</ReqRef><ReqRef
 Id="dcc51a42-0407-4ab9-855a-55dc04e2ce4e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="03093ed4-945f-40bc-8369-806a295db5c7"
>
</ReqRef><ReqRef
 Id="68a814aa-d977-4ba8-8329-54aaaec00081"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a52ee743-0de6-4d9f-86b6-2606224cf76c"
>
</ReqRef><ReqRef
 Id="e0778e14-e6ea-4f06-8c69-56236250b636"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ae2c75eb-5575-4a11-82ff-caec0db0bd2a"
>
</ReqRef><ReqRef
 Id="dba4721e-ecc7-46a8-945a-ca408198338c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9d02b08e-4621-48ca-9ca0-53130eac81ef"
>
</ReqRef><ReqRef
 Id="fc32fb41-1c57-4753-a923-fe676aabf35d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9d437a7b-af72-4620-a9df-d2ca2686e1cb"
>
</ReqRef><ReqRef
 Id="573d0d6d-98df-43fa-8065-22f5dae937f3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0bbe939d-9ee9-4f15-8ddf-731a12b94c96"
>
</ReqRef><Comment>Registers the mobile terminals to a radio network.</Comment>
<Parameters>
<Parameter
 Type="String"
 Name="aNetworkId"
 Guid="06100028-08c1-4f2b-9385-ab9e1edc17bc"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Register terminals"
 Guid="86956c33-030e-4d1f-8f75-ab22dffbfcdd"
>
<Comment>If the provided id is valid or the last known nework id is valid, then the mobile terminals are registered.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Provided id is valid"
 Guid="615728d0-acd8-40e3-94ea-aebf1f7bfc01"
>
<Comment>If the provided id is valid, it is used to register the terminals.</Comment>
<PreConditions>
<PreCondition
 Guid="e65e63b1-fd62-4950-b031-05d1d1109e1c"
>aNetworkId != &apos;&apos;</PreCondition></PreConditions>
<Actions>
<Action
 Guid="78ee6641-812f-4c2a-afbe-b0e4ada5e038"
>RegisterATerminal
(
    aTerminal=&gt; Terminal1,
    aNetworkId=&gt; aNetworkId
)</Action><Action
 Guid="c6f1daed-dbca-4284-aa54-e5ac33091cd8"
>RegisterATerminal
(
    aTerminal=&gt; Terminal2,
    aNetworkId=&gt; aNetworkId
)</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Otherwise, use the default Radio Network id"
 Guid="c02b6e39-340c-4bf8-a4fd-910b6087bc05"
>
<ReqRef
 Id="5e068e1e-2be5-45b6-b9eb-d1151df93748"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9092e686-fa55-4fa2-93f9-8086146ec060"
>
</ReqRef><Comment>Otherwise the default Radio Network id is used.</Comment>
<PreConditions>
<PreCondition
 Guid="301efa69-de1e-4a8d-a59f-c0c7afcbe928"
>DefaultRadioNetworkId != &apos;&apos;</PreCondition></PreConditions>
<Actions>
<Action
 Guid="25c3fc69-9b60-4bb1-a2d1-b74d2cd381a9"
>RegisterATerminal
(
    aTerminal=&gt; Terminal1,
    aNetworkId=&gt; DefaultRadioNetworkId
)</Action><Action
 Guid="e3be1ede-90b1-4290-b919-3187a1668b3c"
>RegisterATerminal
(
    aTerminal=&gt; Terminal2,
    aNetworkId=&gt; DefaultRadioNetworkId
)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Update last known network id"
 Guid="bfb78b5e-119a-4e09-af0e-35138fc12848"
>
<ReqRef
 Id="9bf96521-7fd6-4183-ab61-1276d48d3996"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6901fdd4-16ee-4f98-bee3-2fea0d726482"
>
</ReqRef><Comment>The received network id is memorized in order to be able to use it when the on-board equipment is powered-on.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Update last known network id"
 Guid="908aae06-faac-4683-acfa-a0943eeb9c8f"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="e1e7e813-961e-4771-8bdc-7606677f8c40"
>LastKnownNetworkId &lt;- aNetworkId</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Y="780"
 Width="100"
 Height="50"
 NeedsRequirement="FALSE"
 Name="ProcessIncomingMessages"
 Guid="b9ea4dd2-c1d7-457b-b33c-62e49af0c65b"
>
<Comment>This procedure is called for each message received from the Euroradio. It stores the received information into the internal variables.</Comment>
<Parameters>
<Parameter
 Type="Messages.MESSAGE.TRACK_TO_TRAIN.Message"
 Name="aMessage"
 Guid="72113823-2b1b-43bb-b457-15bf4f1f449d"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="UpdateINTERNAL"
 Implemented="TRUE"
 Name="SR authorisation"
 Guid="e847d1b0-8be3-41a3-8ffd-43e655a3a124"
>
<ReqRef
 Id="6dc87cd2-d3b8-4d7f-a8f0-26e60b30a71e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="658de14c-3157-4d55-84fd-a580054731dc"
>
</ReqRef><ReqRef
 Id="d97a231f-6ef1-4300-9bd9-d3dba7d434bd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="75b6b428-5a43-4df5-aa76-0990b37dbfe2"
>
</ReqRef><ReqRef
 Id="478bdd4c-284c-4cc2-98a7-1b85116f19c2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f5d5bf71-140b-48ae-92bc-f8cfa73f4cf9"
>
</ReqRef><Comment>Handles reception of SR authorisation.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="SR authorisation"
 Guid="d118d140-ad45-45ff-852f-8cb03f830fa2"
>
<PreConditions>
<PreCondition
 Guid="aae29d37-06e2-4a68-af77-695ecbbe2651"
>Available ( aMessage.SR_AUTHORISATION )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="80d3a386-cf7c-4ca1-91f3-31d8046462f2"
>Kernel.StaffResponsible.SRAuthorisationReceived ( Packet =&gt; aMessage.SR_AUTHORISATION )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="UpdateINTERNAL"
 Implemented="TRUE"
 Name="Movement authority"
 Guid="626962c6-9ca8-4901-8a62-680c26f7dc7a"
>
<ReqRef
 Id="948cdca7-999f-4b57-8b4a-7ffc1873927f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="93b1df7b-3be7-4595-ac53-eb958ee1749c"
>
</ReqRef><ReqRef
 Id="f4723221-15fd-4636-851f-08a437cc18e6"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8ac4a4f7-3e5f-4335-b743-e8ee7a7ce385"
>
</ReqRef><ReqRef
 Id="34124e11-dd20-40b4-8914-44b6b7397ff1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8d52b2e1-2ae4-4fa4-a15b-a79f20a19041"
>
</ReqRef><ReqRef
 Id="ecaefeed-fa89-4186-b8b7-e63999df3603"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ffd2cec2-5da8-422b-a8c6-5fc4ce9751ba"
>
</ReqRef><ReqRef
 Id="c04116c0-24b6-4d81-ae02-cff4fa993bef"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8fa0eaad-3da8-4e2a-b7c5-92f4db5a720d"
>
</ReqRef><ReqRef
 Id="200c6541-d8d8-43b9-b5c0-4f586318bbce"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0b95f307-32e9-4b7f-a263-33d54c3b4cee"
>
</ReqRef><Comment>Handles reception of the MA.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Movement authority"
 Guid="b2ace9c6-9fcd-4829-b42f-393341b8a143"
>
<PreConditions>
<PreCondition
 Guid="cc9777a1-c95d-4abd-9469-632ab302b08b"
>Available ( aMessage.MOVEMENT_AUTHORITY )</PreCondition><PreCondition
 Guid="0a1244f7-fc1f-4b75-b7ab-0ca339366842"
>NOT (THERE_IS X IN Kernel.EmergencyStops | X.Reason == Kernel.BrakeReason.OrderFromRBC)</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Gradient profile available"
 Guid="539f7a0f-52e3-44ad-9ab0-68b3b3aaf17c"
>
<ReqRef
 Id="d96e7170-b578-4e28-bb03-82d0b7cc6a6d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="efcc4e90-32d1-4522-9741-fccaf6483a15"
>
</ReqRef><ReqRef
 Id="e1e59e57-94a5-48ea-bb40-d183aa229e20"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9f92ced2-ff9b-4c8e-b0d9-a18f2b01b4b4"
>
</ReqRef><ReqRef
 Id="91c896f9-c3d0-473b-bb99-e2dfb219ae1d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fe5ff221-f09e-41e1-ac39-10691136d712"
>
</ReqRef><Comment>Handles reception of gradient profile received with the MA.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Gradient profile available"
 Guid="beef185c-ea8f-43e9-84d0-f3353e3dbec6"
>
<PreConditions>
<PreCondition
 Guid="15804d7c-33d0-4bfc-85bd-d4a4c1a8d315"
>THERE_IS X IN aMessage.MOVEMENT_AUTHORITY.Sequence1 | Available ( X.GRADIENT_PROFILE )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="84783058-b6d8-48dd-8897-dedcf0d04f7f"
>Kernel.TrackDescription.Gradient.ProfileReceived ( Packet =&gt; ( FIRST X IN aMessage.MOVEMENT_AUTHORITY.Sequence1 | Available ( X.GRADIENT_PROFILE )).GRADIENT_PROFILE )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="International static speed profile available"
 Guid="8864fbd0-0eae-4dce-8805-790e4f3551ee"
>
<ReqRef
 Id="7ba0f65c-e1b5-422f-a1fb-e947e73cd4f9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="10d9f452-46dd-4978-967e-4e75792146df"
>
</ReqRef><ReqRef
 Id="beb70c99-c336-489a-a97e-b8236a026061"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a3adaef1-24a8-455c-89aa-f9b35652a8d1"
>
</ReqRef><ReqRef
 Id="9570bc20-fe09-49cb-8e1d-d7adbb5fdfbc"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8ecaa15f-bdde-4f57-a2e5-5abbad0fae88"
>
</ReqRef><Comment>Handles reception of the international static speed profile received with the MA.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="International static speed profile available"
 Guid="bd9a92b7-41d2-4214-92f6-33a7d4278a14"
>
<PreConditions>
<PreCondition
 Guid="daa8826e-2423-45e0-af75-e2e3365df69f"
>THERE_IS X IN aMessage.MOVEMENT_AUTHORITY.Sequence1 | Available ( X.INTERNATIONAL_STATIC_SPEED_PROFILE )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="cb35e80d-d855-4a80-9c9a-b44f424b0fc7"
>Kernel.TrackDescription.StaticSpeedProfile.StaticSpeedProfileReceived ( Packet =&gt; ( FIRST X IN aMessage.MOVEMENT_AUTHORITY.Sequence1 | Available ( X.INTERNATIONAL_STATIC_SPEED_PROFILE )).INTERNATIONAL_STATIC_SPEED_PROFILE )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="List of balises for SH area available"
 Guid="fcf5520f-ce3c-4f17-b984-02a819e47adb"
>
<ReqRef
 Id="4a580e9d-fd64-4951-b7a4-51530d1469e7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c0e24bd2-6d1d-4cc1-b3d3-ed16112b088a"
>
</ReqRef><ReqRef
 Id="8d9ca13d-bff4-486f-9cb1-dc825fd1b8ab"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6d8a97d8-5e2c-45cf-b9f5-8e90fb857a7f"
>
</ReqRef><Comment>Handles reception of the list of balises for SH area received with the MA.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="List of balises for SH area available"
 Guid="1ac428d8-87fc-45d9-a277-e609c689b426"
>
<PreConditions>
<PreCondition
 Guid="50fdfdf7-d5b4-4b7a-84b2-11828d779ff0"
>THERE_IS X IN aMessage.MOVEMENT_AUTHORITY.Sequence1 | Available ( X.LIST_OF_BALISES_FOR_SH_AREA)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="302b5642-258f-499d-89b3-212a4433b74f"
>Kernel.Shunting.HandleNewListOfBaliseGroups ( Packet =&gt; ( FIRST X IN aMessage.MOVEMENT_AUTHORITY.Sequence1 | Available ( X.LIST_OF_BALISES_FOR_SH_AREA ) ).LIST_OF_BALISES_FOR_SH_AREA )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle common packets"
 Guid="9d2b2f55-0898-4428-9183-70002729d631"
>
<Comment>Handle common packets (as described in Subset-026 Paragraph 8.4.4.4.1.1) received with a movement authority message.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle common packets"
 Guid="06cf69bd-44fb-415c-b4de-0e8df36c62c1"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="534b7962-8df0-4881-a75a-7e88ce4d1d85"
>HandleCommonPackets
(
    Packets =&gt; aMessage.MOVEMENT_AUTHORITY.Sequence1,
    Time =&gt; aMessage.MOVEMENT_AUTHORITY.T_TRAIN
)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle the Movement Authority"
 Guid="7d82c686-4ecc-403f-abbd-e4c751de1bdf"
>
<ReqRef
 Id="63f87a6b-8c3e-4333-b97e-9e417e3623d8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f322b5aa-3e52-44f8-b37d-b356be1b3b17"
>
</ReqRef><ReqRef
 Id="5fff9a06-3432-4ce9-b8e0-9b36de116805"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2d0a8ab9-9dae-4ed6-a748-95a39c9b153d"
>
</ReqRef><ReqRef
 Id="d833d8f6-90b9-499b-bdb1-408971c2cbfe"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a622f005-ec93-4509-9936-58883e29eaa3"
>
</ReqRef><ReqRef
 Id="f0c86934-5f4c-4832-bb8d-5fce455e3e7e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="551b8673-8961-4cd9-8469-961d3530f9e6"
>
</ReqRef><ReqRef
 Id="f9ca42e2-644d-47a2-b6e3-80059c79e361"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e80f884d-b06d-4fb7-89ee-1fb58f2f242f"
>
</ReqRef><ReqRef
 Id="00601485-94ca-4c66-a312-5037844661af"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="626ef3ec-8126-47b1-8d9a-a4507f600f1d"
>
</ReqRef><Comment>At the end, handles the Movement Authority. This is done after all the packets were handled in order to be able to evaluate the track description, if any.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle the Movement Authority"
 Guid="efe7c9f4-a17c-4a68-a757-697eabef2d1a"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="34f6db8a-45cd-4c94-b8e3-83e7ea450181"
>Kernel.MA.MALvl2or3Received
(
    Packet =&gt; aMessage.MOVEMENT_AUTHORITY.LEVEL_2_3_MOVEMENT_AUTHORITY,
    NID_BG =&gt; aMessage.MOVEMENT_AUTHORITY.NID_LRBG,
    SectionStartTimer =&gt; Default.MessageTypes.TimeResolution ( time =&gt; aMessage.MOVEMENT_AUTHORITY.T_TRAIN )
)</Action><Action
 Guid="03bcefd6-b932-4560-84fe-4d09a3f2be6f"
>Kernel.MA.MATimers.LOATimerStart &lt;- Default.MessageTypes.TimeResolution( time =&gt; aMessage.MOVEMENT_AUTHORITY.T_TRAIN )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Mode profile available"
 Guid="77eaf966-192f-4c0e-9990-7e4897dad4af"
>
<ReqRef
 Id="de18f207-08ba-467b-a877-d3c5a458123d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9a402d46-e655-4ff8-ad35-7229f2ed2f0a"
>
</ReqRef><ReqRef
 Id="5fff9a06-3432-4ce9-b8e0-9b36de116805"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ae797155-a1ea-43a4-95f4-72ea15165d33"
>
</ReqRef><ReqRef
 Id="63f87a6b-8c3e-4333-b97e-9e417e3623d8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b3ffeffc-b145-44a2-a355-aa32b1978837"
>
</ReqRef><ReqRef
 Id="8d9ca13d-bff4-486f-9cb1-dc825fd1b8ab"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="932794cc-71cd-4b77-87c8-84d7360e01f3"
>
</ReqRef><Comment>Handles reception of mode profile received with the MA (only if the MA was accepted).</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Mode profile available"
 Guid="009cc428-70b4-4b0a-b5df-468b677b743e"
>
<PreConditions>
<PreCondition
 Guid="9faa2fda-94d0-4d88-b999-35cbcbcf7f60"
>THERE_IS X IN aMessage.MOVEMENT_AUTHORITY.Sequence1 | Available ( X.MODE_PROFILE )</PreCondition><PreCondition
 Guid="e03da753-7cd6-4dc6-a1f4-d558ed56a340"
>Kernel.MA.MAIsAccepted</PreCondition></PreConditions>
<Actions>
<Action
 Guid="1d0407c6-42f3-4cd3-9dbd-5721ca7faffe"
>Kernel.MA.ModeProfile.ModeProfileReceived (
  Packet =&gt; ( FIRST X IN aMessage.MOVEMENT_AUTHORITY.Sequence1 | Available ( X.MODE_PROFILE)).MODE_PROFILE,
  GenericLSMarker =&gt; False
)</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="UpdateINTERNAL"
 Implemented="TRUE"
 Name="Request to shorten MA"
 Guid="f573cc24-d8e7-4a5a-837b-fcfd15701f42"
>
<ReqRef
 Id="f4723221-15fd-4636-851f-08a437cc18e6"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="54da9cb4-680f-43b6-b33a-03a77edf5ce4"
>
</ReqRef><ReqRef
 Id="4a580e9d-fd64-4951-b7a4-51530d1469e7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="89f3be06-5ef7-468a-b825-4e1198285de5"
>
</ReqRef><ReqRef
 Id="8430bb84-5228-4341-b64b-f578dfc94604"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d9bcc358-027f-447c-8982-38032c81b0fc"
>
</ReqRef><ReqRef
 Id="ecaefeed-fa89-4186-b8b7-e63999df3603"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7ea53fc6-d681-41e6-9683-e9812a8a9b37"
>
</ReqRef><ReqRef
 Id="20a7a00d-396e-453b-8cd0-0a2ec8f83340"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f1cf6eb2-201c-4dbe-9594-553bc1a6c1ff"
>
</ReqRef><ReqRef
 Id="200c6541-d8d8-43b9-b5c0-4f586318bbce"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b077f519-c4f7-4059-b4b7-090c9ffd6270"
>
</ReqRef><Comment>Handles reception of the request to shorten MA.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Request to shorten MA"
 Guid="b3c21ffa-a5dc-4ee9-8a69-18a619d2a108"
>
<PreConditions>
<PreCondition
 Guid="324ed534-7ece-4d2d-83d2-634f8405934d"
>Available ( aMessage.REQUEST_TO_SHORTEN_MA )</PreCondition><PreCondition
 Guid="ac3c42b9-2925-4f5d-a63b-8248eade008e"
>NOT (THERE_IS X IN Kernel.EmergencyStops | X.Reason == Kernel.BrakeReason.OrderFromRBC)</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Mode profile available"
 Guid="0118014c-9220-4336-9541-bf8317e774e2"
>
<ReqRef
 Id="de18f207-08ba-467b-a877-d3c5a458123d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2b4661af-9e46-4ac4-9f54-c9ec3eb55d10"
>
</ReqRef><ReqRef
 Id="de18f207-08ba-467b-a877-d3c5a458123d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="745f1f3e-15fd-429b-964b-ea647b81965e"
>
</ReqRef><ReqRef
 Id="8d9ca13d-bff4-486f-9cb1-dc825fd1b8ab"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b33dc4d8-c13f-4566-83fc-35d50ed9941d"
>
</ReqRef><Comment>Handles reception of the mode profile received with the request to shorten MA.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Mode profile available"
 Guid="a57d89cc-ee5f-47b4-9486-73125c45cc4d"
>
<PreConditions>
<PreCondition
 Guid="6f406375-f0b0-4331-aa87-fa5c9fcc422c"
>THERE_IS X IN aMessage.REQUEST_TO_SHORTEN_MA.Sequence1 | Available ( X.MODE_PROFILE )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="42923357-d030-4973-8f7e-66c4c0796d02"
>Kernel.MA.ModeProfile.ModeProfileReceived (
  Packet =&gt; ( FIRST X IN aMessage.REQUEST_TO_SHORTEN_MA.Sequence1 | Available ( X.MODE_PROFILE)).MODE_PROFILE,
  GenericLSMarker =&gt; False
)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Shortened MA accepted"
 Guid="cceec5af-35c2-47b3-bc2d-d6c0c115605e"
>
<ReqRef
 Id="d833d8f6-90b9-499b-bdb1-408971c2cbfe"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b5481b1a-2e32-494e-80ec-405882131302"
>
</ReqRef><ReqRef
 Id="f0c86934-5f4c-4832-bb8d-5fce455e3e7e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d45e8c84-d628-48f9-89b7-7969ac7f5b82"
>
</ReqRef><ReqRef
 Id="f9ca42e2-644d-47a2-b6e3-80059c79e361"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="88086661-9850-4991-86d6-fdc3f7d416d2"
>
</ReqRef><ReqRef
 Id="00601485-94ca-4c66-a312-5037844661af"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9ce54f0d-e573-46c8-ab8a-4cb9a0f66dda"
>
</ReqRef><ReqRef
 Id="26d39c75-1c24-46e6-b725-d71bd2fbd1c3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="68b21689-1656-4950-ba6d-9f6f2acfd329"
>
</ReqRef><ReqRef
 Id="c11c2ace-e3a5-4fe7-9621-b28a5a50f720"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="26c9e98c-6dfc-4341-8953-1c86b2181fe4"
>
</ReqRef><ReqRef
 Id="d88061c9-dc9a-4ffc-8134-4bc8eef39511"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3351e4ec-4c63-42a2-b92c-f33d8f68049d"
>
</ReqRef><ReqRef
 Id="0385292a-59d1-48df-b95b-ac8936ef26aa"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d51832e2-d31d-449a-9e23-92956ae8e466"
>
</ReqRef><Comment>If the MA is accepted, it is handled normally and the LOA timer is handled.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Shortened MA accepted"
 Guid="1ae7c0c9-87c4-4840-a378-4f75c26cbdbb"
>
<Comment>If the shortened MA is accepted, it is stored on-board and the RBC is informed.</Comment>
<PreConditions>
<PreCondition
 Guid="cc96c7be-eee9-4b2b-9b03-f57493fb0d0d"
>Kernel.MA.ShortenedMAIsAccepted( aShortenedMA =&gt; aMessage.REQUEST_TO_SHORTEN_MA.LEVEL_2_3_MOVEMENT_AUTHORITY )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="d4fb8501-640d-4856-92c1-a168eeed555f"
><Comment>Saves the time stamp of the new MA for the LOA timer.</Comment>
Kernel.MA.MATimers.LOATimerStart &lt;- Default.MessageTypes.TimeResolution( time =&gt; aMessage.REQUEST_TO_SHORTEN_MA.T_TRAIN )</Action><Action
 Guid="6702a997-d01c-4601-b7d0-cf2f0f22ec85"
>Kernel.MA.MALvl2or3Received
(
    Packet =&gt; aMessage.REQUEST_TO_SHORTEN_MA.LEVEL_2_3_MOVEMENT_AUTHORITY,
    NID_BG =&gt; aMessage.MOVEMENT_AUTHORITY.NID_LRBG,
    SectionStartTimer =&gt; Default.MessageTypes.TimeResolution ( time =&gt; aMessage.MOVEMENT_AUTHORITY.T_TRAIN )
)</Action><Action
 Guid="02fcd07f-ac43-4f48-82e0-6a487cf9d95a"
>Kernel.HandlingOfAcceptedAndStoredInformation.CooperativeMARevocationIsGranted &lt;- True</Action><Action
 Guid="47bf888f-72f4-47d4-92c7-32847fd36109"
>CurrentRBCConnection().SendRequestToShortenMAIsGranted( TimeStamp =&gt; aMessage.REQUEST_TO_SHORTEN_MA.T_TRAIN )</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Shortened MA rejected"
 Guid="5c78aaf4-7c26-4359-8c40-b958d51f3776"
>
<Comment>If the shortened MA is rejected, the RBC is informed.</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="bb347d32-fad8-4c16-80dc-e39b3329c50d"
>CurrentRBCConnection().SendRequestToShortenMAIsRejected( TimeStamp =&gt; aMessage.REQUEST_TO_SHORTEN_MA.T_TRAIN )</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Conditional emergency stop"
 Guid="6219bab3-329e-48c8-ac3b-43208d1cff15"
>
<ReqRef
 Id="4f290d49-e10d-41ae-a385-d9a756df04d3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9643411f-14d6-4b2c-959f-9fdb865d1d3a"
>
</ReqRef><ReqRef
 Id="2b2cca84-5637-4f57-be10-029b36aa0f1a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="463dce3d-0288-4eed-a4c4-19a70f55208e"
>
</ReqRef><ReqRef
 Id="f6e5eaf6-2bea-486e-b3f7-3e854c745b5d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="24f871fa-9964-45bb-a5f8-e1716603f5f0"
>
</ReqRef><Comment>Handles reception of a conditional emergency stop message</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Conditional emergency stop"
 Guid="3c618754-ea0f-49ef-8876-9f2dcb57eaeb"
>
<PreConditions>
<PreCondition
 Guid="7ee563c7-9f56-4ea4-a306-7f427f0e871d"
>Available ( aMessage.CONDITIONAL_EMERGENCY_STOP )</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Verify if the train has passed the stop location"
 Guid="a3dde26d-052a-40b9-91b8-f0946f5668e9"
>
<ReqRef
 Id="e0cce2b4-2341-4ff7-8496-f341142799d3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c654505e-1d72-4ca8-a573-c98379db1ce8"
>
</ReqRef><Comment>If the train has not yet passed the stop location, the emergency stop is stored; otherwise it is rejected.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Train has not reached stop location"
 Guid="906d528d-1a88-4d5d-8ab4-4532dd386338"
>
<ReqRef
 Id="f40c3edb-de6e-4b83-98fc-97be15c1f7a3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b566403b-039c-48c5-a295-e471c0eb7220"
>
</ReqRef><Comment>If the train has not yet reached the stop location defined in the message, the stop location is the new EOA and SvL</Comment>
<PreConditions>
<PreCondition
 Guid="b45902ce-1ad5-4544-b07a-efd3ce8b7857"
>Kernel.TrainPosition.FrontEndPosition( PointOfInterest=&gt;Default.DistanceInterval.Min )  &lt; 
Default.MessageTypes.QScaleDistance(
    distance =&gt; aMessage.CONDITIONAL_EMERGENCY_STOP.D_EMERGENCYSTOP,
    scale =&gt; aMessage.CONDITIONAL_EMERGENCY_STOP.D_EMERGENCYSTOP
)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="13e508f8-8fd5-4eab-af3b-ebd073c96e70"
>Kernel.AddEmergencyStop( aMessage )</Action><Action
 Guid="0c732be4-110b-4fc8-97df-216421d855ca"
>Kernel.HandlingOfAcceptedAndStoredInformation.ConditionalEmergencyStopExecuted &lt;- True</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Train has passed stop location"
 Guid="676caee5-da37-43fb-b10b-cfe4fbb2ac70"
>
<Comment>If the train has already passed the stop location, the emergency stop is rejected and the RBC is informed.</Comment>
<PreConditions>
<PreCondition
 Guid="d576cf7f-55e9-49ee-8461-75648e378b60"
>Kernel.TrainPosition.FrontEndPosition( PointOfInterest=&gt;Default.DistanceInterval.Min )  &gt;= 
Default.MessageTypes.QScaleDistance(
    distance =&gt; aMessage.CONDITIONAL_EMERGENCY_STOP.D_EMERGENCYSTOP,
    scale =&gt; aMessage.CONDITIONAL_EMERGENCY_STOP.D_EMERGENCYSTOP
)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="40cd1d56-1167-44a7-a25a-cdddeccd30bd"
>CurrentTerminal().RBCConnection.SendAcknowledgementOfEmergencyStop(
    aMessage =&gt; aMessage,
    Qualifier =&gt; Messages.Q_EMERGENCYSTOP.Conditional_Emergency_Stop_rejected__because_the_train_has_passed_the_emergency_stop_location__ref_3_10_2_2
 )</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Unconditional emergency stop"
 Guid="d181ba0c-6ecc-4a2b-9f9b-3d3ea2832731"
>
<ReqRef
 Id="2b2cca84-5637-4f57-be10-029b36aa0f1a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="85d11b25-dd44-4bb1-b9df-67a55173645e"
>
</ReqRef><ReqRef
 Id="0043347f-c382-4046-b7ae-6c3e73575ec6"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0a2e1044-20d8-4600-a7ca-c4e2dadc2427"
>
</ReqRef><Comment>Handles reception of an unconditional emergency stop message</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Unconditional emergency stop"
 Guid="2c426004-97a7-4ae6-8fa9-767322005526"
>
<PreConditions>
<PreCondition
 Guid="2a1175db-f9be-4516-b844-38ee6b37cd28"
>Available ( aMessage.UNCONDITIONAL_EMERGENCY_STOP )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="14b50c09-3233-48b7-8e73-bbdeae756ac9"
>Kernel.AddEmergencyStop( aMessage )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="UpdateINTERNAL"
 Implemented="TRUE"
 Name="General message"
 Guid="e53756b8-59a0-40ca-aa4c-9eca78feb0b4"
>
<ReqRef
 Id="4dea631e-f3ef-4f67-8232-6d867ebc7c34"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="311ecfe7-ea5c-4667-a285-a1892d7774f7"
>
</ReqRef><ReqRef
 Id="7791130c-94a3-4a45-9437-4a4835707e9a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fc12ef86-a020-42c5-a007-275d305a6e17"
>
</ReqRef><Comment>Handles reception of the general message.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="General message"
 Guid="73ad08e9-e929-4ea4-93c0-5cb635407280"
>
<PreConditions>
<PreCondition
 Guid="379edce7-f62e-4d83-8b49-c4b6bf2389a9"
>Available ( aMessage.GENERAL_MESSAGE )</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle common packets"
 Guid="d6787fe0-61a4-40b6-9064-f92350a24b90"
>
<Comment>Handle common packets (as described in Subset-026 Paragraph 8.4.4.4.1.1) received with a general message.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle common packets"
 Guid="fa65ce4c-abac-4895-b238-60fcd690e7b8"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="30b31d73-66f4-4e11-a0ae-a3bf2c3166c3"
>HandleCommonPackets
(
    Packets =&gt; aMessage.GENERAL_MESSAGE.Sequence1,
    Time =&gt; aMessage.GENERAL_MESSAGE.T_TRAIN
)</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="UpdateINTERNAL"
 Implemented="TRUE"
 Name="SH authorised"
 Guid="4bb7073f-95bc-4318-8d3f-3caa5247ea0c"
>
<ReqRef
 Id="a9c3b99f-ed94-4e53-9926-e303c3898b8a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e98a66ec-b3a6-46c1-ade8-a2123a480ae2"
>
</ReqRef><ReqRef
 Id="38d45e49-f55c-4765-9dfc-1faf09f9a446"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="eb037c3a-2341-462f-a1b4-cb08fb84ccff"
>
</ReqRef><Comment>Handles reception of shunting authorised.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="SH authorised"
 Guid="9df194d9-d435-4491-af34-2b1bdab6c098"
>
<PreConditions>
<PreCondition
 Guid="b6beabb3-2162-4140-bf62-6c441dbea7c6"
>Available ( aMessage.SH_AUTHORISED )</PreCondition></PreConditions>
<Actions>
</Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="UpdateINTERNAL"
 Implemented="TRUE"
 Name="MA with shifted location reference"
 Guid="c827bc7f-c31b-4e5b-b1d7-0c40f0977756"
>
<ReqRef
 Id="f4723221-15fd-4636-851f-08a437cc18e6"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f201ac46-7bc8-4573-abb2-42dd3c495037"
>
</ReqRef><ReqRef
 Id="4a580e9d-fd64-4951-b7a4-51530d1469e7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c19718f7-8892-4eec-822e-47429c73ee54"
>
</ReqRef><ReqRef
 Id="17ca4691-52af-4571-83b8-d4e345bcc557"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3a85200b-d4dc-4c63-ab3f-58ace0758c7c"
>
</ReqRef><ReqRef
 Id="ecaefeed-fa89-4186-b8b7-e63999df3603"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="375a6cbf-421a-4321-8edd-7f8a1766d267"
>
</ReqRef><ReqRef
 Id="97eca6f5-ba51-4c2e-a71f-3e5752290f21"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="965919c6-b6c4-4cf8-9e69-97d8915441fb"
>
</ReqRef><ReqRef
 Id="200c6541-d8d8-43b9-b5c0-4f586318bbce"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bad02f96-86eb-4715-beab-10bb92b43d68"
>
</ReqRef><ReqRef
 Id="d833d8f6-90b9-499b-bdb1-408971c2cbfe"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5fbeb28a-e767-429f-b689-781bdadbc096"
>
</ReqRef><ReqRef
 Id="f0c86934-5f4c-4832-bb8d-5fce455e3e7e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0a17f545-62a2-415b-9648-05f864f135d4"
>
</ReqRef><ReqRef
 Id="00601485-94ca-4c66-a312-5037844661af"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="297eefcb-fe92-4160-b242-3593360731db"
>
</ReqRef><Comment>Handles reception of MA with shifted location reference.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="MA with shifted location reference"
 Guid="e0951c53-d0ce-491c-8f51-9d84c8f49e55"
>
<ReqRef
 Id="f9ca42e2-644d-47a2-b6e3-80059c79e361"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d62bbe47-2ec4-482e-b95a-9f103e40bfeb"
>
</ReqRef><PreConditions>
<PreCondition
 Guid="4b26ec5f-a027-4caa-bca8-cd8c1bb56153"
>Available ( aMessage.MA_WITH_SHIFTED_LOCATION_REFERENCE )</PreCondition><PreCondition
 Guid="1d3581de-d6a2-4ce9-aa78-ab337178f1a0"
>NOT (THERE_IS X IN Kernel.EmergencyStops | X.Reason == Kernel.BrakeReason.OrderFromRBC)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="4f874ce0-62dc-4762-ae3b-b8e6efe9f83b"
>Kernel.MA.MALvl2or3Received
(
    Packet =&gt; aMessage.MA_WITH_SHIFTED_LOCATION_REFERENCE.LEVEL_2_3_MOVEMENT_AUTHORITY,
    NID_BG =&gt; aMessage.MA_WITH_SHIFTED_LOCATION_REFERENCE.NID_LRBG,
    SectionStartTimer =&gt; Default.MessageTypes.TimeResolution ( time =&gt; aMessage.MOVEMENT_AUTHORITY.T_TRAIN )
)</Action><Action
 Guid="50e62eff-bd12-4fa0-b4e8-45ee5c8367fa"
>Kernel.MA.MATimers.LOATimerStart &lt;- Default.MessageTypes.TimeResolution( time =&gt; aMessage.MOVEMENT_AUTHORITY.T_TRAIN )</Action></Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Mode profile available"
 Guid="d438dc8b-7936-4bcf-8833-97af765a4527"
>
<ReqRef
 Id="de18f207-08ba-467b-a877-d3c5a458123d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0ed54168-0a74-4d24-88f7-fcbdd7fbf41d"
>
</ReqRef><ReqRef
 Id="8d9ca13d-bff4-486f-9cb1-dc825fd1b8ab"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c99cb77c-5ecb-4070-a2bb-c51caf609161"
>
</ReqRef><Comment>Handles reception of mode profile received with MA with shifted location reference message.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Mode profile available"
 Guid="5fd08ada-39f6-43b7-bb09-1af3639e5a10"
>
<PreConditions>
<PreCondition
 Guid="4db7c2bd-92a6-46fa-8e2a-21d174da1a53"
>THERE_IS X IN aMessage.MA_WITH_SHIFTED_LOCATION_REFERENCE.Sequence1 | Available ( X.MODE_PROFILE )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="6fc1e57f-7584-4af7-b92a-c41bcf7f6e58"
>Kernel.MA.ModeProfile.ModeProfileReceived (
  Packet =&gt; ( FIRST X IN aMessage.MA_WITH_SHIFTED_LOCATION_REFERENCE.Sequence1 | Available ( X.MODE_PROFILE)).MODE_PROFILE,
  GenericLSMarker =&gt; False
)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle common packets"
 Guid="869557a0-0507-4938-a986-1cd81407d126"
>
<Comment>Handle common packets (as described in Subset-026 Paragraph 8.4.4.4.1.1) received with a MA with shifted location reference message.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle common packets"
 Guid="b190dcf2-d2fd-42bb-a13b-1f32d317ef08"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="c7f0a384-3a4a-444b-b3e3-fdb95fb71bd0"
>HandleCommonPackets
(
    Packets =&gt; aMessage.MA_WITH_SHIFTED_LOCATION_REFERENCE.Sequence1,
    Time =&gt; aMessage.GENERAL_MESSAGE.T_TRAIN
)</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="RBC/RIU system version"
 Guid="72ea757d-52ec-42fa-bd6a-154f694dc4ae"
>
<ReqRef
 Id="02f20f26-3445-49b9-95cf-a6948ab029b8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bb6b5b48-be53-43e2-9e0c-154d5613bdd7"
>
</ReqRef><ReqRef
 Id="71740f57-d219-41b2-93f8-319c302b1afa"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="11c4849e-4311-4b6f-b7eb-f58c203eb04c"
>
</ReqRef><ReqRef
 Id="2eda81e7-52ac-483d-91c9-169e8718de74"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b022c87b-4aa3-482c-840a-fcc52d3a0394"
>
</ReqRef><Comment>Handles reception of the RBC/RIU system version.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="RBC/RIU system version"
 Guid="17ca29cb-fad8-4162-8eb4-95e27de49f9d"
>
<PreConditions>
<PreCondition
 Guid="4fa84a57-6d47-40db-a5af-2a05d082f8c1"
>Available ( aMessage.RIU_SYSTEM_VERSION )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="edc7241a-b3a2-422c-bbe6-f815e0c132da"
>HandleRBCRIUSystemVersion ( aMessage =&gt; aMessage.RIU_SYSTEM_VERSION )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="UpdateINTERNAL"
 Implemented="TRUE"
 Name="Infill MA"
 Guid="ed471ca1-d692-4236-a58c-bfb34482b2b2"
>
<ReqRef
 Id="f4723221-15fd-4636-851f-08a437cc18e6"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ffd8fa69-6a8a-4a28-b335-5593a40ea323"
>
</ReqRef><ReqRef
 Id="4a580e9d-fd64-4951-b7a4-51530d1469e7"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d6de3548-9a65-4ada-a1ea-64a1c5951ce6"
>
</ReqRef><ReqRef
 Id="eca6c9fc-15bb-4b61-8142-88af3b8e685f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="83a5a26a-12f1-455a-9292-86eb8210ba4e"
>
</ReqRef><ReqRef
 Id="ecaefeed-fa89-4186-b8b7-e63999df3603"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fa7cb1f2-644d-4672-b24d-350205f7137f"
>
</ReqRef><ReqRef
 Id="6e740969-1d8d-40d5-bcaf-7bf18e08aa4b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="59aa4caf-5770-4786-9d48-e880bbbf674a"
>
</ReqRef><Comment>Handles reception of the infill MA.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Infill MA"
 Guid="d88ca5bb-9db1-4adf-b76e-e87731cb14a6"
>
<PreConditions>
<PreCondition
 Guid="2218137b-5a46-48c7-996e-77239bd0276d"
>Available ( aMessage.INFILL_MA )</PreCondition><PreCondition
 Guid="ef9e6dde-adf6-4d12-a2ca-7091646da7e6"
>NOT (THERE_IS X IN Kernel.EmergencyStops | X.Reason == Kernel.BrakeReason.OrderFromRBC)</PreCondition></PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Route suitability data available"
 Guid="1cfcd676-857b-4365-ae5e-e92d658219b7"
>
<ReqRef
 Id="3eae43ab-6f26-4908-9360-5a8ce0bec069"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1aa70151-07e5-4921-beff-f097d27213fd"
>
</ReqRef><Comment>Handles reception of the route suitability data received with infill MA.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Route suitability data available"
 Guid="cfe0f284-c660-462a-b15f-f16501bcb05d"
>
<PreConditions>
<PreCondition
 Guid="a9a94a8a-24a1-42dd-bba4-78709ada8176"
>THERE_IS X IN aMessage.INFILL_MA.Sequence1 | Available ( X.ROUTE_SUITABILITY_DATA )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="7cd439db-30ed-4037-bc40-1110364e540b"
>Kernel.TrackDescription.RouteSuitability.RouteSuitabilityReceived ( Packet =&gt; ( FIRST X IN aMessage.INFILL_MA.Sequence1  | Available ( X.ROUTE_SUITABILITY_DATA ) ).ROUTE_SUITABILITY_DATA )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Mode profile available"
 Guid="ba5e7903-74f0-416c-ace9-cdc1392a7a73"
>
<ReqRef
 Id="de18f207-08ba-467b-a877-d3c5a458123d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="890d979e-b69a-40ed-9fb9-9575e833679d"
>
</ReqRef><ReqRef
 Id="8d9ca13d-bff4-486f-9cb1-dc825fd1b8ab"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="016e39a9-3d5e-4d6c-b7b4-277c5eb831c0"
>
</ReqRef><Comment>Handles reception of mode profile received with the infill MA.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Mode profile available"
 Guid="5723e1bb-1530-43ae-b94a-8989fd2a71a0"
>
<PreConditions>
<PreCondition
 Guid="568a6d32-c46c-450a-86ed-fa1646521c57"
>THERE_IS X IN aMessage.INFILL_MA.Sequence1 | Available ( X.MODE_PROFILE )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="3913ccf6-bc3b-423b-a4da-7742b09c8e22"
>Kernel.MA.ModeProfile.ModeProfileReceived (
  Packet =&gt; ( FIRST X IN aMessage.INFILL_MA.Sequence1 | Available ( X.MODE_PROFILE)).MODE_PROFILE,
  GenericLSMarker =&gt; False
)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Level transition order available"
 Guid="1e3c7c24-198c-43ed-975b-dbe5a441caf3"
>
<ReqRef
 Id="7e7c641f-fe52-42ac-9aa8-12e5c7dfd6b2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c6272465-206f-4fd5-958d-983191281a02"
>
</ReqRef><Comment>Handles reception of level transition orders received with the infill MA.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Level transition order available"
 Guid="b23111b6-dc5d-4ef3-bcdc-8872f1653ec4"
>
<PreConditions>
<PreCondition
 Guid="8eba5cd9-0030-4d92-826b-c91887c836ed"
>THERE_IS X IN aMessage.INFILL_MA.Sequence1 | Available ( X.LEVEL_TRANSITION_ORDER )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="fd9f395f-4d3f-45ad-b8bf-3444ca9d3d17"
>Kernel.LevelTransition.LTOReceived ( Packet =&gt; ( FIRST X IN aMessage.INFILL_MA.Sequence1 | Available ( X.LEVEL_TRANSITION_ORDER )).LEVEL_TRANSITION_ORDER )</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Initiation of a communication session"
 Guid="3e9c2f71-7759-4362-8ed1-97a91010386c"
>
<ReqRef
 Id="5c22942d-5616-44c5-8707-c8edf2889ba9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1e499a6d-626e-4b40-8786-2c0ce268c05c"
>
</ReqRef><ReqRef
 Id="0e6b5d89-69d9-43ff-8971-5f84c02aa2d2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f3d9f4ac-c494-49dd-aca2-336102819dfe"
>
</ReqRef><ReqRef
 Id="5553cd84-d563-49a7-8514-0b4890a35066"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f978fd61-c163-44bb-9cb9-4a96cc73951f"
>
</ReqRef><Comment>Handles reception of the inifiation of a communication session.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Initiation of a communication session"
 Guid="8a935a5f-97b3-472e-b592-2d1156866e13"
>
<PreConditions>
<PreCondition
 Guid="235a0300-92ec-446e-821a-89a960c55b93"
>Available ( aMessage.INITIATION_OF_A_COMMUNICATION_SESSION )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="12ed8134-932c-460b-b43c-93b9450e806e"
>HandleInitiationOfACommunicationSession ( aMessage =&gt; aMessage.INITIATION_OF_A_COMMUNICATION_SESSION )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Train accepted"
 Guid="725718e5-f5f3-4f4d-b754-8dc45947c867"
>
<ReqRef
 Id="1494c427-572b-4bfa-bfea-2aa68994f26e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="35b0fb55-f322-40c7-b19f-c98132dbe02f"
>
</ReqRef><ReqRef
 Id="7c2005be-ddda-445e-89ca-07171e96ad2a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="733d7266-45ff-4358-93bb-e366e518f3ce"
>
</ReqRef><Comment>Handles reception of Train accepted by the RBC.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Train accepted"
 Guid="2dfc97cc-3038-4f6e-aa93-0ae81b2b5952"
>
<PreConditions>
<PreCondition
 Guid="004c4b64-a44e-4794-961c-bbe0398ae621"
>Available ( aMessage.TRAIN_ACCEPTED )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="fc94d5e3-5ec4-4589-82e9-ccd1a4cb832f"
>BTM.LRBG &lt;- BTM.BaliseGroupStruct{
    Position =&gt; BTM.Position{
        Position =&gt; Default.BaseTypes.Distance.Unknown,
        UnderReadingAmountOdo =&gt; 0.0,
        OverReadingAmountOdo =&gt; 0.0
    },
    NID =&gt; aMessage.TRAIN_ACCEPTED.NID_LRBG,
    Orientation =&gt; Default.Orientation.Unknown,
    Timestamp =&gt; Kernel.DateAndTime.Now()
}</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Track ahead free request"
 Guid="94458279-c5f8-4ad9-8905-dba6a4e03d8e"
>
<ReqRef
 Id="9f590dd5-5917-4dd1-bc6d-a17f6fff66a8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c6f1dafb-4228-4bbf-9cf0-3dc3b6b2b7ba"
>
</ReqRef><ReqRef
 Id="39d3a3da-a2a7-44e3-858d-5549ecf03336"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="723fe0d6-1315-48b0-b567-e63d38f4b7b4"
>
</ReqRef><ReqRef
 Id="d791550a-a843-44fe-8bf3-174bad2c8112"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a323a74e-0b84-4ac3-9ccc-2adc8bbae466"
>
</ReqRef><ReqRef
 Id="2a9d3fd0-c8d7-4772-96d9-a87b680e4435"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="423a9267-acf6-41ab-9f8a-55141ab330ce"
>
</ReqRef><Comment>Handles reception of Track ahead free request.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Track ahead free request"
 Guid="ab7cd9b2-b961-4259-b7d7-183625d8add1"
>
<PreConditions>
<PreCondition
 Guid="49e1775e-6397-4477-91a0-21ca5473c6f7"
>Available ( aMessage.TRACK_AHEAD_FREE_REQUEST )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="a9e8f466-9aaf-47c1-ae92-7d4f01e53b0c"
>Kernel.TrackAheadFree.TrackAheadFreeRequestReceived(  aMessage =&gt; aMessage.TRACK_AHEAD_FREE_REQUEST )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Prepare acknowledgement if requested"
 Guid="05f32dd2-3e73-453b-8a77-e33513624811"
>
<ReqRef
 Id="5d32be4c-e8c6-495c-851d-1b636031e4a8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a15ebf8d-52d8-4401-9ec2-e5b74d7c7a42"
>
</ReqRef><Comment>If the received message requires an acknowledgement, immediately prepare the message.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Prepare acknowledgement if requested"
 Guid="73d9e923-767a-4b43-b010-f00927f93139"
>
<PreConditions>
<PreCondition
 Guid="c1dca0d3-0c3e-4b48-861c-8a4487b94bdc"
>Messages.MESSAGE.TRACK_TO_TRAIN.GetM_ACK(CurrentRBCConnection().MessageIn.Message) == Messages.M_ACK.Acknowledgement_required</PreCondition></PreConditions>
<Actions>
<Action
 Guid="19b6e284-2a5e-48ed-8f16-6aa19fd8ac3e"
>CurrentRBCConnection().SendAcknowledgement()</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="440"
 Y="900"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="HandleRBCRIUSystemVersion"
 Guid="10dc8bf3-fb79-4fc2-987d-1b29ba45fa25"
>
<ReqRef
 Id="02f20f26-3445-49b9-95cf-a6948ab029b8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ca11414d-dcc4-4bd5-992b-5a6a7c591964"
>
</ReqRef><Comment>When the RBC/RIU system version is received, it is stored on-board and will be used to indicate that the RBC connection is established.</Comment>
<Parameters>
<Parameter
 Type="Messages.MESSAGE.TRACK_TO_TRAIN.RBC.RIU_SYSTEM_VERSION.Message"
 Name="aMessage"
 Guid="ae749290-5bd3-4a59-8892-1f02e400373a"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Store the received system version"
 Guid="fb46a7fe-c199-4921-811e-cdacaa581017"
>
<Comment>Stores the received system version.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Store the received system version"
 Guid="b5198c94-238e-49b1-ab0f-a07e1f53f92d"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="e17bef78-a2ff-421f-8ab3-bf8d2d0939ac"
>CurrentRBCConnection().SessionManagementData.SystemVersion.Value &lt;- ConvertSystemVersion ( aVersion =&gt; aMessage.M_VERSION )</Action><Action
 Guid="8212c19a-2428-4a44-aa05-ed206845382b"
>CurrentRBCConnection().SessionManagementData.SystemVersion.DataState &lt;- Default.DataState.Valid</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="440"
 Y="840"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="RadioNetworkRegistrationReceived"
 Guid="0b3f4004-daf2-4f22-a675-61269508d61e"
>
<ReqRef
 Id="865bbdd6-2010-4869-ab3e-bc538ce5fe4b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9f1efa44-e607-4495-a768-a7e92c45951a"
>
</ReqRef><ReqRef
 Id="031d12f5-b1df-4716-9eda-a3495861e160"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2188301b-ce9b-461c-be01-a945fc88e97d"
>
</ReqRef><ReqRef
 Id="68a814aa-d977-4ba8-8329-54aaaec00081"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="36e920c8-9a91-4d15-83c4-9402d1c70f6d"
>
</ReqRef><ReqRef
 Id="e0778e14-e6ea-4f06-8c69-56236250b636"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d1c00597-b875-43be-a6b1-b9727c36bf78"
>
</ReqRef><ReqRef
 Id="9f6c605e-3f76-4367-a7a4-7f4fa458ef67"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="cc235dda-70f6-4e15-b17d-83882a1010c6"
>
</ReqRef><ReqRef
 Id="dcc51a42-0407-4ab9-855a-55dc04e2ce4e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b7b3e488-4174-403c-9eab-07cabf6e2618"
>
</ReqRef><ReqRef
 Id="dba4721e-ecc7-46a8-945a-ca408198338c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bc40c72d-0651-46df-9b81-ede406c9b2b5"
>
</ReqRef><ReqRef
 Id="fc32fb41-1c57-4753-a923-fe676aabf35d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ffa87291-19d7-49b9-86de-124c42e0c5ec"
>
</ReqRef><Comment>Handles reception of network registration order received from the trackside.</Comment>
<Parameters>
<Parameter
 Type="Messages.PACKET.TRACK_TO_TRAIN.RADIO_NETWORK_REGISTRATION.Message"
 Name="aPacket"
 Guid="9770ebbd-df05-4fdc-800f-a32ef4ebd176"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle radio network registration"
 Guid="51e0899c-678f-4938-8150-70c6f5208527"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle radio network registration"
 Guid="925227fc-89b7-43b1-886e-679d77350bf4"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="847054a6-9b00-4448-832a-5edaa16863c2"
>RegisterMobileTerminals ( aPacket.NID_MN )</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Y="900"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="RegisterATerminal"
 Guid="91d65967-0ce4-4f16-86a3-05c2262bea89"
>
<ReqRef
 Id="07af900f-f07f-4018-abe3-bab8be32b2a9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6920acdb-a800-4874-b91e-7f52be773233"
>
</ReqRef><ReqRef
 Id="e0778e14-e6ea-4f06-8c69-56236250b636"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="94e92411-7aaa-47d2-9a62-3c2e6c77a8f0"
>
</ReqRef><ReqRef
 Id="68a814aa-d977-4ba8-8329-54aaaec00081"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="832b01ee-f945-4278-92c0-f3ee17daaf78"
>
</ReqRef><ReqRef
 Id="9f6c605e-3f76-4367-a7a4-7f4fa458ef67"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="04776bc6-432c-48f5-b474-809ce444a9d4"
>
</ReqRef><ReqRef
 Id="dcc51a42-0407-4ab9-855a-55dc04e2ce4e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="67e9c776-a853-4d0d-95a0-27d086dc8e16"
>
</ReqRef><ReqRef
 Id="dba4721e-ecc7-46a8-945a-ca408198338c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6eae9ec4-d583-4f99-9789-6285cbfc1c32"
>
</ReqRef><Comment>The procedure starts the registering of the provided mobile terminal to the provided network, except if the terminal is already registered to the provided netword.</Comment>
<Parameters>
<Parameter
 Type="EURORADIO.TerminalStruct"
 Name="aTerminal"
 Guid="69f73909-1dca-46c6-a79f-e7d801022eb6"
>
</Parameter><Parameter
 Type="String"
 Name="aNetworkId"
 Guid="16f25452-c7ca-4c62-8a7d-417fe5fdb16f"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Register a terminal"
 Guid="0e7dcaaa-a043-4bc5-baf6-d4ab91873869"
>
<ReqRef
 Id="fc32fb41-1c57-4753-a923-fe676aabf35d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7b24901c-10ca-440f-b179-193bbaca3ef6"
>
</ReqRef><Comment>Requests the registering of the provided mobile terminal to the provided network, if it is not already registered to that network.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Register a terminal"
 Guid="4bc4b088-a4d4-497a-949d-f269fbf04b8a"
>
<PreConditions>
<PreCondition
 Guid="b98357f2-9bff-490d-951c-a72293c7c303"
>aTerminal != EMPTY
  AND
NOT
(
  aTerminal.RegistrationState in TerminalStruct.RegistrationStateSM.Registered
    AND
  aTerminal.NetworkId == aNetworkId
)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="d0f0e831-08a8-4181-a47d-9d039b484d48"
>aTerminal.NetworkIdToRegister &lt;- aNetworkId</Action><Action
 Guid="503a9e82-74de-44aa-9897-753d7f0369c1"
>aTerminal.RegistrationOrderIsReceived &lt;- True</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="110"
 Y="900"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="HandleInitiationOfACommunicationSession"
 Guid="e148b0a4-d11d-4f3d-aa7b-9d8a9065121c"
>
<ReqRef
 Id="5553cd84-d563-49a7-8514-0b4890a35066"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="dc57eeb8-ddae-467e-a5d7-89a5d8c3d293"
>
</ReqRef><ReqRef
 Id="e5b845f3-54de-4120-8f98-f59e56625654"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5c365964-b047-4477-95dd-7596ce4eeed3"
>
</ReqRef><Comment>When the Initiation of a communication session message is received, this information is stored.</Comment>
<Parameters>
<Parameter
 Type="Messages.MESSAGE.TRACK_TO_TRAIN.INITIATION_OF_A_COMMUNICATION_SESSION.Message"
 Name="aMessage"
 Guid="15dd081b-81bb-4708-9e41-0cde0f553038"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Indicate the message is received"
 Guid="c0c8406e-c5a8-4498-9843-d5d8e450fa68"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Indicate the message is received"
 Guid="7555654b-32ae-4b36-a935-25932d303ad0"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="719c1d19-13d5-4770-8ba1-1b886c2f4980"
>CurrentRBCConnection().SessionManagementData.InitiationOfACommunicationSessionReceived &lt;- True</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="220"
 Y="900"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="RBCTransitionOrderReceived"
 Guid="1e2006a9-a669-4dac-9b18-73a3b410b9a4"
>
<ReqRef
 Id="277de94f-c4cd-4612-97ca-ead1fdd29073"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="57a29e9f-b0b9-4fb9-8f95-2c7c99006a38"
>
</ReqRef><ReqRef
 Id="dd006294-7250-4fc8-b4b1-f4e62eb12cf3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="84ac7d36-6459-4483-a805-1aeeba067baa"
>
</ReqRef><ReqRef
 Id="8d7f7c64-ed35-4ee2-a511-68029a576144"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="bb2531bd-299e-48b8-8773-e4053600cacc"
>
</ReqRef><ReqRef
 Id="6fa8d8fc-f346-4592-b64d-ce1831a6cc98"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="08e97e46-ce2b-4d4d-a58e-b89ce3b1246d"
>
</ReqRef><ReqRef
 Id="adc412e3-1c5f-4c95-a667-303e6aabee27"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e2de771a-70b6-4623-a472-a275b5561fc7"
>
</ReqRef><ReqRef
 Id="6a073136-951c-4624-92a2-1b2f704d25ed"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6dc62272-c305-4b84-84aa-36f019aef568"
>
</ReqRef><ReqRef
 Id="9b4338b2-4f0d-4db1-a345-0be6f870c223"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="807a97d4-c6ee-4640-bcdc-8ddbb51314e4"
>
</ReqRef><ReqRef
 Id="dba4721e-ecc7-46a8-945a-ca408198338c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="280f2435-927d-4eeb-96b1-f177423261dd"
>
</ReqRef><ReqRef
 Id="5a5b679d-1bf8-4a70-b313-599b2973a034"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d413c262-371d-4b05-a35d-387a507ed712"
>
</ReqRef><ReqRef
 Id="c61ebf67-0071-46f3-9709-a953a7ec02ea"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2c773d64-aad0-4fd8-a3c7-340abf8bc36b"
>
</ReqRef><ReqRef
 Id="36ac93e3-3877-41a8-98dc-4bbdd6eff050"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="674e3a0d-42e3-4b34-8cb5-430f6765833a"
>
</ReqRef><ReqRef
 Id="e0778e14-e6ea-4f06-8c69-56236250b636"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5901b5b6-d4a3-4c76-afd5-44537704f9cf"
>
</ReqRef><ReqRef
 Id="fb5cdb2c-826a-4be7-babf-d16c11e9720c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="19d0663c-c13e-4507-9da4-cb685bc2c69c"
>
</ReqRef><ReqRef
 Id="3ec1090f-7a64-43bd-ae4c-480f2959143c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="febd7402-717b-4c93-95a0-07fc083e6b9e"
>
</ReqRef><ReqRef
 Id="dba00c16-82a7-40b8-b31c-2978dd6bbd82"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ecd5ea2d-f0ed-4dff-9b8f-2f1bc50522ab"
>
</ReqRef><ReqRef
 Id="09eeadf1-fd15-4f7c-8f52-fb0f04b31d9c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="deb3eb45-c15c-4c64-afde-d4f94bce56d1"
>
</ReqRef><ReqRef
 Id="b0837b14-48a2-43c7-a312-c2fa7b7ae35b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f92abecc-a493-4ed2-bfba-7a5d14970cbe"
>
</ReqRef><ReqRef
 Id="aa345d0e-f599-4016-b5b5-c68601d642fb"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0d247151-d406-407d-96e3-60218521cc09"
>
</ReqRef><ReqRef
 Id="8b8b9125-ec61-4539-8be7-909451a4860a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="432415ec-b3ca-4bf6-a687-30b1d58d8a18"
>
</ReqRef><Comment>Handles the reception of RBC transition order.</Comment>
<Parameters>
<Parameter
 Type="Messages.PACKET.TRACK_TO_TRAIN.RBC_TRANSITION_ORDER.Message"
 Name="aPacket"
 Guid="6dec5918-04af-49bc-86dd-f155782a3cf8"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle RBC transition order"
 Guid="fec91845-5ab0-45e8-9030-039e43156b41"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle RBC transition order"
 Guid="f3f1f4d2-821a-4f89-a412-c9ed748cc203"
>
<Comment>Manage the RBC/RBC handover.</Comment>
<PreConditions>
<PreCondition
 Guid="07c5b809-13b3-4f39-b519-5f01c929afa6"
>Kernel.ActiveFunctions.ManageRBC_RBCHandover()</PreCondition></PreConditions>
<Actions>
<Action
 Guid="c0382dd7-53dc-4905-9aa6-af132fc3f8ca"
>ContactAcceptingRBC
(
    Order =&gt; EURORADIO.ContactOrderStruct
    {
        Id =&gt; EURORADIO.RBCIdStruct
        {
            Country =&gt; aPacket.NID_C,
            Id =&gt; aPacket.NID_RBC
        },
        PhoneNumber =&gt; aPacket.NID_RADIO,
        ActionToPerform =&gt; ContactActionEnum.Establish,
        AppliesToSleepingUnits =&gt; ConvertAppliesToSleepingUnits ( aValue =&gt; aPacket.Q_SLEEPSESSION )
    }
)</Action><Action
 Guid="d3c6cdf9-9747-4381-9c1e-6895964348f9"
>PositionReport.RBCTransitionLocation &lt;- Default.MessageTypes.QScaleDistance
(
    distance =&gt; aPacket.D_RBCTR,
    scale =&gt; aPacket.Q_SCALE
)</Action><Action
 Guid="292b24e9-212c-45d5-b0f0-e37848e44ad8"
>PositionReport.NumberOfReportsSentToHandingOverRBC &lt;- 0</Action><Action
 Guid="89c525f7-4f86-4365-ac3c-d181b753d36c"
>LastKnownRBC &lt;- EURORADIO.RBCContactStruct
{
    Id =&gt; EURORADIO.RBCIdStruct{
        Country =&gt; aPacket.NID_C,
        Id =&gt; aPacket.NID_RBC
    },
    PhoneNumber =&gt; aPacket.NID_RADIO,
    DataState =&gt; Default.DataState.Valid
}</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="SH/PS mode"
 Guid="5d77f218-2ec3-4740-94e8-d43f7e084f75"
>
<ReqRef
 Id="aa345d0e-f599-4016-b5b5-c68601d642fb"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5b1c3845-5822-44a4-b775-fc69302562f2"
>
</ReqRef><ReqRef
 Id="8b8b9125-ec61-4539-8be7-909451a4860a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="eb84192b-7a41-4025-8c52-f20f69b2bbdf"
>
</ReqRef><Comment>In SH mode, only store the ID and phone number.</Comment>
<PreConditions>
<PreCondition
 Guid="3ef8acf1-bfab-4044-95fc-65e2507daa13"
>Kernel.Mode in [Default.Mode.SH, Default.Mode.PS]</PreCondition></PreConditions>
<Actions>
<Action
 Guid="c59b3f0b-833a-4b7f-aa43-c4ecf057eddb"
>LastKnownRBC &lt;- EURORADIO.RBCContactStruct
{
    Id =&gt; EURORADIO.RBCIdStruct{
        Country =&gt; aPacket.NID_C,
        Id =&gt; aPacket.NID_RBC
    },
    PhoneNumber =&gt; aPacket.NID_RADIO,
    DataState =&gt; Default.DataState.Valid
}</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="330"
 Y="900"
 Width="100"
 Height="50"
 NeedsRequirement="FALSE"
 Name="HandleAcknowledgementOfTrainData"
 Guid="b9c4dda4-49f5-4e3c-a939-d4fb62345afc"
>
<Comment>Handles acknowledgement of Train Data.</Comment>
<Parameters>
<Parameter
 Type="Messages.MESSAGE.TRACK_TO_TRAIN.ACKNOWLEDGEMENT_OF_TRAIN_DATA.Message"
 Name="aMessage"
 Guid="c30efb3b-3805-400d-b6f3-db7feb68d8c7"
>
</Parameter></Parameters>
</Procedure><Procedure
 X="330"
 Y="840"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="RemoveAcknOfTrainDataFromMessage"
 Guid="5bf5af4f-ca3b-4886-a2f7-634315c9a975"
>
<ReqRef
 Id="c887c56e-758e-426a-a728-cf723b3b2baf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1631831e-a674-4479-8bc2-3fac7a8be03e"
>
</ReqRef><Comment>Removes Acknowledgement of Train Data from the message.</Comment>
<Parameters>
<Parameter
 Type="Messages.MESSAGE.TRACK_TO_TRAIN.Message"
 Name="aMessage"
 Guid="a024ac83-92fc-4c42-be6c-32bf34baccfd"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Remove Acknowledgement of Train Data from message"
 Guid="1d9f0278-f821-4a69-9457-5de267cb854f"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Remove Acknowledgement of Train Data from message"
 Guid="4cd952f4-5d0e-44f2-ad7e-66a192579cb4"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="0afb9105-bdf8-47d2-9a68-8ec3761547af"
>aMessage.ACKNOWLEDGEMENT_OF_TRAIN_DATA &lt;- EMPTY</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="110"
 Y="780"
 Width="100"
 Height="50"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="ProcessOutgoingMessages"
 Guid="c36b656b-aa9b-4f02-a9d4-d503cfa217a4"
>
<Comment>The outgoing messages are sent when specific actions are performed by the on-board equipment.

But at the end of the cycle the conditions required for sending of position report can become satisfied =&gt; they are evaluated and if satisfied, the position report is sent.</Comment>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Send position report"
 Guid="72736422-33d7-492a-81ac-6cfd6cf0eefd"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Send position report"
 Guid="30a80c20-5a69-4859-9aba-ef425f481c6d"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="506f0d2b-e726-4168-92cc-489acdd72744"
>PositionReport.SendPositionReport()</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="550"
 Y="840"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="MARequestParametersReceived"
 Guid="3bdf5b74-b267-4f2f-a3b8-3167dff3cf81"
>
<ReqRef
 Id="b74d1689-f942-4e2a-abdb-aa241f4f117f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3cb894fb-932b-4391-8954-8801db9865b1"
>
</ReqRef><ReqRef
 Id="8e7007f5-0fea-404a-b7eb-50db12d09f31"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="66a6926c-9728-4beb-adac-aad01a7c9a74"
>
</ReqRef><ReqRef
 Id="b67273e4-3130-454e-8325-67246db078fe"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b0a343ae-844d-48ca-8a2a-49d7aae4cca5"
>
</ReqRef><ReqRef
 Id="1684f6ad-c7c2-42db-b17b-b3b24f030364"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="54464bfe-6c0a-46fe-80c3-f7ef5172d48c"
>
</ReqRef><ReqRef
 Id="05cf6799-8b56-48cb-9adc-a464323c5a84"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="50aa7b37-3201-4bc4-beb2-0c261666819a"
>
</ReqRef><ReqRef
 Id="ecd0acf3-52c6-488c-a1d4-ed1e35869e6f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fb4205b0-4dec-4e92-84b2-6ab04f42c918"
>
</ReqRef><ReqRef
 Id="62880846-6786-43c3-84fe-79a4b98b3fd8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d4590bb2-86a9-49c9-9932-842834ff2092"
>
</ReqRef><Comment>Handles reception of MA request parameters.</Comment>
<Parameters>
<Parameter
 Type="Messages.PACKET.TRACK_TO_TRAIN.MOVEMENT_AUTHORITY_REQUEST_PARAMETERS.Message"
 Name="Packet"
 Guid="e05bfa6e-1820-488c-83bd-22448ff3b138"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Store the new parameters"
 Guid="4f4c9412-ebd3-447b-9eb3-bdfc0fa01dfa"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Store the time values"
 Guid="2c7c39f7-e8f5-4942-bb23-f347779f6b17"
>
<Comment>First, replace the previous values by the values received from the packet.</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="320b109a-792e-416d-bbba-d48ea2c1833b"
>Kernel.MA.MARequest.MARequestParameters &lt;- Kernel.MA.MARequest.MARequestParametersStruct
{
    PreindicationLocationTime =&gt; Default.MessageTypes.TimeResolution( time =&gt; Packet.T_MAR ),
    SectionTimerTime =&gt; Default.MessageTypes.TimeResolution( time =&gt; Packet.T_TIMEOUTRQST ),
    RepetitionTime =&gt; Default.MessageTypes.TimeResolution( time =&gt; Packet.T_CYCRQST )
}</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Handle special values"
 Guid="ca982596-2da7-42ea-a6a2-a42145830eed"
>
<Comment>Then, store the special values indicating which MA request parameters are applicable.</Comment>
<PreConditions>
</PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Store the pre-indication location handling"
 Guid="0c0ee582-cb6f-4ace-b45a-2dd21540dc3d"
>
<Comment>The special value 255 for T_MAR indicates that there is no MA request triggering with regards to the pre-indication location.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Pre-indication location has to be handled"
 Guid="737e7870-a1f7-4b54-a1fe-69223e8b8c01"
>
<Comment>Pre-indication location has to be handled for MA requests.</Comment>
<PreConditions>
<PreCondition
 Guid="5e204e62-c4fe-490d-9a1b-e5938a2190c8"
>Packet.T_MAR != 255</PreCondition></PreConditions>
<Actions>
<Action
 Guid="30f9257a-8ea3-4ecc-8601-24c70ff492d7"
>Kernel.MA.MARequest.MARequestParameters.HandlePreindicationLocation &lt;- True</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Pre-indication location has not to be handled"
 Guid="7524805a-63de-4539-9370-da3ef41336f7"
>
<Comment>Pre-indication location has not to be handled for MA requests.</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="18636c9f-9aaa-4ff5-8c27-049f405a5abf"
>Kernel.MA.MARequest.MARequestParameters.HandlePreindicationLocation &lt;- False</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Store the timeouts handling"
 Guid="f96ad77b-e4c5-43f9-99b5-834422430ef2"
>
<Comment>The special value 1023 for T_TIMEOUTRSQT indicates that there is no MA request triggering with regards to the sections timeouts.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Timeouts have to be handled"
 Guid="dbe503b6-3453-4df6-a8ce-ba4b3449fa19"
>
<Comment>Timeouts have to be handled for MA requests.</Comment>
<PreConditions>
<PreCondition
 Guid="2455541d-8ac7-408b-be9a-5f05a4817771"
>Packet.T_TIMEOUTRQST != 1023</PreCondition></PreConditions>
<Actions>
<Action
 Guid="6ba53e46-8e54-4dc0-bf70-f290747fac02"
>Kernel.MA.MARequest.MARequestParameters.HandleTimeouts &lt;- True</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Timeouts have not to be handled"
 Guid="ef14cf5a-a35d-4ce6-a465-70d38c44c5b0"
>
<Comment>Timeouts have not to be handled for MA requests.</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="68f887a6-fb71-4685-92d2-ea6e3dbda166"
>Kernel.MA.MARequest.MARequestParameters.HandleTimeouts &lt;- False</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Store the repetition handling"
 Guid="7d401cbf-73df-4768-ad07-446d774f07cc"
>
<Comment>The special value 255 for T_CYCRQST indicates that there is no MA request repetition.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Requests have to be repeated"
 Guid="e196364a-ac50-4cb1-bf76-bab2e5b5637b"
>
<Comment>The MA requests have to be repeated.</Comment>
<PreConditions>
<PreCondition
 Guid="ee06d8a0-da11-4df4-8c6e-b2aaa0f16630"
>Packet.T_CYCRQST != 255</PreCondition></PreConditions>
<Actions>
<Action
 Guid="c7436dc7-bf48-4b23-92f3-88f26cacf70c"
>Kernel.MA.MARequest.MARequestParameters.HandleRepetitions &lt;- True</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Requests have not to be repeated"
 Guid="e539fe7d-00dc-4497-b787-fc9aa78f5fb5"
>
<Comment>The MA requests have not to be repeated.</Comment>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="90d2fcd9-38c9-4dc2-8519-b67f724b95ae"
>Kernel.MA.MARequest.MARequestParameters.HandleRepetitions &lt;- False</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 X="660"
 Y="780"
 Width="100"
 Height="50"
 Name="HandleCommonPackets"
 Guid="267eb360-7542-46af-9267-a8a6f93e5227"
>
<ReqRef
 Id="4f1c87c4-e4ca-4713-8aab-10813b7b539c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6eb0a20b-ef7b-40ba-a230-8a2e905ce544"
>
</ReqRef><ReqRef
 Id="34124e11-dd20-40b4-8914-44b6b7397ff1"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a71ac132-e540-4096-b373-cd291488e77b"
>
</ReqRef><ReqRef
 Id="4dea631e-f3ef-4f67-8232-6d867ebc7c34"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5f86f1f1-7ce6-4373-86d9-cc83bce123e4"
>
</ReqRef><ReqRef
 Id="17ca4691-52af-4571-83b8-d4e345bcc557"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="06805ccb-d5d2-4c46-a67a-b35f59a88410"
>
</ReqRef><Comment>Handles reception of common packets as described in Subset-026 Paragraph 8.4.4.4.1.1.</Comment>
<Parameters>
<Parameter
 Type="Messages.MESSAGE.COMMON_PACKETS_COL"
 Name="Packets"
 Guid="bda35355-3c76-4016-a9da-f08035e0829f"
>
</Parameter><Parameter
 Type="MessageTypes.Time"
 Name="Time"
 Guid="3c06eb6f-b270-4cdc-ba27-ac3485ff984f"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Handle common packets"
 Guid="7bd1ae1e-434d-46fd-91b9-9d13b3b06186"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Handle common packets"
 Guid="b16f352e-ddaf-4af2-89d7-0a6dc176492a"
>
<PreConditions>
</PreConditions>
<Actions>
</Actions>
<SubRules>
<Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Level transition order available"
 Guid="36e96b58-9f40-4919-9b4e-07c2b3fbed30"
>
<ReqRef
 Id="7e7c641f-fe52-42ac-9aa8-12e5c7dfd6b2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fae9450d-113e-4c25-8362-ca7a7290c307"
>
</ReqRef><Comment>Handles reception of level transition orders.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Level transition order available"
 Guid="492fa7fb-64bb-408c-99de-c1b404915089"
>
<PreConditions>
<PreCondition
 Guid="aff2ca99-df87-4fce-af4a-c5d94d2935f5"
>THERE_IS X IN Packets | Available ( X.LEVEL_TRANSITION_ORDER )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="176f516e-fef3-4f21-b17f-0556e8216f5d"
>Kernel.LevelTransition.LTOReceived ( Packet =&gt;  ( FIRST X IN Packets | Available ( X.LEVEL_TRANSITION_ORDER ) ).LEVEL_TRANSITION_ORDER )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Session management available"
 Guid="617c0d85-e001-4ba2-9a2e-7ed40b53d7d6"
>
<ReqRef
 Id="18318a83-420a-41a7-b3eb-e4e67f1e3f97"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d1a78d9c-b705-485a-827e-46159c8a4b78"
>
</ReqRef><ReqRef
 Id="ff45f18e-7a7b-412e-8847-569b6605d632"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1f2a0132-4a38-4a8a-9ee9-47bc7b5a6e6f"
>
</ReqRef><Comment>Handles reception of session management.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Session management available"
 Guid="1535de84-4fd0-4408-a56b-3b0d008655c4"
>
<PreConditions>
<PreCondition
 Guid="baf54c0d-8b2c-45d1-9b37-f44d09c72b31"
>THERE_IS X IN Packets | Available ( X.SESSION_MANAGEMENT )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="864aed8d-656b-44ab-97d1-b019cba9aeef"
>TracksideOrderedSessionReceived ( Packet =&gt; ( FIRST X IN Packets | Available ( X.SESSION_MANAGEMENT )).SESSION_MANAGEMENT )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Radio Network registration available"
 Guid="ed7d1e6a-a0a3-49c9-8fd4-be819eba3a56"
>
<ReqRef
 Id="031d12f5-b1df-4716-9eda-a3495861e160"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e91e2170-ac05-410c-94da-1aaa6ead98d4"
>
</ReqRef><ReqRef
 Id="da86aaf7-6b30-4a15-b59d-37e639bcdfc8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1df085a5-8517-41ca-9675-668ec9da5395"
>
</ReqRef><ReqRef
 Id="6476afb5-0645-4298-926a-e67147752ddf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a70cd81c-1509-4100-9065-62c294fe5476"
>
</ReqRef><Comment>Handles reception of radio network registration orders.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Radio Network registration available"
 Guid="e4a85e4e-5316-41c0-ab53-2952ce6faafd"
>
<PreConditions>
<PreCondition
 Guid="0832c897-e755-49da-b609-cfa0c2859a59"
>THERE_IS X IN Packets | Available ( X.RADIO_NETWORK_REGISTRATION )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="f7218da0-0535-4404-9004-e803bf961c91"
>RadioNetworkRegistrationReceived ( aPacket =&gt; ( FIRST X IN Packets | Available ( X.RADIO_NETWORK_REGISTRATION )).RADIO_NETWORK_REGISTRATION )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Movement authority request parameters available"
 Guid="d246069e-15d2-49e9-b02f-d74d788b9fd2"
>
<ReqRef
 Id="0207a978-352d-4243-81cd-c58fb8228dc2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3d8034b0-46d6-45ae-8ba2-96929eae8835"
>
</ReqRef><Comment>Handles reception of the movement authority request parameters.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Movement authority request parameters available"
 Guid="f690f045-757e-4168-850f-58888f04d1ab"
>
<PreConditions>
<PreCondition
 Guid="fb216486-6cdc-4b68-90d3-5e7377703f26"
>THERE_IS X IN Packets | Available ( X.MOVEMENT_AUTHORITY_REQUEST_PARAMETERS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="abe81056-9b8c-4250-9bda-c30cafef8c82"
>MARequestParametersReceived( Packet =&gt; ( FIRST X IN Packets | Available ( X.MOVEMENT_AUTHORITY_REQUEST_PARAMETERS ) ).MOVEMENT_AUTHORITY_REQUEST_PARAMETERS )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="UpdateINTERNAL"
 Implemented="TRUE"
 Name="Position report parameters available"
 Guid="935df013-36d5-46e2-8fd1-1c22e87f3dfc"
>
<ReqRef
 Id="e832ef89-d8d7-4e89-86eb-ba4c29d6d5fe"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3e5938e1-3ca7-41d6-ae46-5f9bca5e096f"
>
</ReqRef><Comment>Handles reception of report parameters.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Position report parameters available"
 Guid="8f6b94f8-5ebc-4d66-9acf-ddf51ba1d957"
>
<ReqRef
 Id="8e46d1f9-ece2-43e9-9a45-e2978111a3dc"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="68ef5d9c-449c-40de-beea-e8affff46386"
>
</ReqRef><PreConditions>
<PreCondition
 Guid="e736f8f8-7e25-47b8-95d9-3641a99d39cb"
>THERE_IS X IN Packets | Available ( X.POSITION_REPORT_PARAMETERS )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="066e716a-07aa-4d5a-a10b-7fc517f0f0b2"
>PositionReport.UpdatePositionReportParameters
(
  ( FIRST X IN Packets | Available ( X.POSITION_REPORT_PARAMETERS ) ).POSITION_REPORT_PARAMETERS
)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Route suitability data available"
 Guid="4aa1a01f-4254-4958-b0e8-99b5cb30cc20"
>
<ReqRef
 Id="3eae43ab-6f26-4908-9360-5a8ce0bec069"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="052af9bd-f74a-4e5a-b527-5d0041e154b5"
>
</ReqRef><Comment>Handles reception of the route suitability data.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Route suitability data available"
 Guid="c0c990ba-89d9-47e6-b458-c64d95c8112c"
>
<PreConditions>
<PreCondition
 Guid="446284a7-38bb-4883-9c06-40ea15d59a53"
>THERE_IS X IN Packets | Available ( X.ROUTE_SUITABILITY_DATA )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="1835b379-689c-41b7-82bd-bafdaa9df3c9"
>Kernel.TrackDescription.RouteSuitability.RouteSuitabilityReceived ( Packet =&gt; ( FIRST X IN Packets | Available ( X.ROUTE_SUITABILITY_DATA ) ).ROUTE_SUITABILITY_DATA )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Geographical position available"
 Guid="c6392e10-ecba-405d-a76b-2510ba3260e4"
>
<ReqRef
 Id="bfb92914-1319-4a13-bb8f-c623e5f7e53a"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="494e6f3a-b888-4d5e-87b9-b170d26f9c28"
>
</ReqRef><Comment>Handles reception of geographical position information.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Geographical position available"
 Guid="61fbd0fd-4497-4000-98e8-49e1aeafeb65"
>
<PreConditions>
<PreCondition
 Guid="7e563bd6-c9f0-489a-a42f-b6e64a89d11b"
>THERE_IS X IN Packets | Available ( X.GEOGRAPHICAL_POSITION_INFORMATION )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="93c1c20e-ed7d-474e-aa0b-b56128d38ef9"
>Kernel.GeographicalPosition.GeographicalPositionReceived( aPacket=&gt; (FIRST X IN Packets | Available ( X.GEOGRAPHICAL_POSITION_INFORMATION)).GEOGRAPHICAL_POSITION_INFORMATION )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="RBC transition order available"
 Guid="bbd085cd-6114-4a8e-9372-7befdce23b2b"
>
<ReqRef
 Id="277de94f-c4cd-4612-97ca-ead1fdd29073"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7371c655-70ff-4786-8af1-47e54b325fbc"
>
</ReqRef><ReqRef
 Id="fb5cdb2c-826a-4be7-babf-d16c11e9720c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c743c8f0-396e-4f62-90ff-46a86510ce47"
>
</ReqRef><Comment>Handles reception of RBC transition orders.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="RBC transition order available"
 Guid="53418cea-2cd8-4707-94b4-ccdc60514170"
>
<PreConditions>
<PreCondition
 Guid="e93e740d-2bf8-41d0-ab39-9fb5c7ea7fe3"
>THERE_IS X IN Packets | Available ( X.RBC_TRANSITION_ORDER )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="9465d11b-3c0d-4be2-a91e-883e806e5d57"
>RBCTransitionOrderReceived ( aPacket =&gt; ( FIRST X IN Packets | Available ( X.RBC_TRANSITION_ORDER )).RBC_TRANSITION_ORDER )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Reversing area information received"
 Guid="d991fd29-3448-414c-b173-d33dc950f456"
>
<ReqRef
 Id="690dfc40-042d-4c8d-9e60-17b85d455fd3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="695cbd0a-2d60-4273-9207-4f12b4517f07"
>
</ReqRef><ReqRef
 Id="f08e576d-1c61-4c2b-b742-29f729a5728f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8a0a0e4a-59f6-4ba6-8a44-24afc8156a17"
>
</ReqRef><ReqRef
 Id="f32ad7de-67d9-4075-bb38-75a13996ad98"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b472d4e9-95b2-4baf-9db7-ee6c4fc212ff"
>
</ReqRef><ReqRef
 Id="c93e250c-fc42-406f-9706-6ec7488b8982"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="089b9fba-2bb7-463a-8dda-057dea445026"
>
</ReqRef><Comment>Handles reception of reversing area information.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Reversing area information received"
 Guid="8a00d353-62fa-4dcf-986c-2ccf3f3da7bf"
>
<PreConditions>
<PreCondition
 Guid="2060598f-0aa3-4dff-9cfc-d591ff131003"
>THERE_IS X IN Packets | Available ( X.REVERSING_AREA_INFORMATION)</PreCondition><PreCondition
 Guid="dd515f89-a7ca-4ad5-8028-653e08841979"
>THERE_IS X IN Packets | Available ( X.REVERSING_SUPERVISION_INFORMATION)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="80535626-724a-4983-90b1-d0fe24394982"
>Kernel.TrackDescription.ReversingArea.ReversingAreaInformationReceived
(
    RVAreaPacket =&gt; ( FIRST X IN Packets | Available (X.REVERSING_AREA_INFORMATION)).REVERSING_AREA_INFORMATION,
    RVSupervisionPacket =&gt; ( FIRST X IN Packets | Available (X.REVERSING_SUPERVISION_INFORMATION)).REVERSING_SUPERVISION_INFORMATION
)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="Reversing supervision information received"
 Guid="28f5a732-ce0a-4051-bbf4-03e0557c4a7b"
>
<ReqRef
 Id="c93e250c-fc42-406f-9706-6ec7488b8982"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b0c86519-5005-4a55-ba21-787201b11562"
>
</ReqRef><ReqRef
 Id="f08e576d-1c61-4c2b-b742-29f729a5728f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="005e242c-9fab-496a-8cc4-ba3c58514f36"
>
</ReqRef><Comment>Handles reception of reversing supervision information.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Reversing supervision information received"
 Guid="af2c5570-7a4d-4054-82ad-57ef1d45427e"
>
<PreConditions>
<PreCondition
 Guid="193d11a0-6c10-4e95-88ed-a9e108627cb4"
>THERE_IS X IN Packets | Available ( X.REVERSING_SUPERVISION_INFORMATION)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="44c794a5-cbc0-4338-8222-edf600f1a426"
>Kernel.TrackDescription.ReversingArea.ReversingSupervisionInformationReceived(RVSupervisionPacket =&gt; ( FIRST X IN Packets | Available (X.REVERSING_SUPERVISION_INFORMATION)).REVERSING_SUPERVISION_INFORMATION)</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 Implemented="TRUE"
 Name="LSSMA display toggle order available"
 Guid="cf3b6a56-0f48-4763-a9f3-26f5e0f6b0db"
>
<ReqRef
 Id="5ab8592b-d34d-449a-b9b4-a49404c758ed"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="09fa92ee-7cd7-489c-9efc-7a8080c44a86"
>
</ReqRef><ReqRef
 Id="569567b3-3681-4d80-9bed-9a1376f4cd6f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="be72b01c-5106-49a0-8a60-afd1ebd352bc"
>
</ReqRef><Comment>Handles reception of an LSSMA diplay toggle order.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="LSSMA display toggle order received"
 Guid="9a4a5819-03c2-4b8c-8d54-3e3ae43d3089"
>
<PreConditions>
<PreCondition
 Guid="20b8a664-9aa0-43cf-806f-77575b6c9d8b"
>THERE_IS X IN Packets | Available (X.LSSMA_DISPLAY_TOGGLE_ORDER)</PreCondition></PreConditions>
<Actions>
<Action
 Guid="de78be94-0ff2-487f-b42a-b5d3406df13c"
>Kernel.LimitedSupervision.LSSMAToggleReceived(
    Packet =&gt;
(FIRST X IN Packets | Available(X.LSSMA_DISPLAY_TOGGLE_ORDER)).LSSMA_DISPLAY_TOGGLE_ORDER,
    Timestamp =&gt; AddToDate
    (
        StartDate =&gt; Kernel.DateAndTime.StartDate,
        Increment =&gt; Default.MessageTypes.TimeResolution(Time)
    )
)</Action></Actions>
</RuleCondition></Conditions>
</Rule></SubRules>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure></Procedures>
<Variables>
<Variable
 Type="Default.BaseTypes.Time"
 DefaultValue="15.0"
 VariableMode="Constant"
 X="1090"
 Y="430"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="TimeBeforeMessageRepetition"
 Guid="7fb9905e-15ef-46c7-bd03-db851be58bc7"
>
<ReqRef
 Id="0f9b05dd-7dd5-408f-94d8-e94d2b283f7c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0415d335-0a90-4f02-8ec4-240662656ae8"
>
</ReqRef><Comment>Represents the waiting time before radio message repetition.</Comment>
</Variable><Variable
 Type="Integer"
 DefaultValue="3"
 VariableMode="Constant"
 X="970"
 Y="540"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="NumberOfMessageRepetitions"
 Guid="c6fc6f21-c004-4e60-9413-a82917e94238"
>
<ReqRef
 Id="023bb134-975d-4e3e-9294-8f3644763d4f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="430f28c3-f752-4247-93ae-fd580cbd55c8"
>
</ReqRef><Comment>Indicates the number of repetitions of radio messages (i.e. excluding the first sending).</Comment>
</Variable><Variable
 Type="EURORADIO.RIUStruct"
 DefaultValue=""
 VariableMode="InOut"
 X="10"
 Y="20"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="RIU"
 Guid="65546b18-9082-469d-85f1-2f2a2c945818"
>
<ReqRef
 Id="64296fc8-fe88-499d-b63e-d570a4a39744"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0bfec18e-8a2f-4476-a678-ac8e9ed363cb"
>
</ReqRef><Comment>RIU connection.</Comment>
</Variable><Variable
 Type="EURORADIO.RBCContactStruct"
 DefaultValue=""
 VariableMode="Internal"
 X="10"
 Y="470"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="LastKnownRBC"
 Guid="871247fa-7189-4f13-874e-e3466aad155e"
>
<ReqRef
 Id="369d7ae0-50db-411b-9941-bbe30e354733"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9e28c009-2f92-4859-8e59-109fe39db193"
>
</ReqRef><ReqRef
 Id="69dc4eed-7cae-45b6-adbb-58b2b1ac6edd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b16379af-d5c7-4071-815c-245a173d6287"
>
</ReqRef><ReqRef
 Id="31fff3ff-41dc-41fb-9f2e-b43b04a91e5e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6d078814-362d-4fc3-8fe8-9c5a20662f9d"
>
</ReqRef><Comment>Contains information about the last known RBC.</Comment>
</Variable><Variable
 Type="String"
 DefaultValue="&apos;&apos;"
 VariableMode="Internal"
 X="970"
 Y="310"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="ShortNumber"
 Guid="56e3a8ca-da3a-43e8-b3a9-ba7a9a8a6805"
>
<ReqRef
 Id="1563df47-a941-45f8-9388-142278ad7952"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a26a7788-a37b-40ae-8235-4e3f28870b7d"
>
</ReqRef><ReqRef
 Id="f8152593-9f99-41a4-9ae8-b51e619e6ece"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="821540b1-66cb-486b-918d-6cdd79e1c6f9"
>
</ReqRef><ReqRef
 Id="40859515-77c4-46aa-96a5-12453cd171a2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="35afd293-b8b4-4acb-9b06-f5ae19225f06"
>
</ReqRef><Comment>The short number of the RBC.</Comment>
</Variable><Variable
 Type="String"
 DefaultValue="&apos;&apos;"
 VariableMode="Internal"
 X="850"
 Y="540"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Implemented="TRUE"
 Name="LastKnownNetworkId"
 Guid="4c27382c-64a2-4c88-8d58-ff66b400ad51"
>
<ReqRef
 Id="9bf96521-7fd6-4183-ab61-1276d48d3996"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e601cf1c-a807-4f9a-a762-522cf4cf6d78"
>
</ReqRef><Comment>The last received Radio Network identity.</Comment>
</Variable><Variable
 Type="EURORADIO.AvailableNetworksStruct"
 DefaultValue=""
 VariableMode="InOut"
 X="780"
 Y="20"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="AvailableNetworks"
 Guid="f24775ac-92d1-48d2-8446-fcd2eb8c7467"
>
<ReqRef
 Id="88987d99-35ff-4f33-894e-06060476dc7d"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="69752379-7c7f-4176-a31b-b10e08129209"
>
</ReqRef><Comment>Allows to request the list of available and allowed networks.</Comment>
</Variable><Variable
 Type="EURORADIO.TerminalStruct"
 DefaultValue=""
 VariableMode="InOut"
 X="200"
 Y="20"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Terminal1"
 Guid="b9169f5f-b1a9-481e-8d17-7b9aee24c60e"
>
<ReqRef
 Id="865bbdd6-2010-4869-ab3e-bc538ce5fe4b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="94da1534-d4e2-409f-94e9-6c7efcd8d7b5"
>
</ReqRef><Comment>First terminal struct.</Comment>
</Variable><Variable
 Type="EURORADIO.TerminalStruct"
 DefaultValue=""
 VariableMode="InOut"
 X="340"
 Y="20"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Terminal2"
 Guid="14bc979c-299e-41a1-b18b-77e58ca89e59"
>
<ReqRef
 Id="865bbdd6-2010-4869-ab3e-bc538ce5fe4b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="6e9b5735-16ad-4ad3-89ff-7df9a6f5141b"
>
</ReqRef><Comment>Second mobile terminal.</Comment>
</Variable><Variable
 Type="ContactOptionEnum"
 DefaultValue=""
 VariableMode="Internal"
 X="930"
 Y="20"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="ContactOption"
 Guid="81db5f5d-dec8-43d9-9546-57479127847f"
>
<ReqRef
 Id="369d7ae0-50db-411b-9941-bbe30e354733"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="89bfb0f7-0fbc-463d-8559-90146c0c036a"
>
</ReqRef><ReqRef
 Id="40859515-77c4-46aa-96a5-12453cd171a2"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d790ef37-059b-46c9-98d4-26e098675485"
>
</ReqRef><ReqRef
 Id="cebfc056-7b96-49d7-a6ff-1fdf0076bb9e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2a4a5158-6dd4-4d58-a1ac-ed6953f88826"
>
</ReqRef><Comment>Indicates how the RBC has to be contacted.</Comment>
</Variable><Variable
 Type="String"
 DefaultValue="&apos;&apos;"
 VariableMode="Internal"
 X="1090"
 Y="310"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="DefaultRadioNetworkId"
 Guid="2899d0b5-6c7a-4333-b3c0-d5226c93ec7e"
>
<ReqRef
 Id="5e068e1e-2be5-45b6-b9eb-d1151df93748"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="8b46767d-0979-4a7a-9437-5ca9d5f363ac"
>
</ReqRef><ReqRef
 Id="5e068e1e-2be5-45b6-b9eb-d1151df93748"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="aa7dc0c0-dce3-4fb0-9217-e463d4e2fc72"
>
</ReqRef><Comment>Gives the values of the default radio network, to be used when no Radio Network identity was received from trackside or from driver.</Comment>
</Variable><Variable
 Type="SystemVersionsCol"
 DefaultValue="[SystemVersionEnum.Version2_0]"
 VariableMode="Internal"
 X="630"
 Y="390"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="SupportedSystemVersions"
 Guid="e9003f47-af6c-4289-a33b-60b830bf4ccc"
>
<ReqRef
 Id="790cf49e-a85c-4110-b567-fc5d57052339"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2acdb939-507a-4b5f-999c-19821626b9dd"
>
</ReqRef><ReqRef
 Id="25af834a-3a24-459b-b5c8-97b85eddb2e8"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e3520cf1-6680-45fb-adc6-d49129321b6d"
>
</ReqRef><Comment>System versions supported by the on-board.</Comment>
</Variable><Variable
 Type="Default.BaseTypes.Time"
 DefaultValue="300.0"
 VariableMode="Constant"
 X="970"
 Y="430"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="MaxTimeToMaintainACommunicationSession"
 Guid="50a37fad-675b-4798-af5d-2505564629c5"
>
<ReqRef
 Id="b2ce7f07-bb0c-45fb-b2f9-3a864e344795"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c113b3d1-f0fd-4952-80a2-1dd8ac647e44"
>
</ReqRef><ReqRef
 Id="308624ea-ea91-4451-b8c4-1cfbc9094f8e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="345f10c0-f724-4b20-947a-b2f0437727c0"
>
</ReqRef><Comment>Maximum time to maintain a communication session in case of failed re-connection attempts.</Comment>
</Variable><Variable
 Type="Default.BaseTypes.Time"
 DefaultValue="45.0"
 VariableMode="Constant"
 X="850"
 Y="430"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="ConnectionStatusTimer"
 Guid="65e21fb1-d0d3-454f-8133-56deba993df5"
>
<ReqRef
 Id="ad234759-9dd4-4ff4-9b9e-764c96f7b0cb"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="dcdc5994-68e4-4ef9-afeb-c4ea66058fc8"
>
</ReqRef><ReqRef
 Id="cd18a937-9dc2-456d-bee7-a61bcd564e32"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2e7a9c6a-4a8a-47ce-95f5-e7fd726a7c40"
>
</ReqRef><Comment>&quot;Connection status&quot; timer for safe radio connection indication.</Comment>
</Variable><Variable
 Type="IncomingMessagesCol"
 DefaultValue="[]"
 VariableMode="Internal"
 X="620"
 Y="20"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="MessagesToHandle"
 Guid="f2c2d0cc-af62-45b6-b849-b52dd4eb46dc"
>
<ReqRef
 Id="c887c56e-758e-426a-a728-cf723b3b2baf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c900db09-2078-4202-9b78-6a61d34165d9"
>
</ReqRef><Comment>Stores the messages sent by the Accepting RBC before it becomes the supervising RBC.</Comment>
</Variable><Variable
 Type="EURORADIO.ContactOrderStruct"
 DefaultValue="EMPTY"
 VariableMode="Internal"
 X="140"
 Y="110"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="RBCContactOrderToRepeat"
 Guid="d890477f-424a-4de1-a3d6-b794a1bde12c"
>
<ReqRef
 Id="573d0d6d-98df-43fa-8065-22f5dae937f3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="88e78b40-3606-492a-9021-fd45199aaf6a"
>
</ReqRef><Comment>If the first attempt to contact the RBC failed, the corresponding contact order is stored in order to retry contacting the RBC.</Comment>
</Variable><Variable
 Type="Boolean"
 DefaultValue="False"
 VariableMode="Internal"
 X="1090"
 Y="540"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="TrainTripDueToMaxTimeBetweenMessagesExceeded"
 Guid="fe8566a0-95b5-4c55-958a-f88709890ec8"
>
<ReqRef
 Id="60e39a2f-4380-44e7-bf85-7142748b200f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="35b84ad6-a1fe-4ac9-9034-51c1dd02a026"
>
</ReqRef><Comment>Indicates that the</Comment>
</Variable><Variable
 Type="Boolean"
 DefaultValue=""
 VariableMode="Internal"
 X="970"
 Y="190"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="InRadioHole"
 Guid="97985c72-02b5-4a17-8ed4-4970137ace9d"
>
<ReqRef
 Id="24ab9b8d-19b6-48f1-8762-46dbc0b3a225"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a0bea44c-7f00-4a05-95bf-38ccbe185cb2"
>
</ReqRef><ReqRef
 Id="60e39a2f-4380-44e7-bf85-7142748b200f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="cb1699ec-7395-4a62-a4fa-624a40634a3b"
>
</ReqRef><Comment>Indicates that the train is curently in a radio hole. Used to determine when the train leaves a radio hole.</Comment>
</Variable><Variable
 Type="BaseTypes.Time"
 DefaultValue="60.0"
 VariableMode="Constant"
 X="850"
 Y="310"
 Width="100"
 Height="50"
 Name="DelayToDisconnect"
 Guid="54e67e1e-4418-45f2-a157-15b133a322f1"
>
<ReqRef
 Id="3289a3d9-cf40-4752-80d6-cdf4b8e86c34"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ec8b8c72-983c-4056-97ad-5046cead56ac"
>
</ReqRef><Comment>Delay from the application of the M_NVCONTACT reaction (applied when the onboard does not receive any new consistent messages from the RBC after a period T_NVCONTACT) to release of the safe radio connection.</Comment>
</Variable><Variable
 Type="Boolean"
 DefaultValue="True"
 VariableMode="Constant"
 X="1090"
 Y="190"
 Width="100"
 Height="50"
 NeedsRequirement="FALSE"
 Name="CheckMessageTimeStamps"
 Guid="80f94470-f39e-44f1-8045-5bb6c1e0771d"
>
<Comment>Indicates whether the check on message time stamps needs to be performed (default is True, is only False for debugging Subset-076 tests).</Comment>
</Variable></Variables>
<Rules>
<Rule
 Priority="UpdateOUT"
 X="970"
 Y="730"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Display safe radio connection status"
 Guid="18070fc1-1c1f-49a3-9614-912ceed3ce08"
>
<ReqRef
 Id="747bae2e-7720-4f04-ac58-bf2f7feb9e50"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="097a1101-bbb5-47b6-8a23-e0471f5aec25"
>
</ReqRef><ReqRef
 Id="56576e5f-6491-43ac-bb6d-439d660b8baf"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="f9f3c652-cd83-4755-9589-a4c05d733c14"
>
</ReqRef><Comment>Requests the display of safe radio connection status.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Display safe radio connection status"
 Guid="255ec871-8428-4c10-a557-e7c18206ba7a"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="02baeff3-ba76-4e24-b9bf-d47379e408b5"
>DMI.MasterDMI().Out_SafeRadioConnectionIndication.Display()</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 X="850"
 Y="730"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Repeat contact RBC request"
 Guid="3b4757ee-054d-4c37-b5d2-f437b162bd07"
>
<ReqRef
 Id="573d0d6d-98df-43fa-8065-22f5dae937f3"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="822b7fa6-8031-42cf-a46c-ec5963cfcd45"
>
</ReqRef><Comment>If an order to contact the RBC by on-board was received but the connection couldn&apos;t be established, the request is repeated again.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="An order to contact the RBC is stored"
 Guid="edb33073-756f-48cb-9763-0e33ca5f0723"
>
<PreConditions>
<PreCondition
 Guid="61a5462f-dc93-45db-bd21-2c092de05ca3"
>RBCContactOrderToRepeat != EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="b5fbfee4-ca84-4128-9ab3-2edd2f4447ef"
>ContactRBC( anOrder =&gt; RBCContactOrderToRepeat )</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 X="1090"
 Y="730"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Track radio hole"
 Guid="44044d2b-8618-4e18-9371-c2955e0b096e"
>
<ReqRef
 Id="24ab9b8d-19b6-48f1-8762-46dbc0b3a225"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c23a7a12-2335-4221-93bd-9002979d616a"
>
</ReqRef><ReqRef
 Id="60e39a2f-4380-44e7-bf85-7142748b200f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="087d0d1b-9218-47d5-81bf-7bfedb16c5d1"
>
</ReqRef><Comment>Tracks whether the train has entered or left a radio hole. Used to refresh the reference time (for time stamp checks on received radio messages).</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="Exit radio hole"
 Guid="384eb0b9-619d-427a-afd2-b1cdd4e560b2"
>
<Comment>The train just left a radio hole.</Comment>
<PreConditions>
<PreCondition
 Guid="3bd733c8-e1ef-40ff-99cb-c61837ed78b5"
>NOT Kernel.TrackDescription.TrackConditions.General.ProfileAtDistance(
    Kernel.TrainPosition.FrontEndPosition(
        PointOfInterest=&gt;DistanceInterval.Nom
    )
).RadioHole</PreCondition><PreCondition
 Guid="eaaf519d-801e-429f-9218-97c4800dab2c"
>InRadioHole</PreCondition></PreConditions>
<Actions>
<Action
 Guid="a230aa99-1898-41d5-9c7d-7fc6327cfbeb"
>CurrentRBCConnection().OnboardReference_MessageTimer &lt;- Kernel.DateAndTime.CurrentTime</Action><Action
 Guid="6f256420-36c7-4e7c-b245-f115adee0fdf"
>InRadioHole &lt;- False</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="Enter radio hole"
 Guid="7f71b554-1c1d-4e57-a840-1738f5d834b5"
>
<Comment>The train just entered a radio hole.</Comment>
<PreConditions>
<PreCondition
 Guid="dcba750f-c397-40bd-bfda-714f4966a0c0"
>Kernel.TrackDescription.TrackConditions.General.IsInsideRadioHole()</PreCondition></PreConditions>
<Actions>
<Action
 Guid="4b8777ce-f4ec-4ad1-8156-c7c3e1c64ff2"
>InRadioHole &lt;- True</Action></Actions>
</RuleCondition></Conditions>
</Rule><Rule
 Priority="Processing"
 X="1210"
 Y="730"
 Width="100"
 Height="50"
 Implemented="TRUE"
 Name="Contact order validity location passed"
 Guid="90cebb27-1c6a-42b1-aae8-6edf816c2f9f"
>
<ReqRef
 Id="8fa3c468-ff7b-4fa4-9f9c-790f481b3f5c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="90a40aa4-daae-4b7b-bfee-53556acccd53"
>
</ReqRef><ReqRef
 Id="bb662eea-95fc-427d-8968-9c64c70423fa"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9e18daa1-7283-4c1e-ac0e-62b01adb5211"
>
</ReqRef><Comment>If the train passed the location where the RBC transition order has to be removed =&gt; remove the RBC transition order.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Contact order validity location passed"
 Guid="ffe16740-dbae-484f-8674-78dad5e81adb"
>
<PreConditions>
<PreCondition
 Guid="fbbf50ac-5249-404e-b0c9-37d0b6c10c28"
>Kernel.TrainPosition.FrontEndPosition( PointOfInterest =&gt; Default.DistanceInterval.Nom ) &gt;= SecondaryTerminal().AcceptingRBCContactOrder.EndOfValidityLocation</PreCondition><PreCondition
 Guid="8159a3b5-93ba-4abf-b8a6-c47c500d081c"
>SecondaryTerminal().AcceptingRBCContactOrder != EMPTY</PreCondition></PreConditions>
<Actions>
<Action
 Guid="2754ef6d-2232-4088-8ba2-11d0dd9c37dd"
>SecondaryTerminal().AcceptingRBCContactOrder &lt;- EMPTY</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</NameSpace>
